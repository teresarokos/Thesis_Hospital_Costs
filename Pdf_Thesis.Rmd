---
header-includes:
    - \usepackage{setspace}\doublespacing
output:
  pdf_document:
  number_sections: yes
documentclass: article
geometry: "left=1.5in, right=1in, top=1in, bottom=1in"
fontsize: 12pt
---


```{r child = 'title_page.Rmd'}
```

\newpage
\pagenumbering{arabic}

```{r, include=FALSE}
library(knitr)
library(tidyverse)
library(fs)
library(readxl)
library(janitor)
library(scales)
library(ggthemes)
library(stringi)
library(stargazer)
library(ggplot2)
library(ggmap)
library(maps)
library(mapdata)
library(plotly)
library(foreign)
library(purrr)
library(ggrepel)
```

```{r, include=FALSE}

merge_sheets <- function(x) {
 bind_rows(
   x %>%
      excel_sheets() %>%
      set_names() %>% 
      purrr::map(read_excel, path = x), .id = "Insurer") %>% 
    mutate(procedure = x)
}

primary_data <- data.frame(Insurer = character(), procedure = character())

file_names <- dir_ls("NH_HealthCost_data/")


for (n in file_names) {
  primary_data <- primary_data %>% 
    bind_rows(merge_sheets(n))
}

primary_data <- primary_data %>% 
  mutate(procedure = str_remove_all(procedure, "NH_HealthCost_data/"),
         procedure = str_remove_all(procedure, ".xlsx")) %>% 
  separate(procedure, into = c("CPT_code", "procedure"), sep = " ", extra = "merge")

primary_data <- clean_names(primary_data, case = "snake")

primary_data <- primary_data %>% 
  rename(provider_name = provider_name_compare_selected) %>% 
  mutate(estimate_of_total_cost = case_when(is.na(estimate_of_total_cost) ~ estimate_of_procedure_cost,
                                            !is.na(estimate_of_total_cost) ~ estimate_of_total_cost),
         insurer = str_replace_all(insurer, "None", "Uninsured"),
         provider_name = str_remove(provider_name, "Compare ")) %>% 
  separate(provider_name, sep = " ", into = c("one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten", "eleven")) %>%
  select(-estimate_of_procedure_cost, -six, -eight, -ten) %>% 
  mutate(two = case_when(!is.na(four) ~ two),
         three = case_when(!(!is.na(two) & is.na(seven)) ~ three),
         four = case_when(!is.na(three) ~ four),
         four = case_when(!(!is.na(three) & is.na(nine)) ~ four),
         five = case_when(!(!is.na(three) & is.na(four)) ~ five),
         five = case_when(!(!is.na(four) & is.na(eleven)) ~ five),
         seven = case_when(!(!is.na(four) & is.na(five)) ~ seven),
         seven = case_when(!(!is.na(five) & !is.na(eleven)) ~ seven),
         nine = case_when(!(is.na(seven) & !is.na(eleven)) ~ nine)) %>% 
  unite("provider_name", c("one", "two", "three", "four", "five", "seven", "nine", "eleven"), sep = " ") %>% 
  mutate(provider_name = str_remove_all(provider_name, " NA"),
         locality = case_when(provider_name %in% c("Northeastern Vermont Regional Hospital", "Springfield Medical Care System") ~ "VERMONT",
                              provider_name %in% c("Orthopaedic Surgical Associates", "Northeast Endoscopy Center", "Lowell General Hospital",
                                                   "Lahey Health", "Orthopaedic Northeast", "Steward Medical Group", "Lawrence General Hospital", 
                                                   "Merrimack Valley Endoscopy Center", "Anna Jaques Hospital") ~ "METROPOLITAN BOSTON, MA",
                              provider_name %in% c("Bridgton Hospital", "York Hospital") ~ "SOUTHERN MAINE",
                              TRUE ~ "NEW HAMPSHIRE"),
         provider_name = str_replace_all(provider_name, "Lakes Region General Healthcare", "Lakes Region General Hospital"),
         provider_name = str_replace_all(provider_name, "LRGHealthcareLRGHealthcare", "LRGHealthcare"),
         provider_name = str_replace_all(provider_name, "Dartmouth-Hitchcock Clinic", "Dartmouth-Hitchcock (Manchester)"))


# Constructing Medicare prices and adding to primary data set
primary_data <- read_xlsx("RVU18A_files/PPRRVU18_JAN_mod.xlsx", skip = 9, col_names = TRUE) %>% 
  rename(cpt_code = HCPCS) %>% 
  filter(cpt_code %in% c(primary_data$cpt_code, 
                         "29806", "29807", "29819", "29820", "29821", "29822", "29823", "29824", "29825",
                         "29873", "29874", "29875", "29876", "29877", "29879", "29880", "29881",
                         "45384",
                         "71045", "71046", "71047", "71048",
                         "72050",
                         "72072", "72074",
                         "74018", "74019", "74021"), is.na(MOD)) %>% 
  select(cpt_code, DESCRIPTION, WorkRVU = RVU, FacilityPERVU = `PE RVU__1`, MPRVU = RVU__1, ConversionFactor = FACTOR) %>% 
  mutate(cpt_code = case_when(DESCRIPTION == "Shoulder arthroscopy/surgery" ~ "29826",
                              DESCRIPTION == "Knee arthroscopy/surgery" ~ "29881",
                              DESCRIPTION == "Colonoscopy w/lesion removal" ~ "45385",
                              DESCRIPTION %in% c("X-ray exam chest 1 view", "X-ray exam chest 2 views", 
                                                 "X-ray exam chest 3 views", "X-ray exam chest 4+ views") ~ "71020",
                              DESCRIPTION %in% c("X-ray exam neck spine 2-3 vw", "X-ray exam neck spine 4/5vws") ~ "72040",
                              DESCRIPTION %in% c("X-ray exam abdomen 1 view", "X-ray exam abdomen 2 views", "X-ray exam abdomen 3+ views") ~ "74000",
                              DESCRIPTION %in% c("X-ray exam thorac spine 2vws", "X-ray exam thorac spine 3vws", "X-ray exam thorac spine4/>vw") ~ "72070",
                              TRUE ~ cpt_code),
         DESCRIPTION = case_when(cpt_code == "71020" ~ "X-ray exam chest",
                                 cpt_code == "72040" ~ "X-ray exam neck spine",
                                 cpt_code == "74000" ~ "X-ray exam abdomen",
                                 cpt_code == "72070" ~ "X-ray exam thorac spine",
                                 TRUE ~ DESCRIPTION)) %>% 
  group_by(cpt_code, DESCRIPTION) %>% 
  summarize(WorkRVU = mean(WorkRVU), FacilityPERVU = mean(FacilityPERVU), MPRVU = mean(MPRVU), ConversionFactor = mean(ConversionFactor)) %>% 
  ungroup() %>% 
  right_join(primary_data,  by = "cpt_code")

primary_data <- read_xlsx("RVU18A_files/GPCI2018_copy.xlsx", skip = 2, col_names = TRUE) %>% 
  rename(locality = X__3) %>% 
  filter(locality %in% c("NEW HAMPSHIRE", "SOUTHERN MAINE", "METROPOLITAN BOSTON, MA", "REST OF MASSACHUSETTS", "VERMONT")) %>% 
  select(locality, WorkGPCI = `PW GPCI`, PEGPCI = `PE GPCI`, MPGPCI = `MP GPCI`) %>% 
  right_join(primary_data, by = "locality") %>% 
  mutate(Medicare = ((WorkRVU * WorkGPCI) + (FacilityPERVU * PEGPCI) + (MPRVU * MPGPCI)) * ConversionFactor, medicare_price = Medicare) %>% 
  select(cpt_code, procedure, provider_name, locality, insurer, estimate_of_total_cost, Medicare, medicare_price, precision_of_the_cost_estimate, 
         typical_patient_complexity, uninsured_discount)

primary_data <- primary_data %>% 
  count(cpt_code, procedure, provider_name, locality, typical_patient_complexity, Medicare) %>% 
  mutate(typical_patient_complexity = case_when(provider_name == "Access Sports Medicine & Orthopaedics" ~ " MEDIUM",
                                                provider_name == "Cheshire Medical Center" ~ " MEDIUM",
                                                provider_name == "Lakes Region General Hospital" ~ " MEDIUM",
                                                TRUE ~ typical_patient_complexity)) %>% 
  count(cpt_code, procedure, provider_name, locality, typical_patient_complexity, Medicare) %>% 
  select(-nn) %>% 
  gather(Medicare, key = insurer, value = estimate_of_total_cost) %>% 
  bind_rows(primary_data) %>% 
  mutate(medicare_price = case_when(insurer == "Medicare" ~ estimate_of_total_cost,
                                    TRUE ~ medicare_price),
         percent_medicare = (estimate_of_total_cost/medicare_price)*100,
         Anthem_NH = case_when(insurer == "Anthem NH" ~ 1,
                               insurer != "Anthem NH" ~ 0),
         Harvard_Pilgrim_HC = case_when(insurer == "Harvard Pilgrim HC" ~ 1,
                               insurer != "Harvard Pilgrim HC" ~ 0),
         CIGNA = case_when(insurer == "CIGNA" ~ 1,
                               insurer != "CIGNA" ~ 0),
         Medicare = case_when(insurer == "Medicare" ~ 1,
                               insurer != "Medicare" ~ 0)) %>% 
  filter(!cpt_code %in% c("29881", "45380", "45385", "85027")) # only looking at radiology services or top 10 procedures


# Adding in Hospital Compare data for quality measures
primary_data <- read_csv("Hospital_Compare_data/Hospital_General_Information_copy.csv") %>% 
  filter(State %in% c("VT", "NH", "ME", "MA")) %>% 
  mutate(provider_name = str_to_title(`Hospital Name`)) %>% 
  filter(`Provider ID` != "200001") %>% 
  mutate(provider_name = str_replace_all(provider_name, "Exeter Hospital Inc","Exeter Hospital"), 
         provider_name = str_replace_all(provider_name, "Memorial Hospital, The","Memorial Hospital"), 
         provider_name = str_replace_all(provider_name, "Southern Nh Medical Center", "Southern NH Medical Center"),
         provider_name = str_replace_all(provider_name, "St Joseph Hospital", "St. Joseph Hospital")) %>% 
  right_join(primary_data, by = "provider_name") %>% 
  mutate(`Hospital Type` = case_when(is.na(`Hospital Type`) ~ "Non-Hospital Providers",
                                     TRUE ~ `Hospital Type`),
         `Hospital overall rating` = case_when(provider_name == "Alice Peck Day Memorial Hospital" ~ "3",
                                              TRUE ~ `Hospital overall rating`),
         `Hospital overall rating footnote` = case_when(provider_name == "Alice Peck Day Memorial Hospital" ~ "2017 rating",
                                                        TRUE ~ `Hospital overall rating footnote`)) %>% 
  select(-`Hospital Name`, -Address, -`Phone Number`, -11, -12, -15:-28)

# Hospital and ambulatory center latitude and longitude
primary_data <- read_csv("provider_coordinates.csv") %>% 
  right_join(primary_data, by = "provider_name")

# The number of other hospitals in each hospital's market
# First adding info on each hospital's hsa and hrr from 2016 dartmouth atlas zipcode to HSA/HRR crosswalk
primary_data <- read_csv("ZipHsaHrr16.csv") %>% 
  filter(hsastate %in% c("NH", "MA", "ME", "VT")) %>% 
  rename(`ZIP Code` = zipcode16) %>%
  right_join(primary_data, by = "ZIP Code")

# Counting number of hospitals within HSA/HRR that also offer that procedure
primary_data <- primary_data %>% 
  filter(!is.na(`ZIP Code`)) %>% 
  count(provider_name, procedure, hsanum, hrrnum) %>% 
  group_by(procedure, hsanum) %>% 
  mutate(n_hosp_hsa_p = n()) %>% 
  ungroup() %>% 
  group_by(procedure, hrrnum) %>% 
  mutate(n_hosp_hrr_p = n()) %>% 
  ungroup() %>% 
  select(-n, -hsanum, -hrrnum) %>% 
  right_join(primary_data, by = c("provider_name", "procedure"))

# Counting number of total hospitals in HSA/HRR
primary_data <- primary_data %>% 
  filter(!is.na(`ZIP Code`)) %>% 
  count(provider_name, hsanum, hrrnum) %>% 
  group_by(hsanum) %>% 
  mutate(n_hosp_hsa_total = n()) %>% 
  ungroup() %>% 
  group_by(hrrnum) %>% 
  mutate(n_hosp_hrr_total = n()) %>% 
  ungroup() %>% 
  select(-n, -hsanum, -hrrnum) %>% 
  right_join(primary_data, by = "provider_name")

# Next, I want to calculate the distance of every hospital to every other hospital and define the markets as certain radius
# Counting number of hospitals that also offer that procedure
radial_markets_procedure <- data.frame(provider1 = character(), procedure = character(), provider2  = character(), 
                                      distance = double(), 
                                      hospital_type1 = character(), hospital_type2 = character(), 
                                      hospital_rating1 = character(), hospital_rating2 = character())

provider_coordinates <- primary_data %>% 
  count(provider_name, lat, long, `Hospital Type`, `Hospital overall rating`) %>% 
  select(-n) %>% 
  mutate(lat = (lat*pi)/180, long = (long*pi)/180)

for (i in provider_coordinates$provider_name) {

provider_procedure <- primary_data %>% 
  count(provider_name, procedure) %>% 
  select(-n) %>% 
  filter(provider_name == i)

provider <- provider_coordinates %>% 
  filter(provider_name == i)

provider1 <- provider$provider_name
lat1 <- provider$lat
long1 <- provider$long
hospital_type1 <- provider$`Hospital Type`
hospital_rating1 <- provider$`Hospital overall rating`

radial_markets_procedure <- primary_data %>% 
  count(provider_name, procedure, lat, long, `Hospital Type`, `Hospital overall rating`) %>% 
  select(-n) %>% 
  mutate(lat = (lat*pi)/180, long = (long*pi)/180) %>% 
  filter(procedure %in% provider_procedure$procedure) %>% 
  rename(provider2 = provider_name, lat2 = lat, long2 = long, hospital_type2 = `Hospital Type`, 
         hospital_rating2 = `Hospital overall rating`) %>% 
  mutate(provider1 = provider1,
         lat1 = lat1, long1 = long1, 
         hospital_type1 = hospital_type1,
         hospital_rating1 = hospital_rating1,
         dLat = (lat2 - lat1), dLong = (long2 - long1), 
         a = (sin(dLat/2)^2) + (cos(lat1) * cos(lat2) * sin(dLong/2)^2),
         c = 2 * atan2(sqrt(a), sqrt(1 - a)), 
         distance = 3959*c) %>% 
  filter(distance <= 25) %>% 
  select(provider1, procedure, provider2, distance, hospital_type1, hospital_type2, hospital_rating1, hospital_rating2) %>% 
  bind_rows(radial_markets_procedure)

}
  
primary_data <- radial_markets_procedure %>% 
  filter(!is.na(hospital_rating2)) %>% 
  group_by(provider1, procedure) %>% 
  summarize(n_hosp_25mi_p = n()) %>% 
  ungroup() %>% 
  rename(provider_name = provider1) %>% 
  right_join(primary_data, by = c("provider_name", "procedure"))

primary_data <- radial_markets_procedure %>% 
  filter(!is.na(hospital_rating2), distance <= 10) %>% 
  group_by(provider1, procedure) %>% 
  summarize(n_hosp_10mi_p = n()) %>% 
  ungroup() %>% 
  rename(provider_name = provider1) %>% 
  right_join(primary_data, by = c("provider_name", "procedure"))

primary_data <- radial_markets_procedure %>% 
  filter(!is.na(hospital_rating2), distance <= 5) %>% 
  group_by(provider1, procedure) %>% 
  summarize(n_hosp_5mi_p = n()) %>% 
  ungroup() %>% 
  rename(provider_name = provider1) %>% 
  right_join(primary_data, by = c("provider_name", "procedure"))

# Counting total number of hospitals
radial_markets <- data.frame(provider1 = character(), provider2  = character(), 
                                      distance = double(), 
                                      hospital_type1 = character(), hospital_type2 = character(), 
                                      hospital_rating1 = character(), hospital_rating2 = character())

provider_coordinates <- primary_data %>% 
  count(provider_name, lat, long, `Hospital Type`, `Hospital overall rating`) %>% 
  select(-n) %>% 
  mutate(lat = (lat*pi)/180, long = (long*pi)/180)

for (i in provider_coordinates$provider_name) {

provider <- provider_coordinates %>% 
  filter(provider_name == i)

provider1 <- provider$provider_name
lat1 <- provider$lat
long1 <- provider$long
hospital_type1 <- provider$`Hospital Type`
hospital_rating1 <- provider$`Hospital overall rating`

radial_markets <- provider_coordinates %>% 
  rename(provider2 = provider_name, lat2 = lat, long2 = long, hospital_type2 = `Hospital Type`, 
         hospital_rating2 = `Hospital overall rating`) %>% 
  mutate(provider1 = provider1,
         lat1 = lat1, long1 = long1, 
         hospital_type1 = hospital_type1,
         hospital_rating1 = hospital_rating1,
         dLat = (lat2 - lat1), dLong = (long2 - long1), 
         a = (sin(dLat/2)^2) + (cos(lat1) * cos(lat2) * sin(dLong/2)^2),
         c = 2 * atan2(sqrt(a), sqrt(1 - a)), 
         distance = 3959*c) %>% 
  filter(distance <= 25) %>% 
  select(provider1, provider2, distance, hospital_type1, hospital_type2, hospital_rating1, hospital_rating2) %>% 
  bind_rows(radial_markets)

}
  
primary_data <- radial_markets %>% 
  filter(!is.na(hospital_rating2)) %>% 
  group_by(provider1) %>% 
  summarize(n_hosp_25mi_total = n()) %>% 
  ungroup() %>% 
  rename(provider_name = provider1) %>% 
  right_join(primary_data, by = "provider_name")

primary_data <- radial_markets %>% 
  filter(!is.na(hospital_rating2), distance <= 10) %>% 
  group_by(provider1) %>% 
  summarize(n_hosp_10mi_total = n()) %>% 
  ungroup() %>% 
  rename(provider_name = provider1) %>% 
  right_join(primary_data, by = "provider_name")

primary_data <- radial_markets %>% 
  filter(!is.na(hospital_rating2), distance <= 5) %>% 
  group_by(provider1) %>% 
  summarize(n_hosp_5mi_total = n()) %>% 
  ungroup() %>% 
  rename(provider_name = provider1) %>% 
  right_join(primary_data, by = "provider_name")


# Top CPT codes from NH Hospital Association
top_10_cpt_codes <- read_xlsx("NHA_top_cpt_codes.xlsx", col_names = TRUE) %>% 
  filter(!is.na(`CPT Code`)) %>% 
  gather(-`CPT Code`, -Description, key = hospital, value = avg_price) %>% 
  filter(!is.na(avg_price)) %>% 
  group_by(`CPT Code`, Description) %>% 
  summarize(avg_price_nh = mean(avg_price)) %>% 
  arrange(desc(avg_price_nh)) %>% 
  filter(Description %in% c("ARTHROSCOPY SHOULDER DECOM", "TONSILLECTOMY&ADNOIDECTOMY:UNDER AGE 12", "UPPER GI ENDOSCOPY, BIOPSY", 
                            "DIAGNOSTIC COLONOSCOPY", "CT BRAIN ‐ W/OUT CONTRAST", "PELVIC ULTRASOUND ‐ NON OBGYN ( NON PREGNANCY)", 
                            "VAGINAL ULTRASOUND ‐ NON OBGYN (NON PREGNANCY)", "ED VISIT‐ PROBLEM(S) ARE OF MODERATE SEVERITY", 
                            "SPINE X‐RAY (LUMBAR PA‐LAT)", "ED VISIT‐ PROBLEM(S) ARE OF LOW TO MODERATE SEVERITY")) %>% 
  rename(cpt_code = `CPT Code`, description = Description) %>% 
  ungroup() %>% 
  mutate(cpt_code = as.character(cpt_code))


# Adding in Census Data
primary_data <- primary_data %>% 
  count(`County Name`, State) %>% 
  arrange(State) %>% 
  select(`County Name`) %>% 
  mutate(median_household_income = c(73533, 92878, 65702, 62618, 65834, 58139, 60148, 45386, 61036, 75777, 69856, 85619, 67805, 59419, 47371, NA),
         percent_pop_over65 = c(0.166, 0.15, 0.178, 0.197, 0.215, 0.271, 0.193, 0.232, 0.201, 0.153, 0.178, 0.173, 0.146, 0.21, 0.201, NA),
         pop_density = c(1508.8, 1837.9, 337.2, 199, 150.1, 51.4, 109.1, 18.4, 52.2, 457.4, 156.8, 425, 333.7, 81.4, 48.1, NA),
         percent_pop_over65 = 100*percent_pop_over65,
         median_household_income = median_household_income/1000) %>% 
  right_join(primary_data, by = "County Name")


# Making a numeric scale for typical patient complexity
primary_data <- primary_data %>% 
count(typical_patient_complexity) %>% 
  mutate(typical_patient_complexity_scale = case_when(n == 24 ~ 1,
                                                      n == c(85, 4968) ~ 2,
                                                      n == 768 ~ 3)) %>% 
  select(-n) %>% 
  right_join(primary_data, by = "typical_patient_complexity")

```

```{r, include=FALSE}
primary_regression_data <- primary_data %>% 
  filter(!insurer %in% c("Uninsured", "Other"), !is.na(`ZIP Code`), !cpt_code %in% c("29826", "42820", "43239", "45378", "99282", "99283")) %>% 
  mutate(`Hospital Quality` = as.numeric(`Hospital overall rating`))

lm_insurers1 <- lm(data = primary_regression_data,
           formula = percent_medicare ~ Anthem_NH + Harvard_Pilgrim_HC + CIGNA)

summary(lm_insurers1)

lm_insurers2 <- lm(data = primary_regression_data,
           formula = percent_medicare ~ Anthem_NH + Harvard_Pilgrim_HC + CIGNA + procedure)

summary(lm_insurers2)

lm_insurers3 <- lm(data = primary_regression_data,
           formula = percent_medicare ~ Anthem_NH + Harvard_Pilgrim_HC + CIGNA + provider_name + procedure)

summary(lm_insurers3)
anova(lm_insurers3)

lm_hospitals1 <- lm(data = primary_regression_data,
                   formula = percent_medicare ~ n_hosp_hsa_total + typical_patient_complexity_scale + `Hospital Quality` + 
                     median_household_income + percent_pop_over65 + pop_density +
                     Anthem_NH + Harvard_Pilgrim_HC + CIGNA + procedure)

summary(lm_hospitals1)

lm_hospitals2 <- lm(data = primary_regression_data,
                   formula = percent_medicare ~ n_hosp_hrr_total + typical_patient_complexity_scale + `Hospital Quality` + 
                     median_household_income + percent_pop_over65 + pop_density +
                     Anthem_NH + Harvard_Pilgrim_HC + CIGNA + procedure)

summary(lm_hospitals2)

lm_hospitals3 <- lm(data = primary_regression_data,
                   formula = percent_medicare ~ n_hosp_hsa_p + typical_patient_complexity_scale + `Hospital Quality` + 
                     median_household_income + percent_pop_over65 + pop_density +
                     Anthem_NH + Harvard_Pilgrim_HC + CIGNA + procedure)

summary(lm_hospitals3)

lm_hospitals4 <- lm(data = primary_regression_data,
                   formula = percent_medicare ~ n_hosp_hrr_p + typical_patient_complexity_scale + `Hospital Quality` + 
                     median_household_income + percent_pop_over65 + pop_density +
                     Anthem_NH + Harvard_Pilgrim_HC + CIGNA + procedure)

summary(lm_hospitals4)

lm_hospitals5 <- lm(data = primary_regression_data,
                   formula = percent_medicare ~ n_hosp_5mi_total + typical_patient_complexity_scale + `Hospital Quality` + 
                     median_household_income + percent_pop_over65 + pop_density +
                     Anthem_NH + Harvard_Pilgrim_HC + CIGNA + procedure)

summary(lm_hospitals5)

lm_hospitals6 <- lm(data = primary_regression_data,
                   formula = percent_medicare ~ n_hosp_10mi_total + typical_patient_complexity_scale + `Hospital Quality` + 
                     median_household_income + percent_pop_over65 + pop_density +
                     Anthem_NH + Harvard_Pilgrim_HC + CIGNA + procedure)

summary(lm_hospitals6)

lm_hospitals7 <- lm(data = primary_regression_data,
                   formula = percent_medicare ~ n_hosp_25mi_total  + typical_patient_complexity_scale + `Hospital Quality` + 
                     median_household_income + percent_pop_over65 + pop_density +
                     Anthem_NH + Harvard_Pilgrim_HC + CIGNA + procedure)

summary(lm_hospitals7)

lm_hospitals8 <- lm(data = primary_regression_data,
                   formula = percent_medicare ~ n_hosp_5mi_p + typical_patient_complexity_scale + `Hospital Quality` + 
                     median_household_income + percent_pop_over65 + pop_density +
                     Anthem_NH + Harvard_Pilgrim_HC + CIGNA + procedure)

summary(lm_hospitals8)

lm_hospitals9 <- lm(data = primary_regression_data,
                   formula = percent_medicare ~ n_hosp_10mi_p + typical_patient_complexity_scale + `Hospital Quality` + 
                     median_household_income + percent_pop_over65 + pop_density +
                     Anthem_NH + Harvard_Pilgrim_HC + CIGNA + procedure)

summary(lm_hospitals9)

lm_hospitals10 <- lm(data = primary_regression_data,
                   formula = percent_medicare ~ n_hosp_25mi_p  + typical_patient_complexity_scale + `Hospital Quality` + 
                     median_household_income + percent_pop_over65 + pop_density +
                     Anthem_NH + Harvard_Pilgrim_HC + CIGNA + procedure)

summary(lm_hospitals10)

lm_hospitals_insurers_1 <- lm(data = primary_regression_data,
                   formula = percent_medicare ~ n_hosp_5mi_p*Anthem_NH + n_hosp_5mi_p*Harvard_Pilgrim_HC + n_hosp_5mi_p*CIGNA + 
                     typical_patient_complexity_scale + `Hospital Quality` + median_household_income + percent_pop_over65 + pop_density +
                     procedure)

summary(lm_hospitals_insurers_1)

lm_hospitals_insurers_2 <- lm(data = primary_regression_data,
                   formula = percent_medicare ~ n_hosp_25mi_p*Anthem_NH + n_hosp_25mi_p*Harvard_Pilgrim_HC + n_hosp_25mi_p*CIGNA + 
                     typical_patient_complexity_scale + `Hospital Quality` + median_household_income + percent_pop_over65 + pop_density +
                     procedure)

summary(lm_hospitals_insurers_2)

lm_hospitals_insurers_3 <- lm(data = primary_regression_data,
                   formula = percent_medicare ~ n_hosp_5mi_total*Anthem_NH + n_hosp_5mi_total*Harvard_Pilgrim_HC + n_hosp_5mi_total*CIGNA + 
                     typical_patient_complexity_scale + `Hospital Quality` + median_household_income + percent_pop_over65 + pop_density +
                     procedure)

summary(lm_hospitals_insurers_3)

lm_hospitals_insurers_4 <- lm(data = primary_regression_data,
                   formula = percent_medicare ~ n_hosp_25mi_total*Anthem_NH + n_hosp_25mi_total*Harvard_Pilgrim_HC + n_hosp_25mi_total*CIGNA + 
                     typical_patient_complexity_scale + `Hospital Quality` + median_household_income + percent_pop_over65 + pop_density +
                     procedure)

summary(lm_hospitals_insurers_4)

primary_regression_data %>% 
  group_by(provider_name) %>% 
  summarise(mean_percent_medicare = mean(percent_medicare)) %>% 
  arrange(desc(mean_percent_medicare))
```

## Abstract
This thesis evaluates how the market power of insurers and hospitals relates to the prices they negotiate for hospital care. Using insurer-hospital-procedure specific prices for outpatient radiology services from New Hampshire's [NH HealthCost website](https://nhhealthcost.nh.gov/costs/select), I compare the estimated prices for the same service first across insurers and then across hospitals, including an analysis of whether the hospital market power effects are heterogenous across insurers. I find that there are statistically significant differences between the prices different insurers pay for the same service at the same hospital, with the largest insurer paying the lowest prices. I also find that across all insurers hospitals with fewer competitors are able to charge higher prices after controlling for quality, typical patient complexity, and socioeconomic/demographic characteristics. However, the effects of hospital market power on negotiated prices vary heterogenously across different insurers. These results are consistent with the story that hospital prices are inefficient and that policy solutions that can decrease the relative market power of each hospital and increase the market power of each insurer may help to reduce prices.

\newpage

# Introduction
The U.S.'s expenditure on health care has grown rapidly over the last few decades and has outpaced that of many peer countries without significant returns to quality (e.g. OECD 2017; Etehad and Kim 2017; Reinhardt et al., 2004).  A substantial body of research has determined that the biggest driver behind the U.S.'s health care expenditure is not greater utilization or social spending but simply higher prices (e.g. Anderson et al., 2003; Papanicolas et al., 2018). Given that the $3.3 trillion spent on health care annually (17.9% of GDP) (Centers for Disease Control and Prevention 2017) erodes the budgets of families and individuals, as well as those of local, state, and federal governments, understanding the sources of variation in these prices is of tremendous import. 

This paper focuses on hospital prices because hospital care constitutes the largest share and one of the fastest growing components of U.S. health care spending at 32.4% ($1.0825 trillion) of national health expenditure (Centers for Disease Control and Prevention 2017) as shown in Figure 1. A vast body of research has identified wide variation in private insurance reimbursements to hospitals for the same services and/or diagnoses. Cooper et al., 2015 finds that for the privately insured, only about half of the variation in expenditure is due to the quantity of care delivered while half is purely driven by price variation; as a comparison, 95% of the variation in expenditure for public programs like Medicare is explained by variation in the quantity of care delivered.
```{r, echo=FALSE, fig.align="center"}

# Creating a graphic to show the growth in U.S. health care spending over time and specifically the growth in hospital care spending

# 1) putting together the data frame that will have U.S. health expenditure by year manually, using data from the CDC

year <- c(1960, 1970, 1975, 1980, 1990, 2000, 2009, 2015, 2016)
national_health_expenditure <- c(27.2, 74.6, 133.3, 255.3, 721.4, 1369.1, 2495.4, 3200.8, 3337.2) # in billions of dollars
hospital_care_expenditure <- c(9.0, 27.2, 51.2, 100.5, 250.4, 415.5, 779.6, 1033.4, 1082.5) # in billions of dollars
phys_clinical_sevices_exp <- c(5.6, 14.3, 25.3, 47.7, 158.4, 288.2, 497.7, 631, 664.9) # in billions of dollars
prescrip_drugs_exp <- c(2.7, 5.5, 8.1, 12, 40.3, 121, 252.7, 324.5, 328.6)
real_gdp <- c(3260, 4951, 5645, 6759, 9366, 13131, 15209, 17387, 17659) # in billions of dollars, adj for inflation using 2012 dollars; https://www.thebalance.com/us-gdp-by-year-3305543

health_expenditures <- data.frame(year, national_health_expenditure, hospital_care_expenditure, real_gdp)


# 2) converting expenditures to percents of gdp
health_expenditures <- health_expenditures %>% 
  mutate(percent_nhe = national_health_expenditure/real_gdp,
         percent_hce = hospital_care_expenditure/real_gdp,
         percent_pcse = phys_clinical_sevices_exp/real_gdp,
         percent_pde = prescrip_drugs_exp/real_gdp) %>% 
  select(year, percent_nhe, percent_hce, percent_pcse, percent_pde) %>% 
  gather(-year, percent_pde, key = component_of_exp, value = percent_of_gdp)


# 2) putting together a line plot that will show this growth over time

ggplot(data = health_expenditures) +
  geom_line(mapping = aes(x = year, y = percent_of_gdp, color = fct_reorder(component_of_exp, -percent_of_gdp))) +
  labs(title = "Health Care Spending in the U.S. over time", caption = "Source: Centers for Disease Control and Prevention 2017") +
  scale_y_continuous(name = "Spending (percentage of GDP)", labels = percent) +
  scale_x_continuous(name = "Year", breaks = c(1960, 1970, 1980, 1990, 2000, 2010)) +
  scale_color_manual(name = "Component of Spending", values = c("percent_nhe" = "black", 
                                                                "percent_hce" = "red", 
                                                                "percent_pcse" = "gray", 
                                                                "percent_pde" = "light gray"),
                    labels = c("Total National Health Expenditure", "Hospital Care", "Physician and Clinical Services", "Prescription Drugs")) +
  theme_tufte()
```
Considering the fact that the largest portion of Americans (49%) receive health care coverage from their employer through private insurance plans rather than through Medicare and Medicaid (Kaiser Family Foundation 2017), this price variation between different private insurers/hospital contracts affects what many Americans pay in premiums and out of pocket for their healthcare. Moreover, prior research such as Cooper et al. 2015 finds that this variation persists even when costs and quality are arguably held constant. 

In this paper, I examine how prices for outpatient services in New Hampshire vary with the market share of the insurer and the market share of the hospital, including an analysis of whether the effects of hospital market share are heterogeneous across insurers. New Hampshire has been a pioneer of price transparency in health care among the U.S. states and therefore provides the opportunity to more closely evaluate the forces shaping hospital prices. I use data from [NH HealthCost](https://nhhealthcost.nh.gov/costs/select) to construct prices at the insurer-provider-procedure level, information from the [New Hampshire Insurance Department](https://www.nh.gov/insurance/reports/documents/2018-nhid-annual-hearing-final-report.pdf) to obtain state-level health insurance information, and geographical data from a variety of sources to construct various measures of hospital market shares. I find statistically significant differences between the prices difference insurers face across the state as well as statistically significant effects of hospital market share on prices, although this effect varies somewhat across insurers.

This paper is most closely related to Cooper et al. 2015, but differs in several key respects: first, this analysis will focus a set of price data for hospital care in New Hampshire, while Cooper et al. 2015 relies on HCCI data which is a national cross-section sample and relies on claims data from Aetna, Humana, and United Health. While the HCCI data is a rich set of data that is perhaps nationally representative in a broad sense, none of these insurers are major players in the New Hampshire market; secondly, this paper will devote more attention to insurers' relative market power although a formal analysis of insurer market power is not possible; lastly, I also examine whether the effect of hospital competition is different across different private insurers.

## Structure
Section II of this paper provides background on the New Hampshire market for health services. Section III supplies explanation of the data sources being used, how they were obtained, and the relevant information contained therein. Section IV lays out the empirical framework used in the the analyses and Section V presents the results. The paper concludes with Section VI.




# Background on the New Hampshire Market
## Health Insurance Coverage
New Hampshire is a small state (8,953 sqaure miles) with a population of 1.343 million (90.5% white) and median household income of $71,305 (Census Bureau 2017). Additionally, 17.6% of the population is over the age of 65, which is slightly higher than the national average of 15.6% (Census Bureau 2017). Figures 2 and 3 show the insurance status of New Hampshire residents in 2017 and the market share of major private insurers, respectively. In 2017, 62% of residents (approximately 820,000 individuals) received health insurance through the private insurance market, 56% through employer-sponsored insurance and 6% through individual private insurance, and this translates to 543,900 enrolled members.^[A plan member can be a household or an individual; these estimates exclude individuals covered by the Federal Employees Health Benefits Program (FEHBP)] Of the privately insured, 81% received coverage through employer-sponsored insurance plans (12.6% Small Group, 19.8% Large Group Fully Insured, and 48.9% Large Group Self Insured) and the remainder either purchase their coverage individually (11.0%) or received subsidies for private coverage through New Hampshire's Premium Assistance Program (7.7%). 

```{r, echo=FALSE}

# Creating dataframe on insurance status in NH from NH Insurance department, first creating columns
insurance_status <- c("Employer Coverage Only", "Individual Coverage Only", "Medicare Coverage Only", "Medicaid Coverage Only", "Uninsured", 
                      "Other Coverage Combinations", "Dual Medicare/Medicaid Coverage", "Tricare & VA Coverage")
percent_in <- c(56, 6, 14, 10, 6, 6, 1, 1)

# Putting together as dataframe
insurance_status_nh <- data.frame(insurance_status, percent_in)

# Creating dataframe on private insurance in NH
insurer <- c("Anthem/Matthew Thorton", "Harvard Pilgrim", "CIGNA", "Other")
percent_enrolled <- c(39, 27, 20, 14)

# Putting together as dataframe
private_insurance <- data.frame(insurer, percent_enrolled)
```

```{r, echo=FALSE, fig.align='center'}
insurance_status_nh %>% 
  ggplot(aes(x = "", y = percent_in, fill = fct_reorder(insurance_status, percent_in))) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  scale_fill_brewer(name = "Insurance Status") +
  geom_text(aes(label = paste0(percent_in, "%")), position = position_stack(vjust = 0.5), color = "white", family = "serif", check_overlap = TRUE) +
  labs(title = "New Hampshire Residents by Health Insurance Status in 2017", 
       caption = "Source: New Hampshire Health Insurance Department, Nov. 2018") +
  theme_tufte() +
  theme(axis.title.x  = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(), 
        axis.title.y  = element_blank(),
        axis.ticks.y = element_blank())
```
The three major private insurers are Anthem/Matthew Thorton (39%), Harvard Pilgrim Healthcare (27%), and CIGNA (20%). Other insurers include Ambetter (3.5%), Minuteman Health (3.4%), Tufts (3.0%), Community Health Options (2.1%), United (1.2%), and Aetna (0.2%), but the HealthCost website often does not provide prices for these insurers and when it does, it does not specify between them so I am unable to include them in the analysis. Of the three major insurers, both Anthem and CIGNA have a significant national presence, Anthem being the larger of the two with 40.2 million members compared to CIGNA's 15.9 million members [Becker's Hospital Review 2019](https://www.beckershospitalreview.com/payer-issues/america-s-largest-health-insurers-in-2018.html). The Anthem plans are underwritten by Matthew Thorton Health Plan, Inc., which is a fully owned subsidiary of Anthem, but will be referred to as "Anthem" for the remainder of the paper. Harvard Pilgrim Health Care is a non-profit private company that primarily operates in the north eastern United States [Crunchbase 2019](https://www.crunchbase.com/organization/harvard-pilgrim-health-care#section-overview), so while it is the second largest insurer in New Hampshire, it is a relatively small national player.

```{r, echo=FALSE, fig.align='center'}

private_insurance %>% 
  ggplot(aes(x = "", y = percent_enrolled, fill = fct_reorder(insurer, percent_enrolled))) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  scale_fill_manual(name = "Private Insurer", values = c("CIGNA" = "#99CC00", "Anthem/Matthew Thorton" = "#336699", 
                               "Harvard Pilgrim" = "#CC0000", "Other" = "#C0C0C0")) +
  geom_text(aes(label = paste0(percent_enrolled, "%")), position = position_stack(vjust = 0.5), color = "white", family = "serif") +
  labs(title = "Distribution by Insurer for NH Commercial Market in 2017", 
       caption = "Source: New Hampshire Health Insurance Department, Nov. 2018") +
  theme_tufte() +
  theme(axis.title.x  = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(), 
        axis.title.y  = element_blank(),
        axis.ticks.y = element_blank())
```


## New Hampshire Providers
New Hampshire has a total of 31 hospitals and 3,503 beds within the state (New Hampshire Hospital Association 2018). According to the New Hampshire Hospital Association, 13 of these hospitals with 2,704 beds total are Prospective Payment Systems (PPS) Hospitals, which take prospective payments from Medicare; 13 hospitals with 301 beds total are Critical Access Hospitals (CAH), which serve rural populations and therefore are eligible to receive certain benefits from Medicare such as cost-based reimbursement for Medicare services; 5 hospitals with 498 beds total are Specialty Hospitals, which provide a specialized category of services (such as children’s hospitals, orthopedic hospitals, cancer hospitals, etc.) and are omitted from my analysis for lack of price information. While categorized by Medicare reimbursements, all of the hospitals included in my analysis serve privately insured individuals in addition to Medicare patients.

In addition to the 26 New Hampshire hospitals, there are 6 out-of-state hospitals included in my analysis which are located close to New Hampshire's borders: Anna Jaques Hospital, Lawrence General Hospital, and Lowell General Hospital (Massachusetts); Bridgton Hospital and York Hospital (Maine); and Northeastern Vermont Regional Hospital (Vermont). Furthermore, there are 99 non-hospital providers such as ambulatory surgical centers, clinics, and private phsycian groups that also provide some of the relevant outpatient procedures. Though the focus of the analysis will be on hospitals, I include these non-hospital providers in Figure 4 for context.

```{r, echo=FALSE, out.width="100%", message=FALSE, warning=FALSE}

counties <- map_data("county")

north_east <- subset(counties, region == "new hampshire")
                     # region %in% c("vermont", "new hampshire", "maine", "massachusetts"))

hospitals <- primary_data %>% 
  filter(!is.na(`Provider ID`)) %>% 
  count(provider_name, lat, long, `Hospital Type`)

 ggplot() + 
  geom_polygon(data = north_east, aes(x = long, y = lat, group = group), fill = "light gray", color = "white") + 
  coord_fixed(xlim = c(-75, -69),  ylim = c(41.5, 45.3), ratio = 1.3) +
  geom_point(data = primary_data, mapping = aes(x = long, y = lat, color = `Hospital Type`)) +
  scale_color_manual(name = "Hospital Type", values = c("Acute Care Hospitals" = "#0072B2", 
                                                        "Critical Access Hospitals" = "#56B4E9", 
                                                        "Non-Hospital Providers" = "#999999")) +
  geom_text_repel(data = subset(hospitals, long < -71.4 & lat > 44), aes(x = long, y = lat, label = provider_name), size = 1.7, 
                   box.padding = unit(0.2, 'lines'), xlim = c(-74,-72), ylim = c(44.1, 46)) +
   geom_text_repel(data = subset(hospitals, long < -71.5 & lat < 44 & lat > 43), aes(x = long, y = lat, label = provider_name), size = 1.7, 
                   box.padding = unit(0.2, 'lines'), xlim = c(-74,-72.5), ylim = c(42, 44.1)) +
   geom_text_repel(data = subset(hospitals, long < -72 & lat < 43), aes(x = long, y = lat, label = provider_name), size = 1.7, 
                   box.padding = unit(0.2, 'lines'), xlim = c(-75,-72.7), ylim = c(42, 42.8)) +
   geom_text_repel(data = subset(hospitals, long < -71.5 & long > -72 & lat < 43), aes(x = long, y = lat, label = provider_name), size = 1.7, 
                  box.padding = unit(0.2, 'lines'), xlim = c(-75,-72.8), ylim = c(42, 42.6)) +
   geom_text_repel(data = subset(hospitals, long > -71.4 & lat > 44), aes(x = long, y = lat, label = provider_name), size = 1.7, 
                   box.padding = unit(0.2, 'lines'), xlim = c(-71,-69), ylim = c(44, 46)) +
   geom_text_repel(data = subset(hospitals, long > -71.5 & lat < 44 & lat > 43.2), aes(x = long, y = lat, label = provider_name), size = 1.7, 
                   box.padding = unit(0.2, 'lines'), xlim = c(-70.7,-69), ylim = c(43.2, 44.1)) +
   geom_text_repel(data = subset(hospitals, long > -71 & lat < 43.2), aes(x = long, y = lat, label = provider_name), size = 1.7, 
                   box.padding = unit(0.2, 'lines'), xlim = c(-70,-69), ylim = c(42, 43.2)) +
   geom_text_repel(data = subset(hospitals, long < -71 & long > -71.7 & lat < 43.1 & lat > 42.9), aes(x = long, y = lat, label = provider_name), size = 1.7, 
                   box.padding = unit(0.2, 'lines'), xlim = c(-75,-72), ylim = c(42, 42.4)) +
   geom_text_repel(data = subset(hospitals, long < -71.4 & long > -71.7 & lat < 42.9 & lat > 42.74), aes(x = long, y = lat, label = provider_name), size = 1.7, 
                   box.padding = unit(0.2, 'lines'), xlim = c(-73,-71), ylim = c(41.5, 42.2)) +
   geom_text_repel(data = subset(hospitals, long < -71 & long > -71.4 & lat < 42.9), aes(x = long, y = lat, label = provider_name), size = 1.7, 
                   box.padding = unit(0.2, 'lines'), xlim = c(-71.5,-69), ylim = c(41, 42.6)) +
  labs(title = "Location of New Hampshire Hospitals") +
  theme_tufte() +
  theme(axis.title.x  = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(), 
        axis.title.y  = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

```

There has only been one official hospital merger involving a hospital in New Hampshire: Massachusetts General Hospital (MGH)/Partners HealthCare from Massachusetts acquired Wentworth-Douglass on January 1, 2017. However, if two pending quasi-mergers go through, "22 out of New Hampshire's 26 acute-care hospitals will have established some kind of organizational connection with other institutions, often mergers in all but name" ( [Concord Monitor Jan 26, 2019](https://www.concordmonitor.com/hospitals-merge-followup-23005911) ). In May 2018 Partners HealthCare also made a bid to acquire Exeter Health Resources, and this merger is still pending approval.

### Price variation in the New Hampshire Market
Large price variation exists in New Hampshire, and I present boxplot distributions of procedure prices in Figures 4.1 and 4.2 for ten common outpatient procedures in New Hampshire. I indentify these procedures using 2016 data from the [New Hampshire Hospital Association](https://www.nhha.org/images/Data/Outpatient-CPT-List-2016.pdf) and further narrow their list of 82 (out of thousands) down to 10 of the most expensive services for which I have price estimates for private insurers. Figure 4.1 includes payments by the uninsured, private insurers, and Medicare  for these common procedures, and Figure 4.2 only shows the payments made by private insurers. All price data presented reflect 2018 prices. Significant variation exists in the prices paid for the same procedure or service, even when only considering the privately insured, and this may be expected if costs and quality vary across hospitals.

```{r, echo=FALSE, results = "asis", fig.align='center', message=FALSE}

all_payers <- primary_data %>% 
  semi_join(top_10_cpt_codes, by = "cpt_code") %>% 
  filter(`Hospital Type` != "Non-Hospital Providers") %>% 
  group_by(procedure) %>% 
  summarize(Median = median(estimate_of_total_cost), `Std Dev` = sd(estimate_of_total_cost),
            Min = min(estimate_of_total_cost), Max = max(estimate_of_total_cost)) %>% 
  ungroup() %>% 
  mutate(Median = format(round(Median, 0), nsmall = 0),
         `Std Dev` = format(round(`Std Dev`, 0), nsmall = 0),
         Min = format(round(Min, 0), nsmall = 0),
         Max = format(round(Max, 0), nsmall = 0),
         procedure = str_replace_all(procedure, "&", "/")) %>% 
  data.frame()

major_insurers <- primary_data %>% 
  semi_join(top_10_cpt_codes, by = "cpt_code") %>% 
  filter(`Hospital Type` != "Non-Hospital Providers", !insurer %in% c("Uninsured", "Other", "Medicare")) %>% 
  group_by(procedure) %>% 
  summarize(Median = median(estimate_of_total_cost), `Std Dev` = sd(estimate_of_total_cost),
            Min = min(estimate_of_total_cost), Max = max(estimate_of_total_cost)) %>% 
  ungroup() %>% 
  mutate(Median = format(round(Median, 0), nsmall = 0),
         `Std Dev` = format(round(`Std Dev`, 0), nsmall = 0),
         Min = format(round(Min, 0), nsmall = 0),
         Max = format(round(Max, 0), nsmall = 0),
         procedure = str_replace_all(procedure, "&", "/")) %>% 
  data.frame()

stargazer(all_payers, summary = FALSE, rownames = FALSE, font.size = "footnotesize", header = FALSE, 
          column.labels = c("Procedure", "Median", "Std. Dev", "Min", "Max"))

stargazer(major_insurers, summary = FALSE, rownames = FALSE, font.size = "footnotesize", header = FALSE, 
          column.labels = c("Procedure", "Median", "Std. Dev", "Min", "Max"))
```



This variation persists even when costs and quality are reasonably assumed fixed within the same hospital. Controlling for procedure, across hospital price variation accounts for 16.4% of the total variation but *within* hospital price variation accounts for a further 17.0% of the total. For the same service at the same hospital, different payers are charged vastly different amounts. Figures 5.1 and 5.2 show the different prices paid by the three major private payers in New Hampshire (Anthem NH, CIGNA, and Harvard Pilgrim Health Care) at the same hospital for a transvaginal ultrasound and a spine x-ray (two very common radiology services), respectively. All hospitals in Figure 5.1 have a difference of at least \$150 in the price paid by the highest private payer and that paid by the lowest private payer. In three of these hospitals (St. Joseph Hospital, Anna Jaques Hospital, and Foundation Medical Partners), the highest payer is paying more than twice the amount the lowest payer is paying. For all of the hospitals in Figure 5.2, there is a difference of at least \$100 between the highest and lowest payers.

```{r, echo=FALSE, fig.align='center'}
primary_data %>% 
  filter(procedure == "Ultrasound - Transvaginal (non-maternity)", !insurer %in% c("Uninsured", "Other", "Medicare")) %>% 
  count(provider_name, insurer) %>% 
  count(provider_name) %>% 
  filter(nn == 3) %>%
  left_join(primary_data, by = "provider_name") %>% 
  filter(procedure == "Ultrasound - Transvaginal (non-maternity)", !insurer %in% c("Uninsured", "Other", "Medicare")) %>%
  group_by(provider_name) %>% 
  mutate(range = max(estimate_of_total_cost) - min(estimate_of_total_cost)) %>% 
  filter(range > 150) %>% 
  ungroup() %>% 
  ggplot(aes(x = fct_reorder(provider_name, estimate_of_total_cost), y = estimate_of_total_cost, fill = insurer)) +
  geom_col(position = "dodge", width = 0.5) +
  scale_fill_manual(values = c("Uninsured" = "#DCDCDC", "CIGNA" = "#99CC00", "Anthem NH" = "#336699", 
                               "Harvard Pilgrim HC" = "#CC0000", "Other" = "#C0C0C0", "Medicare" = "#808080"), name = "Insurer") +
  scale_y_continuous(name = "Price Estimate", labels = dollar) +
  labs(title = "Prices for Ultrasound - Transvaginal (non-maternity)") + 
  coord_flip() +
  theme_tufte() +
  theme(axis.title.y = element_blank())
  # geom_text(aes(label = paste0("$", estimate_of_total_cost)), color = "black", position = position_dodge(width = TRUE), size = 2)
  

primary_data %>% 
  filter(procedure == "X-Ray - Spine (outpatient)", !insurer %in% c("Uninsured", "Other", "Medicare")) %>% 
  count(provider_name, insurer) %>% 
  count(provider_name) %>% 
  filter(nn == 3) %>%
  left_join(primary_data, by = "provider_name") %>% 
  filter(procedure == "X-Ray - Spine (outpatient)", !insurer %in% c("Uninsured", "Other", "Medicare")) %>%
  group_by(provider_name) %>% 
  mutate(range = max(estimate_of_total_cost) - min(estimate_of_total_cost)) %>% 
  filter(range > 100) %>% 
  ungroup() %>% 
  ggplot(aes(x = fct_reorder(provider_name, estimate_of_total_cost), y = estimate_of_total_cost, fill = insurer)) +
  geom_col(position = "dodge", width = 0.5) +
  scale_fill_manual(values = c("Uninsured" = "#DCDCDC", "CIGNA" = "#99CC00", "Anthem NH" = "#336699", 
                               "Harvard Pilgrim HC" = "#CC0000", "Other" = "#C0C0C0", "Medicare" = "#808080"), name = "Insurer") +
  scale_y_continuous(name = "Price Estimate", labels = dollar) +
  labs(title = "Prices for X-Ray - Spine (outpatient)") +
  coord_flip() +
  theme_tufte() + 
  theme(axis.title.y = element_blank())
```

It is unlikely that the cost of providing each of these services and the quality of each of these services within the same hospital should vary with patients' insurance coverage. That is, it should be no more costly from the hospital's point of view to perform a spine x-ray on a patient covered by CIGNA as opposed to a patient covered by Anthem, and hospitals should not provide higher quality spine x-rays to CIGNA covered patients than they do to Anthem patients. Thus my analysis explores other potential sources of this variation, particularly those related to market power.




# Data
## HealthCost Data
The primary source of data on hospital prices comes from the New Hampshire Insurance Department [HealthCost website](https://nhhealthcost.nh.gov/costs/select) which is a publicly available tool that provides insurer-hospital specific estimations of costs for roughly 150 services and procedures. New Hampshire is one of the few states that makes such information publicly available, hence why I use it as a case study for my analysis. The cost estimates are calculated using claims data from the New Hampshire Comprehensive Healthcare Information System (NHCHIS) to determine the median amount that insurance carriers and patients pay for each service. The estimated costs therefore reflect the rates negotiated between health care providers and insurance carriers (often referred to as the "allowable amount") rather than provider charges, which have been shown to have little relation to what most privately insurered individuals actually pay for a given service.

For the services relevant to this paper (outpatient procedures and radiology services), the estimated prices may be "bundled" to include multiple services or independent providers; that is, the estimates aggregate the costs for what may be treatment received from several providers (billing separately) under the "lead provider" rather than distinguishing between what is paid to the facility versus the physicians who treat the patient. Price estimates for radiology services use a modified bundle that includes the facility and the professional fees associated with the patient receiving that service but not any other costs that the patient may have incurred on the same day. 

Each service on HealthCost is identified with a description (e.g. "X-Ray - Abdomen") and one of the American Medical Association's Current Procedural Terminology (CPT) codes.  However, there are multiple CPT codes for an abdominal x-ray (different codes for different numbers of views), so the CPT codes for similar services are counted and the most common ones identified through the frequency distribution. From there, the representative CPT code and description is chosen based on what will be the simplest and most easily recognized procedure, and, when available, clinical insight is also considered. This means that in some cases, multiple CPT codes may be combined, as long as the cost is similar, under a single service. 

Additionally, HealthCost includes indicators of variability for each estimate under the "Precision of the Cost Estimate" field, where "High" corresponds to cost estimates with little variability from one patient to the next, and risk-adjustment indicators under the "Typical Patient Complexity" field, which are evaluated for each hospital within that procedure. For example, a hospital may attract an average population when considering all procedures but a more complex population when only considering brain MRIs as compared to other hospitals. Thus, for brain MRIs, this hospital would have a "High" typical patient complexity as it tends to serve higher complexity patients than other hospitals. Lastly, HealthCost does not include visits where an infrequent and high cost procedure is performed in conjunction with a HealthCost procedure because the more expensive procedure may have also impacted the cost for performing the more routine services. 

The data available on HealthCost me to construct a data set containing the estimated price for each procedure and each provider-insurer combination for which data was available. I also keep values for "Typical Patient Complexity" and "Precision of the Cost Estimate" to use as controls in my analysis. 

## CMS Data
### Medicare Prices
The Center for Medicaid and Medicare Services (CMS) sets all of it prices centrally, allowing for some variation across regions, and reimburses oupatient services through Medicare Part B based on the services provided, defined at the CPT code level. This information is made public in the Physician Fee Schedule (PFS) [2018 Relative Value file](https://www.cms.gov/Medicare/Medicare-Fee-for-Service-Payment/PhysicianFeeSched/PFS-Relative-Value-Files.html), allowing me to construct the Medicare reimbursement rates at each hospital for each service observed in the HealthCost data by matching each hospital to a locality in the CMS data. I am able to calculate the 2018 Medicare Facility Pricing Amount $p_{2018}^{Medicare}$ for each procedure $j$ at the locality level $l$ using  the following formula:
$$p_{jl, 2018}^{Medicare} = [({RVU}_{j}^{work}*{GPCI}_{l}^{work}) + ({RVU}_{j}^{PE}*{GPCI}_{l}^{PE}) + ({RVU}_{j}^{MP}*{GPCI}_{l}^{MP})]*{CF}_{2018} $$ 
where ${RVU}_{j}^{work}$ denotes the Relative Value Unit (RVU) for the physician work involved in providing procedure $j$, ${RVU}_{j}^{PE}$ denotes the RVU for the resource-based practice expense for the facility setting, and ${RVU}_{j}^{MP}$ denotes the RVU for the malpractice expense. ${GPCI}_{l}^{work}$ denotes the Geographic Practice Cost Index (GPCI) corresponding to locality $l$ and the work RVU, ${GPCI}_{l}^{PE}$ corresponds to the practice expense RVU, and ${GPCI}_{l}^{MP}$ corresponds to the malpractice RVU. ${CF}_{2018}$ denotes the 2018 conversion factor (\$35.996). For example, a foot x-ray has a work RVU of 0.17, a facility practice expense RVU of 0.64, and a malpractice RVU of 0.02 while an arthroscopic shoulder surgery has a work RVU of 8.843, a facility practice expense RVU of 7.997, and a malpractice RVU of 1.612 to capture how the arthroscopic shoulder surgery is a much more technical, expensive, and high-risk procedure to provide than a foot x-ray. These RVUs are then weighted by the locality $l$'s corresponding GPCIs (values that range from 0.950 to 1.925 in the 2018 data) to account for labor costs, equipment costs, and malpractice expenses in that region. As a result, Medicare pays \$30.90 for a foot x-ray and \$677.26 for an arthroscopic shoulder surgeryin in most New Hampshire hospitals but \$34.25 for a foot x-ray and \$729.84 for an arthroscopic shoulder surgery in the Boston metropolitan area.

Medicare treats all of New Hampshire as one locality, meaning that all hospitals in New Hampshire that are reimbursed through prospective payments are reimbursed the same amount for outpatient services through Medicare Part B. However, 13 out of the 32 hospitals in my dataset are Critical Access Hospitals (CAHs) that are elligible to receive cost-based reimbursements from Medicare. I was unable to obtain data on exactly how much these CAHs are reimbursed by CPT code and therefore use the prospective payment rates as an approximation for what they are reimbursed by Medicare. This should not have a major impact on the analysis as the focus is on private insurers, and I primarily use Medicare prices for the purposes of standardization of the private insurer prices available through NH HealthCost. 

### Hospital Quality
The second dataset provided by CMS is the [Hospital Compare data](https://data.medicare.gov/data/hospital-compare) which provides measures of quality. The hospital overall ratings attempt to capture the quality of care a hospital may provide compared to other hospitals based on the quality measures reported on Hospital Compare, summarizing into a single rating more than 60 measures in seven measure groups: mortality, safety of care, readmission, patient experience, effectiveness of care, timeliness of care, and efficient use of medical imaging. Hospitals are ranked out of five stars, and my dataset includes two hospitals with two stars, 11 hospitals with three stars, 16 hospitals with four stars, and three hospitals with five stars for their overall ratings.



# Conceptual Framework
In standard micro-economic theory, one learns that resources are optimally allocated in a perfectly competitive market via the mechanism of price, which results from the intersection of the supply and demand curves. For producers, the price will be equivalent to the marginal cost of production, and for consumers, the price will reflect the value of their marginal unit of utility. In this standard model, both producers and consumers are price takers, making their production or consumption decisions based on an exogenous price. 

However, in the real world it is often the case that firms, and occasionally consumers, can excercise some level of market power; that is, their production or consumption decisions can affect price such that it is no longer exogenous. In this scenario, the agent with market power is no longer a price taker but also a price setter. The most extreme example of this of course is the monopolist, which sets its price to maximize profits given the demand curve for the good, and when profits are introduced, price is no longer welfare maximizing and a less than optimal amount of the good is consumed. 

The market for health services is imperfect in several ways. Mainly, most patients do not face the full costs of the services they require due to health insurance coverage. Health insurance is made necessary because the market for health care is full of risk: health services are often compensated in a large one time payment and each person is uncertain about how much care they will require and when. Thus, insurance helps distribute the risk associated with each consumer across a pool of plan enrollees and, in exchange for monthly premiums, helps bear some of the costs of care. 

Because the insurers cover a large portion of the cost of care, at least in the highly expensive cases, they are the most proximate agents to the price setting process with hospitals. Each hospital and insurer negotiate explicit contracts of the insurer's reimbursement rates, usually for each service, and this is possible because there are relatively few hospitals and relatively few insurers present in each market for health care. That is, unlike the perfectly competitive market where there are many producers and many consumers acting as price takers, insurers and hospitals are both price setters in the health care market because the decision of the marginal producer or consumer matters. An insurer can decide not to include a hospital in its network, thereby reducing the likelihood of that plan's enrollees to seek out care there, and a hospital is ultimately the agent providing its services for a price. Therefore, the prices that result from these negotiations may more reflect the relative bargaining power of the insurer and the hospital rather than the marginal cost and marginal utility of the services provided as the price in a competitive market would.

In these bilateral negotiations, I assume the following: both the provider and the payer want to maximize the number of patients they serve and their profit margins per patient, even if the provider is a non-profit (Horwitz 2005). Providers want to receive higher prices for their services but also to be included in payers' networks, as patients face lower out-of-pocket costs when going to providers in network. Payers want to pay lower prices for providers’ services to minimize their costs but also want to attract enrollees by including convenient providers in their network, which is an important aspect of plan selection for individuals (Ho 2006). Thus, if market share is associated with bargaining power, prices are expected to be more favorable for the hospitals or insurers with greater market shares. I examine whether this is the case in the analysis that follows.




# Empirical Approach
My analysis seeks to identify whether the market share of hospitals and insurers is related to variation in the prices private insurers pay for hospital services. The first section focuses insurer market share and the second on hospital market share. I restrict my analyses only to radiology services, which are among some of the most common outpatient procedures, only to hospitals (excluding ambulatory care centers, clinics, specialist practices, etc.), and only to the three major private insurers and Medicare (to provide a base price). This leaves me with 33 services, 31 hospitals,^[Bridgton Hospital in Maine was dropped from the dataset as HealthCost did not provide data on the prices of any radiology services at this hospital] and 2,308 observations.^[HealthCost does not have prices for all three private insurers and all 33 services at each each hospital]

Radiology services (CT scans, MRIs, ultrasounds, x-rays, etc.) generally involve the use of an imaging device to capture an image which is then read (examined) by a radiologist who reports their findings to the patient or patient's doctor. The initial cost of purchasing one of these imaging devices is expensive and may vary somewhat, but the per unit cost of procuring and reading an image is likely to be similar across providers once controlling for wages. Within hospitals, there should be very little deviation in per unit costs. Furthermore, the quality of radiology services may potentially vary across hospitals (although I would argue this variation is minimal), but within each hospital, this quality is plausibly assumed constant.

My outcome variable of interest is the percentage of the price Medicare paid by individual with insurance $i$ for a particular procedure $j$ at a particular hospital $h$, denoted as $y_{ijh}$. That is, 
$$y_{ijh} = \frac {p_{ijh}}{p_{jh}^{Medicare}}$$

where $p_{ijh}$ denotes the price a particular insurer pays for procedure $j$ at hospital $h$, and $p_{jh}^{Medicare}$ denotes the price Medicare pays for the same service at the same hospital. As mentioned above, for some of the critical access hospitals, this may not be the rate at which Medicare actually reimburses the hospital because only the PFS rates are known, but the medicare price is merely used to standardize prices and therefore the analysis should be largely unaffected by this limitation.

The first estimation is interested in determining whether there is a statistical difference between the prices hospitals charge Anthem, Harvard Pilgrim, and CIGNA in New Hampshire for the same service, with the context that Anthem (the largest commercial insurer) composes 39% of the commercial insurance market, Harvard Pilgrim 27%, and CIGNA (the smallest major commercial insurer) 20%. I estimate what percentage of the Medicare price each insurer pays on average using the following linear model:
$$y_{ijh} = \sum_{n \epsilon N} \gamma_n \left[{insurer_n}\right] + \delta_j + \lambda_h + \varepsilon_{ijh}$$

where $N$ is the set of private insurers (Anthem, Harvard Pilgrim, CIGNA), and ${insurer_n}$ is an indicator variable that takes on the value of 1 or 0. The omitted dummy is Medicare such that the coefficient $\gamma_n$ denotes the percentage of the medicare price insurer $n$ is estimated to pay, and the three resulting coefficients of the summation (one $\hat \gamma_i$for each insurer) are the primary coefficients of interest. The regression also includes procedure fixed effects $\delta_j$ and hospital fixed effects $\lambda_h$ so that the price for the same procedure at the same hospital can be compared among the commercial insurers. The error term is denoted by $\varepsilon_{ijh}$.

This analysis is only be able to evaluate whether there are consistent differences between the prices each insurer pays and reveal a possible correlation between the relative magnitudes of $\hat \gamma_n$ and the market share of insurer $i$. However, this estimation is unable to directly make any claims regarding the magnitude of the relationship between the market power of insurer $i$ and the price of procedure $j$ at hospital $h$, because I only have the state-wide market shares of each insurer. Ideally, I would know the market power of each insurer within hospital $h$'s market, and identify the relationship between the prices negotiated by insurer $i$ and hospital $h$ given insurer $i$'s market share in hospital $h$'s market. Nonetheless, in my analysis the relative magnitude of the coefficients $\hat \gamma_n$ and their statistical significance suggest the potential direction of this relationship. That is, each insurer's state-wide market share is known and can be ranked from largest to smallest, and a negative correlation between the size of the insurer's statewide market share and the magnitude of $\hat \gamma_n$ suggests that larger insurers may negotiate cheaper prices, potentially as a function of their market power.

As with the imperfect measure of insurer market share, I also am unable to obtain data on the precise market share of each hospital in the market for outpatient radiology services. However, I am able to construct a measure of the number of other hospitals present in hospital $h$'s market to serve as a proxy for market share and concentration. This method is of course imperfect because there may be several hospitals in the same market but one may perform significantly more outpatient radiology procedures than the others due to having a greater capacity, being more accessible by transit, or having a better reputation among other reasons. Nevertheless, I do not 

While the level of insurer competition in hospital $h$'s market is unknown, I am able to construct measures of hospital competition within each hospital's market. Thus, the second set of estimations concerns how the presence of other hospitals within each hospital's market relates to the price (as a percentage of the Medicare price) for a particular service that hospital $h$ negotiates with each insurer. Essentially, the hospital fixed effects variable Equation (2) is broken apart into various observable measures relating to a particular hospital and its market, resulting in the following linear model:
$$y_{ijh} = \sum_{n \epsilon N} \gamma_n \left[{insurer_n}\right] + \delta_j + \alpha m_h + \beta_1\eta_{jh} + \beta_2\vartheta_h + \beta_3 X_c + \varepsilon_{ijh}$$

where the summation of the insurer dummies and $\delta_j$ (procedure fixed effects) remain the same as in Equation (2); $m_h$ represents the number of hospitals in hospital $h$'s market; $\eta_{jh}$ denotes the typical patient complexity for procedure $j$ at hospital $h$; $\vartheta_h$ denotes overall hospital quality at hospital $h$ as provided through the CMS Hospital Compare data; and $X_c$ is a vector of county characteristics defined as follows:
$$X_c = {\mu_c, \rho_c, \phi_c}$$ 

where $\mu_c$ represents the median household income in the hospital's county $c$; $\rho_c$ represents the percentage of person's over 65 years of age in the hospital's county; and $\phi_c$ denotes the population density of the hospital's county. Data for $\mu_c$, $\rho_c$, and $\phi_c$ comes from the [2017 US Census](https://www.census.gov/quickfacts/fact/map/US/INC110217).

A hospital's market is defined differently across several specifications, resulting in different meanings of $m_h$ across different regressions. I first use two common definitions for a hospital's market in the literature: Hospital Service Area (HSA) and Hospital Referral Region (HRR), both defined and made publicly available by the [Dartmouth Atlas of Health Care](http://archive.dartmouthatlas.org/tools/downloads.aspx?tab=39). An HSA dilineates a local market for hospital care, composed of a collection of ZIP codes whose residents receive most of their hospitalizations from the hospitals in that area. For the most part, this calculation is based on assigning each ZIP code to the area where the greatest proportion of its Medicare patients were hospitalzed. Most HSAs contain only one hospital. An HRR dilineates regional health care markets for tertiary medical care and each contains at least one hospital that performs major cardiovascular procedures and neurosurgery. HRRs were largely defined by assigning HSAs to the region where the greatest proportion of major cardiovascular procedures were performed. My dataset contains 29 unique HSAs and 4 unique HRRs. 

For both the HSA and HRR market definitions, I count the total number of hospitals within each hospital's market as well as the number of hospitals that provide the same service/procedure within that market such that the market term in Equation (3) becomes $m_{jh}$. This attempts to isolate whether the hospital is truly competing with other hospitals in its market in providing procedure $j$ or whether it may be the only hospital in its market providing that service and therefore faces no competitors. While the 33 radiology services I have restricted my analysis to are quite common, I do not have at least one price observation available for all 33 procedures at all hospitals from the HealthCost data. Thus it is possible, though unlikely, that hospitals for which HealthCost does not have a price for a particular service may not offer that service, or provide it so infrequently that they do not really compete with other hospitals for its provision.  Most hospitals however do provide at least half of the services within the and there does not appear to be a consistent set of services for which price data is missing at many hospitals.

The second set of market definitions I use are based on geographical radii drawn around each hospital. As with the HSA/HRR market definitions, I count the total number of hospitals as well as the number of hospitals that also provide the same service/procedure within a 5 mile radius (local market) and a 25 mile radius (a broader market) of each hospital $h$. As the services being examined are all outpatient services, the HSA/HRR definitions may not truly capture the potential patient population and potential competitors because they are calculated on the basis of hospitalization (inpatient) events. For outpatient services, patients may be able to exercise more choice in which hospitals they go to and therefore place greater weight on convenience and distance to the hospital, so this radial measure of a hospital's market may be more applicable to consumers' choices in the outpatient setting.

The primary coefficient of interest in this second set of regressions is $\hat \alpha$ which estimates how hospital competition may be related to prices. If $\alpha$ is negative, this suggests that the more hospital competition there is within a hospital's market, the lower the prices or, alternatively, the greater market power a hospital has, the higher its prices.

The last regression I perform investigates whether hospital competition affects negotiated prices differently for different insurers. That is, one insurer may be more sensitive to the number of hospitals present in hospital $h$'s market because leveraging hospital competition is a more prominent strategy in their price negotiations. How well an insurer is able to leverage such information may in turn be a function of their own market share. Thus, the final regression equation is otherwise the same as Equation (3) but includes an interaction between the number of hospitals in hospital $h$'s market and an indicator for private insurer $n$:
$$y_{ijh} = \sum_{n \epsilon N} \gamma_n \left[{insurer_n}\right] + \delta_j + \alpha m_h + \sum_{n \epsilon N} \zeta_n (m_h *\left[{insurer_n}\right]) + \beta_1\eta_{jh} + \beta_2\vartheta_h + \beta_3 X_c + \varepsilon_{ijh}$$
The primary coefficient of interest is $\hat \zeta_n$ which estimates how the addition of one additional hospital to hospital $h$'s market affects the price negotiated with insurer $n$ for procedure $j$. The relative magnitudes of $\hat \zeta_n$ may indicate the ability of different insurers to leverage information on hospital competition in price negotiations.



# Results
The first set of results presented in Table 1 demonstrate that there are statistically significant differences in the prices paid by each insurer for a particular service at a particular hospital. The coefficients (presented as the average percentage of the Medicare price that insurer pays) suggest that on average Anthem pays 6.43 times the Medicare price, Harvard Pilgrim pays 7.04 times the Medicare price, and CIGNA 7.92 times the Medicare price. Alternatively, this means that Harvard Pilgrim pays on average 9.4% above Anthem's price and CIGNA 23.0% above Anthem's price.
```{r, echo=FALSE, results = "asis", fig.align='center', message=FALSE}

stargazer(lm_insurers2, lm_insurers3, header = FALSE,
          omit = c("provider_name", "procedure"), omit.labels = c("Hospital Fixed Effects", "Procedure Fixed Effects"),
          keep.stat = c("n", "rsq"),
          title = "Private Insurance Carrier and Relative Prices",
          covariate.labels = c("Anthem", "Harvard Pilgrim", "CIGNA"), 
          dep.var.labels = "Percent of Medicare Price", font.size = "footnotesize")

```
The positive direction of the coefficients is unsurprising as Medicare consistently reimburses providers at much lower rates than do private insurers; however the magnitude of the coefficients is somewhat large compared to prior literature, which usually finds private insurer rates to be somewhere betwee 150-200% of Medicare rates largely in the context of inpatient services. Nonetheless, the meaning of these results is not necessarily diminished. Among the inpatient services they examine, Cooper et al. (2015) find the greatest disparity in Medicare versus private reimbursement for lower limb MRIs, the only radiology service they consider (private insurers pay on average 4 times the Medicare price in their sample), so perhaps Medicare is particularly able to set low prices for radiology services given the low per-unit cost of radiology services. Additionally, the price data from HealthCost reflects "bundled" prices as detailed in the Data portion of this paper, so they may be somewhat inflated compared to the Medicare prices. Importantly however, HealthCost bundles payments in the same way across all three private insurers and therefore the variation in the prices paid by each insurer is unaffected by this imperfect standardization to the Medicare price.

While definitive conclusions about the effect of insurer market share cannot be made from these results given the limitations mentioned in the Empirical Approach, they do suggest that the larger the market share of the insurer, the more market power it is able to exert and the lower the prices that insurer pays at each hospital for a given procedure. Anthem, with the largest share of the market, pays less on average than both Harvard Pilgrim and CIGNA; Harvard Pilgrim, which is smaller than Anthem but bigger than CIGNA, pays somewhere between the Anthem and CIGNA price on average; and CIGNA, the smallest of the major insurers, consistently pays much more than both Anthem and Harvard Pilgrim.

The second set of results presented in Tables 2-5 suggest that the number of hospitals in a hospital's market is negatively related to price, and under certain definitions of a hospital's market, this relationship is negative at a statistically significant level. Tables 2 and 3 present the results where markets are defined at the hospital level by HSA/HRR or radius respectively. Tables 4 and 5 also present the results where markets are defined by HSA/HRR or radius respectively but at the hospital-procedure level. The negative effects of hospital density are generally more statistically significant a the hospital-procedure level. On the whole, these results suggest that, controlling for typical patient complexity, hospital quality, and county level characteristics, the greater the number of hospitals in a hospital's market, the lower the prices at that hospital are. Put alternatively, the greater a hospital's market power within a 25 mile radius market, the higher the prices at that hospital. 
```{r, echo=FALSE, results = "asis", message=FALSE}
stargazer(lm_hospitals1, lm_hospitals2, lm_hospitals5, lm_hospitals7, header = FALSE,
          omit = "procedure", omit.labels = "Procedure Fixed Effects",
          keep.stat = c("n", "rsq"),
          title = "Hospital Competition and Relative Price",
          covariate.labels = c("Total Hospitals in HSA",
                               "Total Hospitals in HRR",
                               "Total Hospitals in 5-mile radius",
                               "Total Hospitals in 25-mile radius",
                               "Typical Patient Complexity", 
                               "Hospital Quality",
                               "Median Income (1000s)",
                               "Percent Population 65 and older",
                               "Population Density",
                               "Anthem",
                               "Harvard Pilgrim",
                               "CIGNA"), 
          dep.var.labels = "Percent of Medicare Price", font.size = "footnotesize")

```

```{r, echo=FALSE, results = "asis", message=FALSE}

stargazer(lm_hospitals3, lm_hospitals4, lm_hospitals8, lm_hospitals10,
          header = FALSE,
          omit = "procedure", omit.labels = "Procedure Fixed Effects",
          add.lines = c("Procedure Fixed Effects"),
          keep.stat = c("n", "rsq"),
          title = "Hospital Competition by Procedure and Relative Price",
          covariate.labels = c("Hospitals in HSA w/ procedure",
                               "Hospitals in HRR w/ procedure",
                               "Hospitals in 5-mile radius w/ procedure",
                               "Hospitals in 25-mile radius w/ procedure",
                               "Typical Patient Complexity", 
                               "Hospital Quality",
                               "Median Income (1000s)",
                               "Percent Population 65 and older",
                               "Population Density",
                               "Anthem",
                               "Harvard Pilgrim",
                               "CIGNA"), 
          dep.var.labels = "Percent of Medicare Price", font.size = "footnotesize")


```

The HSA coefficients and the 5-mile radius coefficients are identical within each specification as there were no hospitals for which the number of hospitals within the market differed between the HSA and 5-mile radius definitions. This speaks to the fact that especially for basic health needs, many patients choose which hospital to go to based on proximity. The effects of hospital density become significant in these local markets only when considering competition at the hospital-procedure level, but they suggest that the addition of one more hospital to hospital $h$'s local market is associated with a 43% decrease in prices for procedure $j$, which can have a huge impact on patients' out-of-pocket spending. 

The coefficient on the number of hospitals within a hospital's HRR is not ever statistically significant at the 5% level but does remain consistently negative. In contrast, the coefficient on the number of hospitals within a 25-mile radius of hospital $h$ is large and statistically significant in both specifications; the addition of one hospital to hospital $h$'s broader market (defined by radial distance) is associated with a 32% decrease in average hospital prices at hospital $h$ and a 24% decrease in prices for procedure $j$ at hospital $h$. The difference in both the significance and magnitude of these two measures may be attributed to the fact that for basic primary care services, such as outpatient radiology services, the HRR definition of a hospital's market is not very applicable as HRRs attempt to capture the markets for tertiary (more specialized or involved) care. Rather, what may be most important to patients is how far the hospital is from their home or work, and a 25 mile radius equates to roughly a 30-45 minute drive in most parts of New Hampshire, which means it is likely that many of a hospital's patients could live and/or work within that radius.

In addition the the variables concerned with the hospitals' market share, the control variables also provide some interesting coefficients. The measures of typical patient complexity are somewhat convoluted as the omitted dummy variable is for high typical patient complxity. There are only four hospital-procedure observations for which typical patient complexity is categorized as low while there are at least several hundred hospital-procedure observations for medium and high typical patient complexities. Therefore, while the coefficient on "Typical Patient Complexity - Low" is statistically zero, the negative coefficient on "Typical Patient Complexity - Medium" is intuitive in that relative to hospital-procedure pairings that are high typical complexity, the price when the typical complexity is more average is lower. Hospital quality, after controlling for other hospital characteristics is consistently statistically equivalent to zero, which is in line with my theoretical framework that quality has little to do with prices, especially in the context of radiology services where quality is plausibly constant across providers. The median household income of the county in which the hospital is associated is unsurprisingly positively associated with hospital prices. However, the controls for the percent of the population 65 and older and population density are consistently statistically significant and negative. This suggests that prices are lower when a larger portion of the population is 65 and older and as areas are more densely populated (still controlling for income), perhaps because more patients requiring more care more often may encourage hospital competition through being more price sensitive.

The last set of results presented in Tables 4 and 5 suggests that the prices Harvard Pilgrim negotiates with hospitals is much more often related to the number of hospital's in that hospitals market than for Anthem and CIGNA. Similar to the second set of regressions above, these effects are strongest when considering the market at the hospital-procedure level and within a 25-mile radius. The prices negotiated with Anthem also demonstrate a negative relationship to hospital competition but only at the 25-mile radius definition and only statistically significant level at the hospital-procedure level definition.
```{r, echo=FALSE, results = "asis", message=FALSE}
stargazer(lm_hospitals_insurers_3, lm_hospitals_insurers_4,
          omit = "procedure", omit.labels = "Procedure Fixed Effects",
          keep.stat = c("n", "rsq"),
          order = c("n_hosp_5mi_total:Anthem_NH", "n_hosp_5mi_total:Harvard_Pilgrim_HC", "n_hosp_5mi_total:CIGNA", "n_hosp_5mi_total",
                    "n_hosp_25mi_total:Anthem_NH", "n_hosp_25mi_total:Harvard_Pilgrim_HC", "n_hosp_25mi_total:CIGNA", "n_hosp_25mi_total",
                    "typical_patient_complexity_scale", "`Hospital Quality`", "median_household_income", "percent_pop_over65", "pop_density",
                    "Anthem_NH", "Harvard_Pilgrim_HC", "CIGNA", "Constant"),
          title = "Total Hospital Competition by Insurer and Relative Price",
          covariate.labels = c("Total Hospitals in 5-mile radius x Anthem",
                               "Total Hospitals in 5-mile radius x Harvard Pilgrim",
                               "Total Hospitals in 5-mile radius x CIGNA",
                               "Total Hospitals in 5-mile radius",
                               "Total Hospitals in 25-mile radius x Anthem",
                               "Total Hospitals in 25-mile radius x Harvard Pilgrim",
                               "Total Hospitals in 25-mile radius x CIGNA",
                               "Total Hospitals in 25-mile radius",
                               "Typical Patient Complexity", 
                               "Hospital Quality",
                               "Median Income (1000s)",
                               "Percent Population 65 and older",
                               "Population Density",
                               "Anthem",
                               "Harvard Pilgrim",
                               "CIGNA"), 
          dep.var.labels = "Percent of Medicare Price", font.size = "scriptsize")
```

```{r, echo=FALSE, results = "asis", message=FALSE}
stargazer(lm_hospitals_insurers_1, lm_hospitals_insurers_2,
          omit = "procedure", omit.labels = "Procedure Fixed Effects",
          keep.stat = c("n", "rsq"),
          order = c("n_hosp_5mi_p:Anthem_NH", "n_hosp_5mi_p:Harvard_Pilgrim_HC", "n_hosp_5mi_p:CIGNA", "n_hosp_5mi_p",
                    "n_hosp_25mi_p:Anthem_NH", "n_hosp_25mi_p:Harvard_Pilgrim_HC", "n_hosp_25mi_p:CIGNA", "n_hosp_25mi_p",
                    "typical_patient_complexity_scale", "`Hospital Quality`", "median_household_income", "percent_pop_over65", "pop_density",
                    "Anthem_NH", "Harvard_Pilgrim_HC", "CIGNA", "Constant"),
          title = "Hospital Competition by Procedure and Insurer and Relative Price",
          covariate.labels = c("Hospitals in 5-mile radius w/ procedure x Anthem",
                               "Hospitals in 5-mile radius w/ procedure x Harvard Pilgrim",
                               "Hospitals in 5-mile radius w/ procedure x CIGNA",
                               "Hospitals in 5-mile radius w/ procedure",
                               "Hospitals in 25-mile radius w/ procedure x Anthem",
                               "Hospitals in 25-mile radius w/ procedure x Harvard Pilgrim",
                               "Hospitals in 25-mile radius w/ procedure x CIGNA",
                               "Hospitals in 25-mile radius w/ procedure",
                               "Typical Patient Complexity", 
                               "Hospital Quality",
                               "Median Income (1000s)",
                               "Percent Population 65 and older",
                               "Population Density",
                               "Anthem",
                               "Harvard Pilgrim",
                               "CIGNA"), 
          dep.var.labels = "Percent of Medicare Price", font.size = "scriptsize")
```


# Discussion
The results as a whole suggest that the market power of insurers and hospitals may be related to the prices hospitals and insurers negotiate as the theoretical framework would predict. That is, the insurers and hospitals with the greatest market shares are able to negotiate the most favorable prices; for the insurers, the expectation is that they want to pay the lowest prices possible, and for the hospitals, it is assumed that they want to receive the highest prices possible. 

However, there are several key limitations of this analysis in addition to the few that have been mentioned above. Namely, the analysis is limited by the lack of granularity of the data. First, the insurers' market share is only available at the state-level and therefore it cannot be explored whether the market power of each insurer within each hospital's market affects negotiated prices. Next, the hospital's true market share is also unknown as I do not have volume data for each hospital for each service, and I also do not have data on the variation of this volume across different insurers. One hospital may serve many more Medicare patients or Anthem patients than another, but this cannot be accounted for in my analysis. Lastly, the availability of price data is very limited and somewhat aggregated. I restrict my analysis only to outpatient radiology services in order to plausibly control for cost and quality both within and across hospitals, but the results may not extend to other forms of hospital care.



# Conclusion
Despite the limitations of this analysis, both sets of results (insurer and hospital level) suggest that private insurers and hospitals with greater market shares are able to negotiate more favorable prices for themselves. This implies that prices are lower for the insurer with a greater market share and at the hospital with a smaller market share. Thus, taken at face value, policy aimed at lowering hospital prices should either aim to increase the market power of insurers or to increase hospital competition. 



# References
[Organization for Economic Cooperation and Development, “Health at a Glance: OECD Indicators 2017,” (2017).](https://www.oecd.org/unitedstates/Health-at-a-Glance-2017-Key-Findings-UNITED-STATES.pdf)

[Etehad, Melissa, and Kyle Kim, “The U.S. spends more on healthcare than any other country — but not with better health outcomes,” in Los Angeles Times, (Los Angeles: Los Angeles Times, July 18, 2017).](https://www.latimes.com/nation/la-na-healthcare-comparison-20170715-htmlstory.html)

[Reinhardt, Uwe E., Peter S. Hussey, and Gerard F. Anderson, “U.S. Health Care Spending In An International Context,” Health Affairs, 23 (2004), 10-25.](https://www.healthaffairs.org/doi/10.1377/hlthaff.23.3.10)

[Anderson, Gerard F., Uwe E. Reinhardt, Peter S. Hussey, and Varduhi Petrosyan, “It’s the prices, stupid: why the United States is so different from other countries,” Health Affairs, 22 (2003), 89-105.](https://www.healthaffairs.org/doi/10.1377/hlthaff.22.3.89)

[Papanicolas, Irene, Liana R. Woskie, and Ashish K. Jsa, “Health Care Spending in the United States and Other High-Income Countries,” JAMA, 319 (2018), 1024-1039.](https://jamanetwork-com.ezp-prod1.hul.harvard.edu/journals/jama/fullarticle/2674671)

[Centers for Disease Control and Prevention, “Table 94. National health expenditures, average annual percent change, and percent distribution, by type of expenditure: United States, selected years 1960–2016,” (2017).](https://www.cdc.gov/nchs/data/hus/2017/094.pdf)

[Cooper, Zack, Stuart V. Craig, Martin Gaynor, and John Van Reenen, “The Price Ain’t Right? Hospital Prices and Health Spending on the Privately Insured,” NBER Working Paper Series, No. 21815 (2015, revised 2018).](https://search-proquest-com.ezp-prod1.hul.harvard.edu/docview/1750422773?accountid=11311&rfr_id=info%3Axri%2Fsid%3Aprimo)

[Bai, Ge, and Gerard F. Anderson, “Market Power: Price Variation Among Commercial Insurers For Hospital Services,” Health Affairs, 37 (2018), 1615-1622.](https://www-healthaffairs-org.ezp-prod1.hul.harvard.edu/doi/10.1377/hlthaff.2018.0567)

[State Health Facts - Health Insurance Coverage of the Total Population 2017, Kaiser Family Foundation.](https://www.kff.org/other/state-indicator/total-population/?currentTimeframe=0&sortModel=%7B% 22colId%22:%22Location%22,%22sort%22:%22asc%22%7D) 

[Gowrisankaran, Guatam, Aviv Nevo, and Robert Town, “Mergers When Prices Are Negotiated: Evidence from the Hospital Industry,” American Economic Review, 105 (2015), 172-203.](https://pubs-aeaweb-org.ezp-prod1.hul.harvard.edu/doi/pdfplus/10.1257/aer.20130223)

[Ho, Kate, and Robin S. Lee, “Insurer Competition in Health Care Markets,” Econometrica, 85 (2017), 379-417.](https://onlinelibrary-wiley-com.ezp-prod1.hul.harvard.edu/doi/epdf/10.3982/ECTA13570)

[Reinhardt, Uwe E., “The Pricing Of U.S. Hospital Services: Chaos Behind A Veil Of Secrecy,” Health Affairs, 25 (2006), 57-69.](https://www.healthaffairs.org/doi/10.1377/hlthaff.25.1.57)

[Horwitz, Jill R., “Making Profits And Providing Care: Comparing Nonprofit, For-Profit, And Government Hospitals,” Health Affairs, 24 (2005), 790-801.](https://www.healthaffairs.org/doi/10.1377/hlthaff.24.3.790)

[Gaynor, Martin, Kate Ho, and Robert J. Town, “The Industrial Organization of Health-Care Markets,” Journal of Economic Literature, 53 (2015), 235-284.](https://www-aeaweb-org.ezp-prod1.hul.harvard.edu/articles?id=10.1257/jel.53.2.235)

[Dafny, Leemore, Kate Ho, and Robin S. Lee, “The Price Effects of Cross-Market Hospital Mergers,” NBER Working Paper Series, No. 22106 (2016).](https://www-nber-org.ezp-prod1.hul.harvard.edu/papers/w22106)

[Frakt, Austin B., “How Much Do Hospitals Cost Shift? A Review of the Evidence,” The Millbank Quarterly, 89 (2011), 90-130.](https://www-jstor-org.ezp-prod1.hul.harvard.edu/stable/23036197?seq=1#metadata_info_tab_contents)

[White, Chapin, “Contrary To Cost-Shift Theory, Lower Medicare Hospital Payment Rates For Inpatient Care Lead To Lower Private Payment Rates,” Health Affairs, 32 (2013), 935-943.](https://www-healthaffairs-org.ezp-prod1.hul.harvard.edu/doi/10.1377/hlthaff.2012.0332)

[QuickFacts - New Hampshire Population Estimates July 1, 2017, United States Census Bureau](https://www.census.gov/quickfacts/nh).

[New Hampshire Insurance Department, “Preliminary Report of the 2016 Health Care Premium and Claim Cost Drivers,” (2017).](https://www.cdc.gov/nchs/data/hus/2017/094.pdf)

[Map of Hospitals - New Hampshire Acute Care Hospitals, New Hampshire Hospital Association](https://nhha.org/index.php/nh-hospitals/map-of-hospitals).

[Critical Access Hospitals (CAHs), Rural Health Information Hub, 2018](https://www.ruralhealthinfo.org/topics/critical-access-hospitals)

