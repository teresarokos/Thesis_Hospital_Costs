---
header-includes:
    - \usepackage{setspace}\doublespacing
    - \usepackage{amsmath}
    - \renewcommand{\thesection}{\Roman{section}} 
    - \renewcommand{\thesubsection}{\thesection.\Roman{subsection}}
    - \usepackage{dcolumn}
output:
  pdf_document:
    number_sections: true
geometry: "left=1.5in, right=1in, top=1in, bottom=1in"
fontsize: 12pt
---


```{r child = 'title_page.Rmd'}
```

\newpage
\pagenumbering{gobble}
```{r, include=FALSE}
library(knitr)
library(tidyverse)
library(fs)
library(readxl)
library(janitor)
library(scales)
library(ggthemes)
library(stringi)
library(stargazer)
library(ggplot2)
library(ggmap)
library(maps)
library(mapdata)
library(plotly)
library(foreign)
library(purrr)
library(ggrepel)
library(lfe)
```

```{r, include=FALSE}

# Constructing data set from raw NH HealthCost data ###########################################################################################################
merge_sheets <- function(x) {
 bind_rows(
   x %>%
      excel_sheets() %>%
      set_names() %>% 
      purrr::map(read_excel, path = x), .id = "Insurer") %>% 
    mutate(procedure = x)
}

primary_data <- data.frame(Insurer = character(), procedure = character())

file_names <- dir_ls("NH_HealthCost_data/")


for (n in file_names) {
  primary_data <- primary_data %>% 
    bind_rows(merge_sheets(n))
}

primary_data <- primary_data %>% 
  mutate(procedure = str_remove_all(procedure, "NH_HealthCost_data/"),
         procedure = str_remove_all(procedure, ".xlsx")) %>% 
  separate(procedure, into = c("CPT_code", "procedure"), sep = " ", extra = "merge")

primary_data <- clean_names(primary_data, case = "snake")

primary_data <- primary_data %>% 
  rename(provider_name = provider_name_compare_selected) %>% 
  mutate(estimate_of_total_cost = case_when(is.na(estimate_of_total_cost) ~ estimate_of_procedure_cost,
                                            !is.na(estimate_of_total_cost) ~ estimate_of_total_cost),
         insurer = str_replace_all(insurer, "None", "Uninsured"),
         provider_name = str_remove(provider_name, "Compare ")) %>% 
  separate(provider_name, sep = " ", into = c("one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten", "eleven")) %>%
  select(-estimate_of_procedure_cost, -six, -eight, -ten) %>% 
  mutate(two = case_when(!is.na(four) ~ two),
         three = case_when(!(!is.na(two) & is.na(seven)) ~ three),
         four = case_when(!is.na(three) ~ four),
         four = case_when(!(!is.na(three) & is.na(nine)) ~ four),
         five = case_when(!(!is.na(three) & is.na(four)) ~ five),
         five = case_when(!(!is.na(four) & is.na(eleven)) ~ five),
         seven = case_when(!(!is.na(four) & is.na(five)) ~ seven),
         seven = case_when(!(!is.na(five) & !is.na(eleven)) ~ seven),
         nine = case_when(!(is.na(seven) & !is.na(eleven)) ~ nine)) %>% 
  unite("provider_name", c("one", "two", "three", "four", "five", "seven", "nine", "eleven"), sep = " ") %>% 
  mutate(provider_name = str_remove_all(provider_name, " NA"),
         locality = case_when(provider_name %in% c("Northeastern Vermont Regional Hospital", "Springfield Medical Care System") ~ "VERMONT",
                              provider_name %in% c("Orthopaedic Surgical Associates", "Northeast Endoscopy Center", "Lowell General Hospital",
                                                   "Lahey Health", "Orthopaedic Northeast", "Steward Medical Group", "Lawrence General Hospital", 
                                                   "Merrimack Valley Endoscopy Center", "Anna Jaques Hospital") ~ "METROPOLITAN BOSTON, MA",
                              provider_name %in% c("Bridgton Hospital", "York Hospital") ~ "SOUTHERN MAINE",
                              TRUE ~ "NEW HAMPSHIRE"),
         provider_name = str_replace_all(provider_name, "Lakes Region General Healthcare", "Lakes Region General Hospital"),
         provider_name = str_replace_all(provider_name, "LRGHealthcareLRGHealthcare", "LRGHealthcare"),
         provider_name = str_replace_all(provider_name, "Dartmouth-Hitchcock Clinic", "Dartmouth-Hitchcock (Manchester)"))
###############################################################################################################################################################


# Constructing Medicare prices and adding to primary data set
primary_data <- read_xlsx("RVU18A_files/PPRRVU18_JAN_mod.xlsx", skip = 9, col_names = TRUE) %>% 
  rename(cpt_code = HCPCS) %>% 
  filter(cpt_code %in% c(primary_data$cpt_code, 
                         "29806", "29807", "29819", "29820", "29821", "29822", "29823", "29824", "29825",
                         "29873", "29874", "29875", "29876", "29877", "29879", "29880", "29881",
                         "45384",
                         "71045", "71046", "71047", "71048",
                         "72050",
                         "72072", "72074",
                         "74018", "74019", "74021"), is.na(MOD)) %>% 
  select(cpt_code, DESCRIPTION, WorkRVU = RVU, FacilityPERVU = `PE RVU__1`, MPRVU = RVU__1, ConversionFactor = FACTOR) %>% 
  mutate(cpt_code = case_when(DESCRIPTION == "Shoulder arthroscopy/surgery" ~ "29826",
                              DESCRIPTION == "Knee arthroscopy/surgery" ~ "29881",
                              DESCRIPTION == "Colonoscopy w/lesion removal" ~ "45385",
                              DESCRIPTION %in% c("X-ray exam chest 1 view", "X-ray exam chest 2 views", 
                                                 "X-ray exam chest 3 views", "X-ray exam chest 4+ views") ~ "71020",
                              DESCRIPTION %in% c("X-ray exam neck spine 2-3 vw", "X-ray exam neck spine 4/5vws") ~ "72040",
                              DESCRIPTION %in% c("X-ray exam abdomen 1 view", "X-ray exam abdomen 2 views", "X-ray exam abdomen 3+ views") ~ "74000",
                              DESCRIPTION %in% c("X-ray exam thorac spine 2vws", "X-ray exam thorac spine 3vws", "X-ray exam thorac spine4/>vw") ~ "72070",
                              TRUE ~ cpt_code),
         DESCRIPTION = case_when(cpt_code == "71020" ~ "X-ray exam chest",
                                 cpt_code == "72040" ~ "X-ray exam neck spine",
                                 cpt_code == "74000" ~ "X-ray exam abdomen",
                                 cpt_code == "72070" ~ "X-ray exam thorac spine",
                                 TRUE ~ DESCRIPTION)) %>% 
  group_by(cpt_code, DESCRIPTION) %>% 
  summarize(WorkRVU = mean(WorkRVU), FacilityPERVU = mean(FacilityPERVU), MPRVU = mean(MPRVU), ConversionFactor = mean(ConversionFactor)) %>% 
  ungroup() %>% 
  right_join(primary_data,  by = "cpt_code")

primary_data <- read_xlsx("RVU18A_files/GPCI2018_copy.xlsx", skip = 2, col_names = TRUE) %>% 
  rename(locality = X__3) %>% 
  filter(locality %in% c("NEW HAMPSHIRE", "SOUTHERN MAINE", "METROPOLITAN BOSTON, MA", "REST OF MASSACHUSETTS", "VERMONT")) %>% 
  select(locality, WorkGPCI = `PW GPCI`, PEGPCI = `PE GPCI`, MPGPCI = `MP GPCI`) %>% 
  right_join(primary_data, by = "locality") %>% 
  mutate(Medicare = ((WorkRVU * WorkGPCI) + (FacilityPERVU * PEGPCI) + (MPRVU * MPGPCI)) * ConversionFactor, medicare_price = Medicare) %>% 
  select(cpt_code, procedure, provider_name, locality, insurer, estimate_of_total_cost, Medicare, medicare_price, precision_of_the_cost_estimate, 
         typical_patient_complexity, uninsured_discount)

primary_data <- primary_data %>% 
  count(cpt_code, procedure, provider_name, locality, typical_patient_complexity, Medicare, medicare_price) %>% 
  mutate(typical_patient_complexity = case_when(provider_name == "Access Sports Medicine & Orthopaedics" ~ " MEDIUM",
                                                provider_name == "Cheshire Medical Center" ~ " MEDIUM",
                                                provider_name == "Lakes Region General Hospital" ~ " MEDIUM",
                                                TRUE ~ typical_patient_complexity)) %>% 
  count(cpt_code, procedure, provider_name, locality, typical_patient_complexity, Medicare, medicare_price) %>% 
  select(-nn) %>% 
  gather(Medicare, key = insurer, value = estimate_of_total_cost) %>% 
  bind_rows(primary_data) %>% 
  filter(!cpt_code %in% c("29881", "45380", "45385", "85027")) %>%  # only looking at radiology services or top 10 procedures
  select(-Medicare)

# Adding in Hospital Compare data for quality measures
primary_data <- read_csv("Hospital_Compare_data/Hospital_General_Information_copy.csv") %>% 
  filter(State %in% c("VT", "NH", "ME", "MA")) %>% 
  mutate(provider_name = str_to_title(`Hospital Name`)) %>% 
  filter(`Provider ID` != "200001") %>% 
  mutate(provider_name = str_replace_all(provider_name, "Exeter Hospital Inc","Exeter Hospital"), 
         provider_name = str_replace_all(provider_name, "Memorial Hospital, The","Memorial Hospital"), 
         provider_name = str_replace_all(provider_name, "Southern Nh Medical Center", "Southern NH Medical Center"),
         provider_name = str_replace_all(provider_name, "St Joseph Hospital", "St. Joseph Hospital")) %>% 
  right_join(primary_data, by = "provider_name") %>% 
  mutate(`Hospital Type` = case_when(is.na(`Hospital Type`) ~ "Non-Hospital Providers",
                                     TRUE ~ `Hospital Type`),
         `Hospital overall rating` = case_when(provider_name == "Alice Peck Day Memorial Hospital" ~ "3",
                                              TRUE ~ `Hospital overall rating`),
         `Hospital overall rating footnote` = case_when(provider_name == "Alice Peck Day Memorial Hospital" ~ "2017 rating",
                                                        TRUE ~ `Hospital overall rating footnote`)) %>% 
  select(-`Hospital Name`, -Address, -`Phone Number`, -11, -12, -15:-28)

# Hospital and ambulatory center latitude and longitude
primary_data <- read_csv("provider_coordinates.csv") %>% 
  right_join(primary_data, by = "provider_name")

# The number of other hospitals in each hospital's market
# First adding info on each hospital's hsa and hrr from 2016 dartmouth atlas zipcode to HSA/HRR crosswalk
primary_data <- read_csv("ZipHsaHrr16.csv") %>% 
  filter(hsastate %in% c("NH", "MA", "ME", "VT")) %>% 
  rename(`ZIP Code` = zipcode16) %>%
  right_join(primary_data, by = "ZIP Code")

# Counting number of hospitals within HSA/HRR that also offer that procedure
primary_data <- primary_data %>% 
  filter(!is.na(`ZIP Code`)) %>% 
  count(provider_name, procedure, hsanum, hrrnum) %>% 
  group_by(procedure, hsanum) %>% 
  mutate(n_hosp_hsa_p = n()) %>% 
  ungroup() %>% 
  group_by(procedure, hrrnum) %>% 
  mutate(n_hosp_hrr_p = n()) %>% 
  ungroup() %>% 
  select(-n, -hsanum, -hrrnum) %>% 
  right_join(primary_data, by = c("provider_name", "procedure"))

# Counting number of total hospitals in HSA/HRR
primary_data <- primary_data %>% 
  filter(!is.na(`ZIP Code`)) %>% 
  count(provider_name, hsanum, hrrnum) %>% 
  group_by(hsanum) %>% 
  mutate(n_hosp_hsa_total = n()) %>% 
  ungroup() %>% 
  group_by(hrrnum) %>% 
  mutate(n_hosp_hrr_total = n()) %>% 
  ungroup() %>% 
  select(-n, -hsanum, -hrrnum) %>% 
  right_join(primary_data, by = "provider_name")

# Next, I want to calculate the distance of every hospital to every other hospital and define the markets as certain radius

# Counting number of hospitals that also offer that procedure

  # Creating an empty data frame for loop to add to
  # Contains the distance between each hospital pair present in my data (later narrow down to hospitals that are 5 or 25mi apart)
      radial_markets_procedure <- data.frame(provider1 = character(), procedure = character(), provider2  = character(), 
                                            distance = double(), 
                                            hospital_type1 = character(), hospital_type2 = character(), 
                                            hospital_rating1 = character(), hospital_rating2 = character())
  
  # Create a data set containing every provider and its coordinates, as well as the provider type and overall rating (hospitals only)    
      provider_coordinates <- primary_data %>% 
        count(provider_name, lat, long, `Hospital Type`, `Hospital overall rating`) %>% # one observation per hospital
        select(-n) %>% 
        mutate(lat = (lat*pi)/180, long = (long*pi)/180) # converting latitude and longitude to radians
      
  # Creating a loop that will compute the distance between every hospital in the data set
      for (i in provider_coordinates$provider_name) { # hospitals and corresponding coordinates taken 
      
        # Creating a data set of the procedures offered at hospital i (at least one contract with a private insurer for that procedure)
          provider_procedure <- primary_data %>% 
            count(provider_name, procedure) %>%
            select(-n) %>% 
            filter(provider_name == i)
        
        # Isolating the coordinates, hospital type, and hospital overall rating for the particular hospital i  
          provider <- provider_coordinates %>% 
            filter(provider_name == i)
        
        # Assigning each value in the one row data set to an object to be referenced in the next step
          provider1 <- provider$provider_name
          lat1 <- provider$lat
          long1 <- provider$long
          hospital_type1 <- provider$`Hospital Type`
          hospital_rating1 <- provider$`Hospital overall rating`
          
        # Creating a data set that contains all hospital pairings that are less than or equal to 25 miles apart and offer the same procedure
          radial_markets_procedure <- primary_data %>% 
            count(provider_name, procedure, lat, long, `Hospital Type`, `Hospital overall rating`) %>% # one observation per provider-procedure combination
            select(-n) %>% 
            mutate(lat = (lat*pi)/180, long = (long*pi)/180) %>% # converting latitude and longitude to radians
            filter(procedure %in% provider_procedure$procedure) %>% # selecting only hospitals that offer at least one of the same procedures as hospital i
            rename(provider2 = provider_name, lat2 = lat, long2 = long, hospital_type2 = `Hospital Type`, 
                   hospital_rating2 = `Hospital overall rating`) %>% # all of this data is relevant to the hospitals surrounding hospital i
            mutate(provider1 = provider1, # name of hospital i (all values in column the same)
                   lat1 = lat1, long1 = long1, # coordinates of hospital i (all values in each column the same)
                   hospital_type1 = hospital_type1,
                   hospital_rating1 = hospital_rating1,
                   dLat = (lat2 - lat1), dLong = (long2 - long1), # calculating distance in radians between latitude and longitude
                   a = (sin(dLat/2)^2) + (cos(lat1) * cos(lat2) * sin(dLong/2)^2),
                   c = 2 * atan2(sqrt(a), sqrt(1 - a)), 
                   distance = 3959*c) %>% # converting this distance to miles (3959mi is the radius of the Earth)
            filter(distance <= 25) %>% # filtering only for relevant hospital pairings (those that are potential competitors)
            select(provider1, procedure, provider2, distance, hospital_type1, hospital_type2, hospital_rating1, hospital_rating2) %>% 
            bind_rows(radial_markets_procedure) # adding data for each hospital i containing the distance between it and each hospital offering that procedure
      
      }
    
    # Counting number of hospitals that also offer procedure (both providers are hospitals)
        # Using the data set created by the loop above I count how many hospitals within a 25mi radius of each also offer the same procedure
          primary_data <- radial_markets_procedure %>%
            filter(hospital_type1 != "Non-Hospital Providers", hospital_type2 != "Non-Hospital Providers") %>% 
            group_by(provider1, procedure) %>% 
            summarize(n_hosp_25mi_p = n()) %>% # counting the number of hospitals that also offer that procedure within a 25mi radius
            ungroup() %>% 
            rename(provider_name = provider1) %>% 
            right_join(primary_data, by = c("provider_name", "procedure")) # adding this as a column to my primary data
          
        # Same idea as the code above, just restricted to hospitals within a 10mi radius 
          primary_data <- radial_markets_procedure %>% 
            filter(hospital_type1 != "Non-Hospital Providers", hospital_type2 != "Non-Hospital Providers", distance <= 10) %>% 
            group_by(provider1, procedure) %>% 
            summarize(n_hosp_10mi_p = n()) %>% 
            ungroup() %>% 
            rename(provider_name = provider1) %>% 
            right_join(primary_data, by = c("provider_name", "procedure")) # adding this as another column to my primary data
          
        # Same idea as the code above, just restricted to hospitals within a 5mi radius   
          primary_data <- radial_markets_procedure %>% 
            filter(hospital_type1 != "Non-Hospital Providers", hospital_type2 != "Non-Hospital Providers", distance <= 5) %>% 
            group_by(provider1, procedure) %>% 
            summarize(n_hosp_5mi_p = n()) %>% 
            ungroup() %>% 
            rename(provider_name = provider1) %>% 
            right_join(primary_data, by = c("provider_name", "procedure"))
          
    # Now counting all providers that also offer that procedure
        # Counting all providers within a 25mi radius of each also offer the same procedure
          primary_data <- radial_markets_procedure %>%
            group_by(provider1, procedure) %>% 
            summarize(n_provider_25mi_p = n()) %>% # counting the number of providers that also offer that procedure within a 25mi radius
            ungroup() %>% 
            rename(provider_name = provider1) %>% 
            right_join(primary_data, by = c("provider_name", "procedure")) # adding this as a column to my primary data
          
        # Same idea as the code above, just restricted to hospitals within a 10mi radius 
          primary_data <- radial_markets_procedure %>% 
            filter(distance <= 10) %>% 
            group_by(provider1, procedure) %>% 
            summarize(n_provider_10mi_p = n()) %>% 
            ungroup() %>% 
            rename(provider_name = provider1) %>% 
            right_join(primary_data, by = c("provider_name", "procedure")) # adding this as another column to my primary data
          
        # Same idea as the code above, just restricted to hospitals within a 5mi radius   
          primary_data <- radial_markets_procedure %>% 
            filter(distance <= 5) %>% 
            group_by(provider1, procedure) %>% 
            summarize(n_provider_5mi_p = n()) %>% 
            ungroup() %>% 
            rename(provider_name = provider1) %>% 
            right_join(primary_data, by = c("provider_name", "procedure"))

# Counting total number of hospitals
    radial_markets <- data.frame(provider1 = character(), provider2  = character(), 
                                          distance = double(), 
                                          hospital_type1 = character(), hospital_type2 = character(), 
                                          hospital_rating1 = character(), hospital_rating2 = character())
    
    provider_coordinates <- primary_data %>% 
      count(provider_name, lat, long, `Hospital Type`, `Hospital overall rating`) %>% 
      select(-n) %>% 
      mutate(lat = (lat*pi)/180, long = (long*pi)/180)
    
    for (i in provider_coordinates$provider_name) {
    
    provider <- provider_coordinates %>% 
      filter(provider_name == i)
    
    provider1 <- provider$provider_name
    lat1 <- provider$lat
    long1 <- provider$long
    hospital_type1 <- provider$`Hospital Type`
    hospital_rating1 <- provider$`Hospital overall rating`
    
    radial_markets <- provider_coordinates %>% 
      rename(provider2 = provider_name, lat2 = lat, long2 = long, hospital_type2 = `Hospital Type`, 
             hospital_rating2 = `Hospital overall rating`) %>% 
      mutate(provider1 = provider1,
             lat1 = lat1, long1 = long1, 
             hospital_type1 = hospital_type1,
             hospital_rating1 = hospital_rating1,
             dLat = (lat2 - lat1), dLong = (long2 - long1), 
             a = (sin(dLat/2)^2) + (cos(lat1) * cos(lat2) * sin(dLong/2)^2),
             c = 2 * atan2(sqrt(a), sqrt(1 - a)), 
             distance = 3959*c) %>% 
      filter(distance <= 25) %>% 
      select(provider1, provider2, distance, hospital_type1, hospital_type2, hospital_rating1, hospital_rating2) %>% 
      bind_rows(radial_markets)
    
    }
      
    primary_data <- radial_markets %>% 
      filter(!is.na(hospital_rating2)) %>% 
      group_by(provider1) %>% 
      summarize(n_hosp_25mi_total = n()) %>% 
      ungroup() %>% 
      rename(provider_name = provider1) %>% 
      right_join(primary_data, by = "provider_name")
    
    primary_data <- radial_markets %>% 
      filter(!is.na(hospital_rating2), distance <= 10) %>% 
      group_by(provider1) %>% 
      summarize(n_hosp_10mi_total = n()) %>% 
      ungroup() %>% 
      rename(provider_name = provider1) %>% 
      right_join(primary_data, by = "provider_name")
    
    primary_data <- radial_markets %>% 
      filter(!is.na(hospital_rating2), distance <= 5) %>% 
      group_by(provider1) %>% 
      summarize(n_hosp_5mi_total = n()) %>% 
      ungroup() %>% 
      rename(provider_name = provider1) %>% 
      right_join(primary_data, by = "provider_name")


# Top CPT codes from NH Hospital Association
top_10_cpt_codes <- read_xlsx("NHA_top_cpt_codes.xlsx", col_names = TRUE) %>% 
  filter(!is.na(`CPT Code`)) %>% 
  gather(-`CPT Code`, -Description, key = hospital, value = avg_price) %>% 
  filter(!is.na(avg_price)) %>% 
  group_by(`CPT Code`, Description) %>% 
  summarize(avg_price_nh = mean(avg_price)) %>% 
  arrange(desc(avg_price_nh)) %>% 
  filter(Description %in% c("ARTHROSCOPY SHOULDER DECOM", "TONSILLECTOMY&ADNOIDECTOMY:UNDER AGE 12", "UPPER GI ENDOSCOPY, BIOPSY", 
                            "DIAGNOSTIC COLONOSCOPY", "CT BRAIN ‐ W/OUT CONTRAST", "PELVIC ULTRASOUND ‐ NON OBGYN ( NON PREGNANCY)", 
                            "VAGINAL ULTRASOUND ‐ NON OBGYN (NON PREGNANCY)", "ED VISIT‐ PROBLEM(S) ARE OF MODERATE SEVERITY", 
                            "SPINE X‐RAY (LUMBAR PA‐LAT)", "ED VISIT‐ PROBLEM(S) ARE OF LOW TO MODERATE SEVERITY")) %>% 
  rename(cpt_code = `CPT Code`, description = Description) %>% 
  ungroup() %>% 
  mutate(cpt_code = as.character(cpt_code))


# Adding in Census Data
primary_data <- primary_data %>% 
  count(`County Name`, State) %>% 
  arrange(State) %>% 
  select(`County Name`) %>% 
  mutate(median_household_income = c(73533, 92878, 65702, 62618, 65834, 58139, 60148, 45386, 61036, 75777, 69856, 85619, 67805, 59419, 47371, NA),
         percent_pop_over65 = c(0.166, 0.15, 0.178, 0.197, 0.215, 0.271, 0.193, 0.232, 0.201, 0.153, 0.178, 0.173, 0.146, 0.21, 0.201, NA),
         pop_density = c(1508.8, 1837.9, 337.2, 199, 150.1, 51.4, 109.1, 18.4, 52.2, 457.4, 156.8, 425, 333.7, 81.4, 48.1, NA),
         percent_pop_over65 = 100*percent_pop_over65,
         median_household_income = median_household_income/1000) %>% 
  right_join(primary_data, by = "County Name")


# Making a numeric scale for typical patient complexity
primary_data <- primary_data %>% 
count(typical_patient_complexity) %>% 
  mutate(typical_patient_complexity_scale = case_when(n == 24 ~ 1,
                                                      n == c(85, 4968) ~ 2,
                                                      n == 768 ~ 3)) %>% 
  select(-n) %>% 
  right_join(primary_data, by = "typical_patient_complexity")

# Fixing precision of cost estimates variable
primary_data <- primary_data %>% 
  count(precision_of_the_cost_estimate) %>% 
  mutate(precision_of_cost_estimate = case_when(n == 773 ~ "high",
                                                n == 1439 ~ "low",
                                                n == 899 ~ "medium")) %>% 
  select(-n) %>% 
  right_join(primary_data, by = "precision_of_the_cost_estimate") %>% 
  select(-precision_of_the_cost_estimate) %>% 
  mutate(precision_of_cost_estimate = case_when(insurer %in% c("Medicare", "Uninsured") ~ "high",
                                                TRUE ~ precision_of_cost_estimate),
         commercial_market_share = case_when(insurer == "Anthem NH" ~ 39,
                                             insurer == "Harvard Pilgrim HC" ~ 27,
                                             insurer == "CIGNA" ~ 20))

# Standardizing prices to Medicare
primary_data <- primary_data %>% 
  filter(!insurer %in% c("Medicare", "Other", "Uninsured"), precision_of_cost_estimate != "low", !is.na(`ZIP Code`), locality == "NEW HAMPSHIRE") %>% # restricting only to well estimated prices for the privately insured at hospitals
  group_by(cpt_code, procedure, locality) %>% # want to standardize each private price relative to medicare_price for that procedure at that locality
  summarize(medicare_price = mean(medicare_price), # medicare price is the same across all hospitals in each locality
            med_private_price = median(estimate_of_total_cost), 
            standardization_fct = (2*medicare_price)/med_private_price) %>% # standardize such that median private price is 200% of the Medicare price
  ungroup() %>% 
  select(cpt_code, procedure, locality, standardization_fct) %>% 
  right_join(primary_data, by = c("cpt_code", "procedure", "locality")) %>% # add this standardization factor as a column to my data
  # count(procedure, locality, standardization_fct) %>% arrange(locality)
  mutate(standardization_fct = case_when(insurer == "Medicare" ~ 1, # do not want to change Medicare prices
                                         TRUE ~ standardization_fct),
         adj_cost_estimate = estimate_of_total_cost*standardization_fct, # generating deflated price estimates
         percent_medicare = (adj_cost_estimate/medicare_price)*100, # and standardizing them as a percentage of the medicare price
         Anthem_NH = case_when(insurer == "Anthem NH" ~ 1,
                               insurer != "Anthem NH" ~ 0),
         Harvard_Pilgrim_HC = case_when(insurer == "Harvard Pilgrim HC" ~ 1,
                               insurer != "Harvard Pilgrim HC" ~ 0),
         CIGNA = case_when(insurer == "CIGNA" ~ 1,
                               insurer != "CIGNA" ~ 0),
         Medicare = case_when(insurer == "Medicare" ~ 1,
                               insurer != "Medicare" ~ 0),
         private_payer = case_when(insurer == "Medicare" ~ 0,
                               insurer != "Medicare" ~ 1),
         `Hospital Quality` = as.numeric(`Hospital overall rating`))
```

```{r, include=FALSE}
primary_regression_data <- primary_data %>% 
  filter(!insurer %in% c("Uninsured", "Other"), !is.na(`ZIP Code`), !cpt_code %in% c("29826", "42820", "43239", "45378", "99282", "99283"),
         precision_of_cost_estimate != "low", locality == "NEW HAMPSHIRE")

stata_data <- clean_names(primary_regression_data, case = "snake")

write.dta(stata_data, "stata_data.dta")

##########################

felm_insurers1 <- felm(percent_medicare ~ Anthem_NH + Harvard_Pilgrim_HC + CIGNA | 0 | 0 | 0, 
                       data = primary_regression_data)

felm_insurers2 <- felm(formula = percent_medicare ~ Anthem_NH + Harvard_Pilgrim_HC + CIGNA | factor(procedure) | 0 | procedure, 
                       data = primary_regression_data)

felm_insurers3 <- felm(formula = percent_medicare ~ Anthem_NH + Harvard_Pilgrim_HC + CIGNA | factor(procedure) + factor(provider_name) | 0 | procedure + 
                         provider_name,
                       data = primary_regression_data)

##########################

felm_market_share <- felm(formula = percent_medicare ~ commercial_market_share | factor(procedure) + factor(provider_name) | 0 | procedure + 
                         provider_name,
                       data = subset(primary_regression_data, insurer != Medicare))

############################

felm_hospitals1 <- felm(data = primary_regression_data,
                        formula = percent_medicare ~ n_hosp_hsa_total + typical_patient_complexity_scale + `Hospital Quality` + 
                          median_household_income + percent_pop_over65 + pop_density +
                          Anthem_NH + Harvard_Pilgrim_HC + CIGNA | factor(procedure) | 0 | procedure)

felm_hospitals2 <- felm(data = primary_regression_data,
                        formula = percent_medicare ~ n_hosp_hrr_total + typical_patient_complexity_scale + `Hospital Quality` + 
                          median_household_income + percent_pop_over65 + pop_density +
                          Anthem_NH + Harvard_Pilgrim_HC + CIGNA | factor(procedure) | 0 | procedure)

felm_hospitals3 <- felm(data = primary_regression_data,
                        formula = percent_medicare ~ n_hosp_hsa_p + typical_patient_complexity_scale + `Hospital Quality` + 
                          median_household_income + percent_pop_over65 + pop_density +
                          Anthem_NH + Harvard_Pilgrim_HC + CIGNA | factor(procedure) | 0 | procedure)

felm_hospitals4 <- felm(data = primary_regression_data,
                        formula = percent_medicare ~ n_hosp_hrr_p + typical_patient_complexity_scale + `Hospital Quality` + 
                          median_household_income + percent_pop_over65 + pop_density +
                          Anthem_NH + Harvard_Pilgrim_HC + CIGNA | factor(procedure) | 0 | procedure)

felm_hospitals5 <- felm(data = primary_regression_data,
                        formula = percent_medicare ~ n_hosp_5mi_total + typical_patient_complexity_scale + `Hospital Quality` + 
                          median_household_income + percent_pop_over65 + pop_density +
                          Anthem_NH + Harvard_Pilgrim_HC + CIGNA | factor(procedure) | 0 | procedure)

felm_hospitals6 <- felm(data = primary_regression_data,
                        formula = percent_medicare ~ n_hosp_25mi_total + typical_patient_complexity_scale + `Hospital Quality` + 
                          median_household_income + percent_pop_over65 + pop_density +
                          Anthem_NH + Harvard_Pilgrim_HC + CIGNA | factor(procedure) | 0 | procedure)

felm_hospitals7 <- felm(data = primary_regression_data,
                        formula = percent_medicare ~ n_hosp_5mi_p + typical_patient_complexity_scale + `Hospital Quality` + 
                          median_household_income + percent_pop_over65 + pop_density +
                          Anthem_NH + Harvard_Pilgrim_HC + CIGNA | factor(procedure) | 0 | procedure)

felm_hospitals8 <- felm(data = primary_regression_data,
                        formula = percent_medicare ~ n_hosp_25mi_p + typical_patient_complexity_scale + `Hospital Quality` + 
                          median_household_income + percent_pop_over65 + pop_density +
                          Anthem_NH + Harvard_Pilgrim_HC + CIGNA | factor(procedure) | 0 | procedure)

###########################

felm_hospitals_insurers_1 <- felm(data = primary_regression_data,
                                  formula = percent_medicare ~ n_hosp_hsa_p*Anthem_NH + n_hosp_hsa_p*Harvard_Pilgrim_HC + n_hosp_hsa_p*CIGNA + 
                                    typical_patient_complexity_scale + `Hospital Quality` + median_household_income + percent_pop_over65 + pop_density 
                                  | factor(procedure) | 0 | procedure)

felm_hospitals_insurers_2 <- felm(data = primary_regression_data,
                                  formula = percent_medicare ~ n_hosp_hrr_p*Anthem_NH + n_hosp_hrr_p*Harvard_Pilgrim_HC + n_hosp_hrr_p*CIGNA + 
                                    typical_patient_complexity_scale + `Hospital Quality` + median_household_income + percent_pop_over65 + pop_density 
                                  | factor(procedure) | 0 | procedure)

felm_hospitals_insurers_3 <- felm(data = primary_regression_data,
                                  formula = percent_medicare ~ n_hosp_5mi_p*Anthem_NH + n_hosp_5mi_p*Harvard_Pilgrim_HC + n_hosp_5mi_p*CIGNA + 
                                    typical_patient_complexity_scale + `Hospital Quality` + median_household_income + percent_pop_over65 + pop_density 
                                    | factor(procedure) | 0 | procedure)

felm_hospitals_insurers_4 <- felm(data = primary_regression_data,
                                  formula = percent_medicare ~ n_hosp_25mi_p*Anthem_NH + n_hosp_25mi_p*Harvard_Pilgrim_HC + n_hosp_25mi_p*CIGNA + 
                                    typical_patient_complexity_scale + `Hospital Quality` + median_household_income + percent_pop_over65 + pop_density 
                                  | factor(procedure) | 0 | procedure)

uninsured_data <- primary_data %>%
  mutate(`Hospital Quality` = as.numeric(`Hospital overall rating`)) %>% 
  filter(insurer == "Uninsured", !is.na(`ZIP Code`), !cpt_code %in% c("29826", "42820", "43239", "45378", "99282", "99283"))

felm_uninsured_1 <- felm(data = uninsured_data,
                         formula = percent_medicare ~ n_hosp_5mi_p + typical_patient_complexity_scale + `Hospital Quality` + 
                           median_household_income + percent_pop_over65 + pop_density | factor(procedure) | 0 | procedure)

summary(felm_uninsured_1)

felm_uninsured_2 <- felm(data = uninsured_data,
                         formula = percent_medicare ~ n_hosp_25mi_p + typical_patient_complexity_scale + `Hospital Quality` + 
                           median_household_income + percent_pop_over65 + pop_density | factor(procedure) | 0 | procedure)

summary(felm_uninsured_2)

felm_providers_1 <- felm(data = subset(primary_data, !insurer %in% c("Uninsured", "Other") & 
                                         !cpt_code %in% c("29826", "42820", "43239", "45378", "99282", "99283") &
                                         precision_of_cost_estimate != "low" & locality == "NEW HAMPSHIRE"),
                   formula = percent_medicare ~ n_provider_5mi_p + typical_patient_complexity_scale + `Hospital Quality` + 
                     median_household_income + percent_pop_over65 + pop_density +
                     Anthem_NH + Harvard_Pilgrim_HC + CIGNA | factor(procedure) | 0 | procedure)
summary(felm_providers_1)

felm_providers_2 <- felm(data = subset(primary_data, !insurer %in% c("Uninsured", "Other") & 
                                         !cpt_code %in% c("29826", "42820", "43239", "45378", "99282", "99283") &
                                         precision_of_cost_estimate != "low" & locality == "NEW HAMPSHIRE"),
                   formula = percent_medicare ~ n_provider_25mi_p + typical_patient_complexity_scale + `Hospital Quality` + 
                     median_household_income + percent_pop_over65 + pop_density +
                     Anthem_NH + Harvard_Pilgrim_HC + CIGNA | factor(procedure) | 0 | procedure)
summary(felm_providers_2)


felm_providers_insurers_1 <- felm(data = subset(primary_data, !insurer %in% c("Uninsured", "Other") & 
                                         !cpt_code %in% c("29826", "42820", "43239", "45378", "99282", "99283") &
                                         precision_of_cost_estimate != "low" & locality == "NEW HAMPSHIRE"),
                   formula = percent_medicare ~ n_provider_5mi_p*Anthem_NH + n_provider_5mi_p*Harvard_Pilgrim_HC + n_provider_5mi_p*CIGNA + 
                     typical_patient_complexity_scale + `Hospital Quality` + median_household_income + percent_pop_over65 + pop_density
                     | factor(procedure) | 0 | procedure)

summary(felm_providers_insurers_1)

felm_providers_insurers_2 <- felm(data = subset(primary_data, !insurer %in% c("Uninsured", "Other") & 
                                         !cpt_code %in% c("29826", "42820", "43239", "45378", "99282", "99283") &
                                         precision_of_cost_estimate != "low" & locality == "NEW HAMPSHIRE"),
                   formula = percent_medicare ~ n_provider_25mi_p*Anthem_NH + n_provider_25mi_p*Harvard_Pilgrim_HC + n_provider_25mi_p*CIGNA + 
                     typical_patient_complexity_scale + `Hospital Quality` + median_household_income + percent_pop_over65 + pop_density
                     | factor(procedure) | 0 | procedure)

summary(felm_providers_insurers_2)
```

\Large {\bf Abstract}


\normalsize
This thesis evaluates how insurers and hospitals are able to exert market power in negotiating prices for hospital care, providing a more holistic picture of hospital price negotiations through synthesizing what currently exists as separate in the literature. Using estimates of insurer-hospital-procedure level prices for outpatient radiology services from New Hampshire's [HealthCost website](https://nhhealthcost.nh.gov/costs/select), I compare the estimated prices for the same service first across insurers and then across hospitals to evaluate how this relates to the insurer or hospital's market share. I find that on average Anthem/Matthew Thorton, the largest commercial insurer in New Hampshire, pays the lowest private prices, Harvard Pilgrim, the second largest insurer, pays 13.9% more than Anthem, and CIGNA, the smallest major insurer, pays 21.2% more than Anthem with statistical significance and. I also estimate that hospitals with one fewer competitors in their market are able to charge roughly 3-13% higher prices (depending on the definition of market) for each procedure after controlling for the insurer, quality, typical patient complexity, and socioeconomic/demographic characteristics. However, the effects of hospital competition on negotiated prices vary heterogenously across different insurers, with Harvard Pilgrim prices being the most sensitive to hospital competition. These results are consistent with the hypothesis that hospital prices are inefficiently influenced by the market power of the negotiating parties, and that policy solutions that can decrease the relative market power of each hospital and increase the market power of insurers may help to reduce prices.

\newpage
\pagenumbering{arabic}

# Introduction
The United States' expenditure on health care has grown rapidly since World War II and has outpaced that of many peer countries without significant returns to quality (e.g. OECD 2017; Etehad and Kim 2017; Reinhardt et al., 2004). From 1960-2017, the growth rate of this spending has surpassed that of GDP, averaging 6.3% annually, and although this rate recently slowed to only 3.9% in 2017 (Center for Medicare and Medicaid Services 2018), it remains positive and continues to outpace the annual growth rate of real GDP (Burea of Economic Advisors 2019). Given that the \$3.5 trillion spent on health care (17.9% of GDP) in 2017 (CMS 2018) erodes the personal budgets and funds for government social services, exploring the sources of spending has generated a large body of relevant research in health economics. Hospital care, physician services, and pharmaceutical drugs are the largest sources of spending, with hospital care constituting the largest share at 32.7% ($1.1 trillion) of total national health expenditure in 2017 (CMS 2018) as shown in Figure 1. Hospital care expenditures are also one of the faster growing components of total health care spending, growing on average over the last decade at 5.8% annually, while spending of physician services and perscription drugs over the same period grew on average at 4.8% and 4.1%, respectively (CMS 2018). While the prevalence of third party payers and certain unhealthy behaviors of American lifestyle may encourage higher utilization of medical care, the biggest driver behind the U.S.'s spending on hospital care and total health expenditure is not greater utilization or social spending but simply higher prices (e.g. Anderson et al., 2003; Papanicolas et al., 2018).

```{r, echo=FALSE, message=FALSE}

# Creating a graphic to show the growth in U.S. health care spending over time and specifically the growth in hospital care spending

# 1) putting together the data frame that will have U.S. health expenditure by year manually, using data from the CDC

year <- c(1960, 1970, 1980, 1990, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017)
national_health_expenditure <- c(27.2, 74.6, 255.3, 721.4, 1369.2, 1486.2, 1628.7, 1767.6, 1895.8, 2023.8, 2156.3, 2295.4, 2399.3, 2495.6, 2598.6, 2690.6, 2798.0, 2881.8, 3030.9, 3205.9, 3361.1, 3492.1) # in billions of dollars
hospital_care_expenditure <- c(9.0, 27.2, 100.5, 250.4, 415.5, 449.4, 486.5, 525.9, 565.3, 608.6, 651.2, 691.9, 725.6, 779.6, 822.3, 851.9, 902.5, 937.6, 978.2, 1034.5, 1092.8, 1142.6 ) # in billions of dollars
phys_clinical_sevices_exp <- c(5.6, 14.3, 47.7, 158.4, 288.2, 312.7, 337.7, 364.3, 389.4, 413.0, 434.7, 457.5, 481.9, 497.7, 512.6, 535.9, 557.1, 569.6, 595.7, 631.2, 666.5, 694.3) # in billions of dollars
prescrip_drugs_exp <- c(2.7, 5.5, 12.0, 40.3, 121.0, 139.0, 157.9, 176.7, 192.8, 205.2, 224.1, 235.7, 241.5, 252.7, 253.1, 258.8, 259.2, 265.2, 297.9, 324.5, 332.0, 333.4)
nominal_gdp <- c(542, 1073, 2857, 5963, 10252, 10582, 10936, 11458, 12214, 13037, 13815, 14452, 14713, 14449, 14992, 15543, 16197, 16785, 17522, 18219, 18707, 19485) # in billions of dollars, adj for inflation using 2012 dollars; https://www.thebalance.com/us-gdp-by-year-3305543

health_expenditures <- data.frame(year, national_health_expenditure, hospital_care_expenditure, nominal_gdp)


# 2) converting expenditures to percents of gdp
health_expenditures <- health_expenditures %>% 
  mutate(percent_nhe = national_health_expenditure/nominal_gdp,
         percent_hce = hospital_care_expenditure/nominal_gdp,
         percent_pcse = phys_clinical_sevices_exp/nominal_gdp,
         percent_pde = prescrip_drugs_exp/nominal_gdp) %>% 
  select(year, percent_nhe, percent_hce, percent_pcse, percent_pde) %>% 
  gather(-year, percent_pde, key = component_of_exp, value = percent_of_gdp)


# 2) putting together a line plot that will show this growth over time

health_spending <- ggplot(health_expenditures, aes(x = year, y = percent_of_gdp, group = fct_reorder(component_of_exp, -percent_of_gdp))) +
  geom_line(aes(color = fct_reorder(component_of_exp, -percent_of_gdp), linetype = fct_reorder(component_of_exp, -percent_of_gdp))) +
  labs(caption = "Notes: All dollar amounts are nominal. National Health Expenditue data up to 2017 comes from CMS 2018 
       NHE Estimates; GDP data from Bureau of Economic Advisors 2019.") +
  scale_y_continuous(name = "Expenditure (as a percentage of GDP)", labels = percent) +
  scale_x_continuous(name = "Year", breaks = c(1960, 1970, 1980, 1990, 2000, 2010)) +
  scale_linetype_manual(name = "Component of Expenditure",
                        values = c("percent_nhe" = "dotted",
                                   "percent_hce" = "solid",
                                   "percent_pcse" = "dashed", 
                                   "percent_pde" = "longdash"),
                        labels = c("Total National Health Expenditure", "Hospital Care", "Physician and Clinical Services", "Prescription Drugs")) +
  scale_color_manual(name = "Component of Expenditure",
                     values = c("percent_nhe" = "black",
                                "percent_hce" = "red",
                                "percent_pcse" = "gray",
                                "percent_pde" = "light gray"),
                    labels = c("Total National Health Expenditure", "Hospital Care", "Physician and Clinical Services", "Prescription Drugs")) +
  theme_tufte() +
  theme(plot.caption = element_text(hjust = 0))

ggsave("health_spending.png", dpi = 720)

```
\begin{figure}[ht]
  \includegraphics[width=\linewidth]{health_spending.png}
  \caption{Health Care Expenditure in the U.S. over time}
\end{figure}

Due to the size and relevance of hospital care spending, an important health economics literature deals with investigating the sources of hospital price variation. However, the process of determing and defining hospital prices has long been a challenging element of this research as the list prices hospitals put on their "chargemasters" have little systematic relation to what payers actually pay (Reinhardt 2006) and the actual hospital transaction prices for private payers have largely been considered commercially sensitive until relatively recently. What has been discovered as this price data has become more available is that these prices vary dramatically for different payers. Public payers such as Medicare and Medicaid set their prices at the federal or state level, which may vary somewhat across regions to reflect costs but usually do not vary within region. Private payers, on the other hand, negotiate price contracts separately with each hospital and often pay between an additional 50-200% of the Medicare price (Selden et al. 2015; Cooper et al. 2018; Bai and Anderson 2018), and this gap has only been growing in recent decades (Selden et al. 2015). In addition to the public-private gap, a few studies (e.g. Cutler et al., 2000; Bai and Anderson, 2018; Cooper et al. 2018) have also identified price gaps between different private payers and private payer types, such that for the same care at the same hospital, different insurers are paying significantly different prices. Considering the fact that 49% of Americans receive health care coverage from their employer through private insurance plans rather than through Medicare (21%) and Medicaid (14%) (Kaiser Family Foundation 2017), this price variation in different private insurer-hospital contracts affects what many Americans pay out of pocket and in premiums for their healthcare. Moreover, Cooper et al. (2015) finds some evidence that this variation persists even when costs and quality are arguably held constant.

*The literature has largely evaluated the potential impacts of market power on price negotiations by studying hospital competition or insurer competition separately. The growth in hospital consolidation in the past three decades has fueled significant research as to the price effects of mergers and the formation of large hospital systems (e.g. Capps and Dranove 2004; Dafny 2009; Bai and Anderson 2015; Melnick and Fonkych 2016), but relatively little work hs been done to examine the heterogeneity of these effects between different insurers. Hospital price negotiations with commercial insurers have been modeled in several papers.*

In this paper, I examine how prices for outpatient radiology services in New Hampshire vary with the market share of the insurer and the market share of the hospital, including an analysis of whether the effects of hospital market share are heterogeneous across insurers, using multivariate linear regression. New Hampshire has been a pioneer of price transparency in health care among the U.S. states and therefore provides the opportunity to more closely evaluate the forces shaping hospital prices. I use publicly available data from [NH HealthCost](https://nhhealthcost.nh.gov/costs/select) to construct price estimates at the insurer-provider-procedure level, information from the [New Hampshire Insurance Department](https://www.nh.gov/insurance/reports/documents/2018-nhid-annual-hearing-final-report.pdf) to obtain state-level health insurance information, and geographical data from Dartmouth Atlas and HealthCost to construct various measures of hospital market shares. While much of the previous literature analyzes inpatient care or physician practices (Clemens and Gottlieb 2016), I choose to focus my analysis to hospitals' outpatient radiology services for several reasons. In terms of relevance, outpatient services have expanded in recent decades (Fuchs 2012), and out of the 82 most common outpatient procedures in New Hampshire, 17 are radiology services (New Hampshire Hospital Association 2017). Due to both their high demand and high per-unit revenue to per-unit cost ratio, radiology services often constitute the largest source of outpatient profit for many hospitals at roughly 35% (Becker's Hospital Review 2015). In addition to being relevant, radiology services are particularly scalable medical services and can plausibly be assumed to have constant quality and costs (after controlling for service type and wages) across hospitals and particularly within hospitals. Upon examining the prices for these services, as available through NH HealthCost, I find statistically significant differences between the prices different insurers face across the state as well as statistically significant effects of hospital density on prices, although this effect varies somewhat across insurers.

*This paper is most closely related to Cooper et al. 2015, but differs in several key respects: first, this analysis will focus a set of price data for hospital care in New Hampshire, while Cooper et al. (2015) relies on HCCI data which is a national cross-section sample and relies on claims data from Aetna, Humana, and United Health. While the HCCI data is a rich set of data that is perhaps nationally representative in a broad sense, none of these insurers are major players in the New Hampshire market; secondly, this paper will devote more attention to insurers' relative market power although a formal analysis of insurer market power is not possible; lastly, I also examine whether the effect of hospital competition is different across different private insurers.*

Section II of this paper lays out the conceptual framework motivating this analysis, and Section III provides background on the New Hampshire market for health services. Section IV supplies explanation of the data sources being used, how they were obtained, and the relevant information contained therein. Section V describes the empirical approach and Section VI presents the results. A discussion of the results takes place in Section VII and the paper concludes with Section VIII.



# Conceptual Framework
The market for hospital services is imperfect in several ways. Mainly, most patients do not face the full costs of the services they require due to health insurance coverage. Health insurance is made necessary because the market for health care is full of risk: health services are often compensated in a large one time payment and each person is uncertain about how much care she will require and when. Thus, insurance helps distribute the risk associated with each consumer across a pool of plan enrollees and, in exchange for monthly premiums, helps bear some of the costs of care. However, this structure leads to reduced pressure on hospitals to offer competitive prices as patients rarely "shop" for care on the basis of price; most patients do not observe prices for the care they receive, and they are often restricted to going only to hospitals in-network or to which they are referred by their primary care physician. Thus, consumers' choices of insurance plans can be modeled as a function of plan premiums and hospital networks (Ho 2006), and consumers' hospital utilization choices are not based on the full costs of care (Manning et al., 1987; Finkelstein et al., 2012). 

Only about 14% of total health spending is out-of-pocket (Fuchs 2012) such that private insurers and other third-party payers are the most proximate agents to the price setting process with hospitals, particularly for expensive technologically advanced services. As a result, each hospital and private insurer negotiate explicit contracts of the insurer's reimbursement rates, usually for each service, and this is possible because there are relatively few hospitals and relatively few insurers present in each market for health care. The small number of payers and providers in this market and the establishment of bilateral contract negotiations mean that the market for hospital care deviates from a perfectly competitive model. In standard micro-economic theory, resources are optimally allocated in a perfectly competitive market via the mechanism of price, which results from the intersection of the supply and demand curves that are aggegations of many producers' cost functions and many consumers preferences. The resulting price is equivalent to the marginal cost of production and the value of consumers' marginal unit of utility. In this standard model, both producers and consumers are price takers, making their production or consumption decisions based on an exogenous price. However, if there is a small number of suppliers or consumers in the market, individual agents' production or consumption decisions can affect price such that it is no longer exogenous. In this scenario, the agent is no longer a price taker but also a price setter and exercises market power. The most extreme example of this of course is the monopolist, which sets its price to maximize non-zero profits given the demand curve for the good, and when profits are introduced, price is no longer welfare maximizing as a less than optimal amount of the good is consumed.

Unlike the perfectly competitive market where there are many producers and many consumers acting as price takers, insurers and hospitals are both price setters in the health care market because the decision of the marginal producer or consumer matters. An insurer can threaten not to include a hospital in its network, thereby reducing the likelihood that the patients it covers will go there for care. If the insurer covers many potential patients in that hospital's market, this threat could result in reduced volume and revenues for the hospital. However in return, hospitals can threaten not to be included in the insurer's network, making the insurer's plan less attractive to potential enrollees. If the hospital is a major hospital or the only hospital in a large geographic region, this threat can generate significant bargaining leverage as potential enrollees may place a high value on having convenient or well-known hospitals in their network. Therefore, the prices that result from these negotiations may reflect the relative bargaining power of the insurer and the hospital rather than the marginal cost and marginal utility of the services provided.

In these bilateral negotiations, I assume the following: both the provider and the payer want to maximize the number of patients they serve and their profit margins per patient, even if the provider is a non-profit (Horwitz 2005). Providers want to receive higher prices for their services but also to be included in payers' networks, as patients face lower out-of-pocket costs when going to providers in network. Payers want to pay lower prices for providers’ services to minimize their costs but also want to attract enrollees by including convenient providers in their network, which is an important aspect of plan selection for individuals (Ho 2006). Thus, if market share is associated with bargaining power, prices are expected to be more favorable for the hospitals or insurers with greater market shares. I examine whether this is the case in the analysis that follows.


# Background on the New Hampshire Market
*The state of New Hampshire has been a pioneer of price transparency through the creation of the Comprehensive Health Care Information System (CHIS), and in the same legislation that created CHIS, the state enacted statutes that mandated that health insurance carriers submit their encrypted health care claims data and Health Employer Data and Information Set (HEDIS) data to the state. This has led to a rich set of health claims data that has allowed for the creation of an online public tool NH HealthCost, which allows individuals to find estimates for what the total price for certain services will be at each hospital given their insurance carrier and from which I construct most of my data set as described in further detail in Section IV. The following subsections describe the New Hampshire insurance landscape as well as the provider landscape.*

## Health Insurance Coverage
New Hampshire is a small state (8,953 square miles) with a population of 1.3 million (90.5% white) and median household income of $71,305 (Census Bureau 2017). Additionally, 17.6% of the population is over the age of 65, which is slightly higher than the national average of 15.6% (Census Bureau 2017). Figures 2 and 3 show the insurance status of New Hampshire residents in 2017 and the market share of major private insurers, respectively. In 2017, 62% of residents (approximately 820,000 individuals) received health insurance through the private insurance market, 56% through employer-sponsored insurance and 6% through individual private insurance, and this translates to 543,900 enrolled members (New Hampshire Health Insurance Department 2018).^[A plan member can be a household or an individual; these estimates exclude individuals covered by the Federal Employees Health Benefits Program (FEHBP)] Of the privately insured, 81% received coverage through employer-sponsored insurance plans (12.6% Small Group, 19.8% Large Group Fully Insured, and 48.9% Large Group Self Insured) and the remainder either purchase their coverage individually (11.0%) or received subsidies for private coverage through New Hampshire's Premium Assistance Program (7.7%). This paper concerns only the prices faced by members of employer-based insurance plans (group insurance).

```{r, echo=FALSE}

# Creating dataframe on insurance status in NH from NH Insurance department, first creating columns
insurance_status <- c("Employer Coverage Only", "Individual Coverage Only", "Medicare Coverage Only", "Medicaid Coverage Only",  
                                                 "Tricare & VA Coverage", "Uninsured","Dual Medicare/Medicaid Coverage", "Other Coverage Combinations")

percent_in <- c(56, 6, 14, 10, 1, 6, 1, 6)

#insurance_status <- c("Employer Coverage Only", "Individual Coverage Only", "Medicare Coverage Only", "Medicaid Coverage Only", "Uninsured", 
                      #"Other Coverage Combinations", "Dual Medicare/Medicaid Coverage", "Tricare & VA Coverage")
#percent_in <- c(56, 6, 14, 10, 6, 6, 1, 1)

# Putting together as dataframe
insurance_status_nh <- data.frame(insurance_status, percent_in) %>% 
  arrange(desc(percent_in))

# Creating dataframe on private insurance in NH
insurer <- c("Anthem/Matthew Thorton", "Harvard Pilgrim", "CIGNA", "Other")
percent_enrolled <- c(39, 27, 20, 14)

# Putting together as dataframe
private_insurance <- data.frame(insurer, percent_enrolled) 
```

```{r, echo=FALSE, message=FALSE}
insurance_status_nh$pos = (cumsum(c(0, insurance_status_nh$percent_in)) + c(insurance_status_nh$percent_in / 2, .001))[1:nrow(insurance_status_nh)]
levels(insurance_status_nh$insurance_status) <- gsub(" ", "\n", levels(insurance_status_nh$insurance_status))
levels(insurance_status_nh$insurance_status) <- gsub("Tricare\n&\nVA\nCoverage", "Tricare & VA\nCoverage", levels(insurance_status_nh$insurance_status))
levels(insurance_status_nh$insurance_status) <- gsub("Dual\nMedicare/Medicaid\nCoverage", "Dual Medicare/\nMedicaid\nCoverage", 
                                                     levels(insurance_status_nh$insurance_status))
levels(insurance_status_nh$insurance_status) <- gsub("Other\nCoverage\nCombinations", "Other Coverage\nCombinations", 
                                                     levels(insurance_status_nh$insurance_status))

 
insurance_status <- ggplot(insurance_status_nh, aes(1, percent_in, group = fct_reorder(insurance_status, -percent_in))) +
  geom_col(position = position_stack(reverse = TRUE),
           color = "black",
           fill = "white",
           show.legend = FALSE) +
  geom_text_repel(data = subset(insurance_status_nh, !insurance_status %in% c("Employer\nCoverage\nOnly", "Medicare\nCoverage\nOnly", 
                                                                              "Medicaid\nCoverage\nOnly")), 
                  aes(x = 1.4, y = pos, label = paste0(insurance_status, " (", percent_in, "%)")), 
                  nudge_x = 1.4,
                  box.padding = 0.5,
                  size = 3,
                  family = "serif",
                  show.legend = FALSE) +
  geom_text(data = subset(insurance_status_nh, insurance_status == "Medicaid\nCoverage\nOnly"), 
                  aes(x = 0.7, y = pos, label = paste0(insurance_status, " (", percent_in, "%)")), 
                  nudge_x = 0.5,
                  size = 3,
                  family = "serif",
                  show.legend = FALSE) +
  geom_text(data = subset(insurance_status_nh, insurance_status %in% c("Employer\nCoverage\nOnly", "Medicare\nCoverage\nOnly")), 
                  aes(x = 0.6, y = pos, label = paste0(insurance_status, " (", percent_in, "%)")), 
                  nudge_x = 0.5,
                  size = 3,
                  family = "serif",
                  show.legend = FALSE) +
  expand_limits(x = c(1, 1.5)) +
  coord_polar("y", start = 0.6) + 
  labs(caption = "Source: New Hampshire Health Insurance Department, Nov. 2018") +
  theme_tufte() +
  theme(axis.title.x  = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(), 
        axis.title.y  = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        plot.caption = element_text(hjust = 0))

ggsave("insurance_status.png", dpi = 720)
```
\begin{figure}[ht]
  \includegraphics[width=\linewidth]{insurance_status.png}
  \caption{Health Insurance Status of New Hampshire Residents in 2017}
\end{figure}

The three major private insurers are Anthem/Matthew Thorton (39%), Harvard Pilgrim Healthcare (27%), and CIGNA (20%). Other insurers include Ambetter (3.5%), Minuteman Health (3.4%), Tufts (3.0%), Community Health Options (2.1%), United (1.2%), and Aetna (0.2%). I do not include these insurers in my analysis because the NH HealthCost website does not specify between them and often does not provide prices for them at all as they each constitute less than 5% of the market. Of the three major insurers, both Anthem and CIGNA have a significant national presence, Anthem being the larger of the two with 40.2 million members compared to CIGNA's 15.9 million members [Becker's Hospital Review 2019](https://www.beckershospitalreview.com/payer-issues/america-s-largest-health-insurers-in-2018.html). The Anthem plans are underwritten by Matthew Thorton Health Plan, Inc. in New Hampshire, a fully owned subsidiary of Anthem, and are referred to as "Anthem" for the remainder of the paper. Harvard Pilgrim Health Care is a non-profit private company that primarily operates in the north eastern United States [Crunchbase 2019](https://www.crunchbase.com/organization/harvard-pilgrim-health-care#section-overview), so while it is the second largest insurer in New Hampshire, it is a relatively small national player.

```{r, echo=FALSE, message=FALSE}
private_insurance <- private_insurance %>% 
  arrange(desc(percent_enrolled))

private_insurance$pos = (cumsum(c(0, private_insurance$percent_enrolled)) + c(private_insurance$percent_enrolled / 2, .001))[1:nrow(private_insurance)]
private_insurance$insurer <- gsub("Anthem/Matthew Thorton", "Anthem", private_insurance$insurer)


private_insurance_coverage <- ggplot(private_insurance, aes(1, percent_enrolled, group = fct_reorder(insurer, -percent_enrolled))) +
  geom_col(position = position_stack(reverse = TRUE),
           color = "black",
           fill = "white",
           show.legend = FALSE) +
  geom_text(aes(x = 0.6, y = pos, label = paste0(insurer, "\n(", percent_enrolled, "%)")), 
                  nudge_x = 0.5,
                  size = 3,
                  family = "serif",
                  show.legend = FALSE) +
  coord_polar("y", start = 0) + 
  labs(caption = "Source: New Hampshire Health Insurance Department, Nov. 2018") +
  theme_tufte() +
  theme(axis.title.x  = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(), 
        axis.title.y  = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        plot.caption = element_text(hjust = 0))

ggsave("private_insurance.png", dpi = 720)

```
\begin{figure}[ht]
  \includegraphics[width=\linewidth]{private_insurance.png}
  \caption{Distribution by Insurer for NH Commercial Market in 2017}
\end{figure}

## New Hampshire Providers
New Hampshire has a total of 31 hospitals and 3,503 beds within the state (New Hampshire Hospital Association 2018). According to the New Hampshire Hospital Association, 13 of these hospitals with 2,704 beds total are Prospective Payment Systems (PPS) Hospitals; 13 hospitals with 301 beds total are Critical Access Hospitals (CAH); and 5 hospitals with 498 beds total are Specialty Hospitals. PPS hospitals are normal acute-care hospitals that are reimbursed by Medicare through prospective payments^[Medicare prospective payments are predetermined, fixed amounts based on the classification system of the care received. For example, acute-care hospitals are reimbursed for inpatient stays according to the patient's diagnosis, corresponding to a diagnosis-related group (DRG), rather than according to the services provided to that patient.] for inpatient stays. CAHs are hospitals that serve rural populations and are therefore eligible to receive cost-based reimbursements from Medicare for inpatient stays. Specialty hospitals are any hospitals which provide a specialized category of services (such as children’s hospitals, orthopedic hospitals, cancer hospitals, etc.) and are omitted from my analysis for lack of price information. While the way these hospitals are reimbursed for inpatient hospital stays by Medicare may differ, these distinctions are largely irrelevant in the outpatient setting where physician and clinical services are reimbursed on a service level basis through Medicare Part B and do not affect how these hospitals are reimbursed by private insurers.

In addition to the 26 New Hampshire hospitals, there are 6 out-of-state hospitals relevant to my analysis which are located close to New Hampshire's borders: Anna Jaques Hospital, Lawrence General Hospital, and Lowell General Hospital (Massachusetts); Bridgton Hospital and York Hospital (Maine); and Northeastern Vermont Regional Hospital (Vermont). Furthermore, there are 99 non-hospital providers such as ambulatory surgical centers, clinics, and private physician groups that also provide some of the relevant outpatient procedures. Though the focus of the analysis is on hospitals, I include these non-hospital providers in Figure 4 for context. Non-hospital providers are often highly concentrated in certain areas and some even exist on the same campus as other non-hospital providers, clinics, or hospitals.

```{r, echo=FALSE, out.width="100%", message=FALSE, warning=FALSE}

counties <- map_data("county")

north_east <- subset(counties, region == "new hampshire")
                     # region %in% c("vermont", "new hampshire", "maine", "massachusetts"))

hospitals <- primary_data %>% 
  filter(!is.na(`Provider ID`)) %>% 
  count(provider_name, lat, long, `Hospital Type`)

nh_map <- ggplot() + 
  geom_polygon(data = north_east, aes(x = long, y = lat, group = group), fill = "white", color = "black", size = 0.2) + 
  coord_fixed(xlim = c(-74, -69.6),  ylim = c(42, 45.3), ratio = 1.3) +
  geom_point(data = primary_data, mapping = aes(x = long, y = lat, fill = `Hospital Type`, color = `Hospital Type`, alpha = `Hospital Type`), pch = 21) +
  scale_fill_manual(name = "Hospital Type", values = c("Acute Care Hospitals" = "#000000", 
                                                        "Critical Access Hospitals" = "#FFFFFF", 
                                                        "Non-Hospital Providers" = "#999999")) +
  scale_color_manual(name = "Hospital Type", values = c("Acute Care Hospitals" = "#000000", 
                                                        "Critical Access Hospitals" = "#000000", 
                                                        "Non-Hospital Providers" = "#999999")) +
  scale_alpha_manual(name = "Hospital Type", values = c("Acute Care Hospitals" = 1, 
                                                        "Critical Access Hospitals" = 1, 
                                                        "Non-Hospital Providers" = 0.5)) +
   geom_text_repel(data = subset(hospitals, long < -71.48 & lat > 44), 
                   aes(x = long, y = lat, label = provider_name), size = 2, box.padding = unit(0.2, 'lines'), 
                   xlim = c(-74,-72), ylim = c(44.2, 46), segment.size = 0.2, family = "serif") +
   geom_text_repel(data = subset(hospitals, long < -71.48 & lat < 44 & lat > 43.6), 
                   aes(x = long, y = lat, label = provider_name), size = 2, box.padding = unit(0.2, 'lines'), 
                   xlim = c(-74,-72.4), ylim = c(43.6, 44.2), segment.size = 0.2, family = "serif") +
   geom_text_repel(data = subset(hospitals, long < -71.48 & lat < 43.6 & lat > 43.2),
                   aes(x = long, y = lat, label = provider_name), size = 2, box.padding = unit(0.2, 'lines'),
                   xlim = c(-74,-72.5), ylim = c(43, 43.6), segment.size = 0.2, family = "serif") +
   geom_text_repel(data = subset(hospitals, long < -71.482 & lat < 43.2),
                   aes(x = long, y = lat, label = provider_name), size = 2, box.padding = unit(0.2, 'lines'),
                   xlim = c(-74,-72.5), ylim = c(42, 43.2), segment.size = 0.2, family = "serif") +
   geom_text_repel(data = subset(hospitals, long > -71.482 & long < -71.47 & lat < 43.2 & lat > 42.8),
                   aes(x = long, y = lat, label = provider_name), size = 2, box.padding = unit(0.2, 'lines'),
                   xlim = c(-74,-72.4), ylim = c(42, 42.75), segment.size = 0.2, family = "serif") +
   geom_text_repel(data = subset(hospitals, provider_name == "Southern NH Medical Center"),
                   aes(x = long, y = lat, label = provider_name), size = 2, box.padding = unit(0.2, 'lines'),
                   xlim = c(-74,-72), ylim = c(42, 42.6), segment.size = 0.2, family = "serif") +
   geom_text_repel(data = subset(hospitals, provider_name == "St. Joseph Hospital"),
                   aes(x = long, y = lat, label = provider_name), size = 2, box.padding = unit(0.2, 'lines'),
                   xlim = c(-74,-71.7), ylim = c(42, 42.45), segment.size = 0.2, family = "serif") +
   geom_text_repel(data = subset(hospitals, provider_name == "Elliot Hospital"),
                   aes(x = long, y = lat, label = provider_name), size = 2, box.padding = unit(0.2, 'lines'),
                   xlim = c(-74,-70.9), ylim = c(42, 42.3), segment.size = 0.2, family = "serif") +
   geom_text_repel(data = subset(hospitals, provider_name == "Lowell General Hospital"),
                   aes(x = long, y = lat, label = provider_name), size = 2, box.padding = unit(0.2, 'lines'),
                   xlim = c(-71,-70), ylim = c(42, 42.45), segment.size = 0.2, family = "serif") +
   geom_text_repel(data = subset(hospitals, provider_name == "Lawrence General Hospital"),
                   aes(x = long, y = lat, label = provider_name), size = 2, box.padding = unit(0.2, 'lines'),
                   xlim = c(-70.8,-70), ylim = c(42.45, 42.6), segment.size = 0.2, family = "serif") +
   geom_text_repel(data = subset(hospitals, provider_name == "Parkland Medical Center"),
                   aes(x = long, y = lat, label = provider_name), size = 2, box.padding = unit(0.2, 'lines'),
                   xlim = c(-70.9,-70), ylim = c(42.5, 42.75), segment.size = 0.2, family = "serif") +
   geom_text_repel(data = subset(hospitals, long > -71 & lat < 43.1),
                   aes(x = long, y = lat, label = provider_name), size = 2, box.padding = unit(0.2, 'lines'),
                   xlim = c(-70.5,-69.6), ylim = c(42.75, 43.1), segment.size = 0.2, family = "serif") +
   geom_text_repel(data = subset(hospitals, provider_name == "York Hospital"),
                   aes(x = long, y = lat, label = provider_name), size = 2, box.padding = unit(0.2, 'lines'),
                   xlim = c(-70.5,-69.6), ylim = c(43.1, 44), segment.size = 0.2, family = "serif") +
   geom_text_repel(data = subset(hospitals, long > -71 & lat < 44 & lat > 43.15),
                   aes(x = long, y = lat, label = provider_name), size = 2, box.padding = unit(0.2, 'lines'),
                   xlim = c(-70.5,-69.6), ylim = c(43.2, 44), segment.size = 0.2, family = "serif") +
   geom_text_repel(data = subset(hospitals, provider_name == "Lakes Region General Hospital"),
                   aes(x = long, y = lat, label = provider_name), size = 2, box.padding = unit(0.2, 'lines'),
                   xlim = c(-70.9,-69.6), ylim = c(43.75, 46), segment.size = 0.2, family = "serif") +
   geom_text_repel(data = subset(hospitals, provider_name == "Huggins Hospital"),
                   aes(x = long, y = lat, label = provider_name), size = 2, box.padding = unit(0.2, 'lines'),
                   xlim = c(-70.9, -69.6), segment.size = 0.2, family = "serif") +
   geom_text_repel(data = subset(hospitals, long > -71.4 & long < -71 & lat > 44),
                   aes(x = long, y = lat, label = provider_name), size = 2, box.padding = unit(0.2, 'lines'),
                   xlim = c(-70.9, -69.6), ylim = c(44.2, 46), segment.size = 0.2, family = "serif") +
   geom_text_repel(data = subset(hospitals, provider_name == "Bridgton Hospital"),
                   aes(x = long, y = lat, label = provider_name), size = 2, box.padding = unit(0.2, 'lines'),
                   xlim = c(-70.5, -69.6), segment.size = 0.2, family = "serif") +
  labs(caption = "Note: Location of hospitals and non-hospital providers provided by NH HealthCost. County divisions are shown.") +
  theme_tufte() +
  theme(axis.title.x  = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(), 
        axis.title.y  = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        plot.caption = element_text(hjust = 0))
 
ggsave("nh_map.png", dpi = 720)

```
\begin{figure}[ht]
  \includegraphics[width=\linewidth]{nh_map.png}
  \caption{Location of New Hampshire Hospitals}
\end{figure}

*There has only been one official hospital merger involving a hospital in New Hampshire: Massachusetts General Hospital (MGH)/Partners HealthCare from Massachusetts acquired Wentworth-Douglass on January 1, 2017. However, if two pending quasi-mergers go through, "22 out of New Hampshire's 26 acute-care hospitals will have established some kind of organizational connection with other institutions, often mergers in all but name" (Concord Monitor Jan 26, 2019). In May 2018 Partners HealthCare also made a bid to acquire Exeter Health Resources, and this merger is still pending approval.*


# Data
*I use two main sources of data to construct insurer-procedure-hospital level price estimates: for private payers, the HealthCost website and for Medicare, CMS's Physician Fee Schedule. I also include data from multiple other sources to provide further controls and to allow me to construct multiple definitions of a hospital's market.*

## HealthCost Data
The primary source of data on hospital prices comes from the New Hampshire Insurance Department [HealthCost website](https://nhhealthcost.nh.gov/costs/select), which is a publicly available tool that provides insurer-hospital specific estimations of costs for roughly 150 services and procedures. New Hampshire is one of the few states that makes such information publicly available, hence why I use it as a case study for my analysis. The cost estimates are calculated using claims data from the New Hampshire Comprehensive Healthcare Information System (NHCHIS) to determine the median amount that insurance carriers and patients pay for each service. The estimated costs therefore reflect the rates negotiated between health care providers and insurance carriers (often referred to as the "allowable amount") rather than provider charges, which have been shown to have little relation to what most privately insured individuals actually pay for a given service.

For the services relevant to this paper (outpatient procedures and radiology services), the estimated prices may be "bundled" to include multiple services or independent providers; that is, the estimates aggregate the costs for what may be treatment received from several providers (billing separately) under the "lead provider" rather than distinguishing between what is paid to the facility versus the physicians who treat the patient. Price estimates for radiology services use a modified bundle that includes the facility and the professional fees associated with the patient receiving that service but not any other costs that the patient may have incurred on the same day. 

Each service on HealthCost is identified with a description (e.g. "X-Ray - Abdomen") and one of the American Medical Association's Current Procedural Terminology (CPT) codes.  However, there are multiple CPT codes for an abdominal x-ray (different codes for different numbers of views), so the CPT codes for similar services are counted and the most common ones identified through the frequency distribution. From there, the representative CPT code and description is chosen based on what will be the simplest and most easily recognized procedure, and, when available, clinical insight is also considered. This means that in some cases, multiple CPT codes may be combined, as long as the cost is similar, under a single service. 

Additionally, HealthCost includes indicators of variability for each estimate under the "Precision of the Cost Estimate" field, where "High" corresponds to cost estimates with little variability from one patient to the next, and risk-adjustment indicators under the "Typical Patient Complexity" field, which are evaluated for each hospital within that procedure. I restrict my analysis only to cost estimates where the precision of the cost estimate is "Medium" or "High," and keep the the measure of typical patient complexity as a useful control for care intensity and quality in my analysis. The typical patient complexity control attempts to account for how a hospital may attract an average population when considering all procedures but a more complex population when only considering a specific procedure such as brain MRIs when compared to other hospitals. Thus, for brain MRIs, this hospital would have a "High" typical patient complexity. Lastly, HealthCost does not include visits where an infrequent and high cost procedure is performed in conjunction with the reported service on the website because the more expensive procedure may have also impacted the cost for performing the more routine services. 

This data allowed me to construct a data set containing the estimated price for many procedures and each provider-insurer combination for which data was available, and I choose to restrict these procedures only to radiology services. 

## Medicare Prices
In order to make the prices for each service comparable, I also include Medicare prices to provide a base measure of the procedure's expensiveness and to standardize the prices paid by private insurers as reported on NH HealthCost. However, because the HealthCost prices are "bundled" and I want to standardize these prices according to unbundled Medicare prices, I deflate the private prices by a certain factor per procedure. This factor is equal to the amount I would have to multiply the price faced by each of the major private insurers such that the median price for the procedure as paid by these insurers is equivalent to 200% of the Medicare price for that procedure. This standardization factor is 0.2-0.6 for most of the procedures I consider. 

I calculate the Medicare prices using data from the Center for Medicaid and Medicare Services (CMS). CMS sets all of it prices centrally, allowing for some variation across regions, and reimburses outpatient services through Medicare Part B based on the services provided, defined at the CPT code level. This information is made public in the Physician Fee Schedule (PFS) [2018 Relative Value file](https://www.cms.gov/Medicare/Medicare-Fee-for-Service-Payment/PhysicianFeeSched/PFS-Relative-Value-Files.html), allowing me to construct the Medicare reimbursement rates at each hospital for each service observed in the HealthCost data by matching each hospital to a locality in the CMS data. I am able to calculate the 2018 Medicare Facility Pricing Amount $p_{2018}^{Medicare}$ for each procedure $j$ at the locality level $l$ using  the following formula:
$$p_{jl, 2018}^{Medicare} = [({RVU}_{j}^{work}*{GPCI}_{l}^{work}) + ({RVU}_{j}^{PE}*{GPCI}_{l}^{PE}) + ({RVU}_{j}^{MP}*{GPCI}_{l}^{MP})]*{CF}_{2018} $$ 
where ${RVU}_{j}^{work}$ denotes the Relative Value Unit (RVU) for the physician work involved in providing procedure $j$, ${RVU}_{j}^{PE}$ denotes the RVU for the resource-based practice expense for the facility setting, and ${RVU}_{j}^{MP}$ denotes the RVU for the malpractice expense. ${GPCI}_{l}^{work}$ denotes the Geographic Practice Cost Index (GPCI) corresponding to locality $l$ and the work RVU, ${GPCI}_{l}^{PE}$ corresponds to the practice expense RVU, and ${GPCI}_{l}^{MP}$ corresponds to the malpractice RVU. ${CF}_{2018}$ denotes the 2018 conversion factor (\$35.996). For example, a foot x-ray has a work RVU of 0.17, a facility practice expense RVU of 0.64, and a malpractice RVU of 0.02 while an arthroscopic shoulder surgery has a work RVU of 8.843, a facility practice expense RVU of 7.997, and a malpractice RVU of 1.612 to capture how the arthroscopic shoulder surgery is a much more technical, expensive, and high-risk procedure to provide than a foot x-ray. These RVUs are then weighted by the locality $l$'s corresponding GPCIs (values that range from 0.950 to 1.925 in the 2018 data) to account for labor costs, equipment costs, and malpractice expenses in that region. As a result, Medicare pays \$30.90 for a foot x-ray and \$677.26 for an arthroscopic shoulder surgeryin in most New Hampshire hospitals but \$34.25 for a foot x-ray and \$729.84 for an arthroscopic shoulder surgery in the Boston metropolitan area.

Medicare treats all of New Hampshire as one locality, meaning that all hospitals in New Hampshire that are reimbursed through prospective payments are reimbursed the same amount for outpatient services through Medicare Part B. However, 13 out of the 32 hospitals in my dataset are Critical Access Hospitals (CAHs) that are eligible to receive cost-based reimbursements from Medicare. I was unable to obtain data on exactly how much these CAHs are reimbursed by CPT code and therefore use the prospective payment rates as an approximation for what they are reimbursed by Medicare. This should not have a major impact on the analysis as the focus is on private insurers, and I primarily use Medicare prices for the purposes of standardization of the private insurer prices available through NH HealthCost. 

## Price variation in the New Hampshire Market
Having constructed price estimates at the insurer-procedure-hospital level using both data sources outlined above, I find that large price variation exists in New Hampshire, and I present in Table 1 the estimated prices for Medicare, the three major private insurers, and the uninsured for the procedures included in my analysis. All price data presented reflect 2018 prices, and the price estimates for private payers have been adjusted to be comprable to Medicare's non-bundled prices. Significant variation exists in the prices paid for the same procedure or service, even when only considering the privately insured. This variation may be efficient if costs and quality vary across hospitals for complex procedures but may be inefficient for services where cost and quality are plausibly constant.
```{r, echo=FALSE, results = "asis", fig.align='center', message=FALSE}
all_procedures <- primary_data %>% 
  filter(`Hospital Type` != "Non-Hospital Providers", !cpt_code %in% c("29826", "42820", "43239", "45378", "99282", "99283"), locality == "NEW HAMPSHIRE") %>%
  group_by(procedure) %>% 
  summarize(Median = median(adj_cost_estimate)) %>% 
  mutate(insurer = "All Payers") %>% 
  ungroup()

all_procedures <- primary_data %>%
  filter(`Hospital Type` != "Non-Hospital Providers", !cpt_code %in% c("29826", "42820", "43239", "45378", "99282", "99283"), locality == "NEW HAMPSHIRE") %>%
  group_by(procedure, insurer) %>% 
  summarize(Median = median(adj_cost_estimate)) %>% 
  ungroup() %>% 
  bind_rows(all_procedures) %>% 
  mutate(procedure = str_replace_all(procedure, "&", "/")) %>% 
  spread(key = insurer, value = Median) %>% 
  select(procedure, `All Payers`, Medicare, `Anthem NH`, `Harvard Pilgrim HC`, CIGNA, Uninsured) %>% 
  rename("Procedure" = "procedure", "All" = "All Payers", "Anthem" = "Anthem NH", "HP" = "Harvard Pilgrim HC") %>% 
  mutate(Procedure = str_remove_all(Procedure, "\\s*\\([^\\)]+\\)"),
         Procedure = str_replace_all(Procedure, "Emergency Department Visit - Low Complexity", "Emergency Room Visit - Low Level"),
         Procedure = str_replace_all(Procedure, "Emergency Room Visit - Medium", "Emergency Room Visit - Medium Level"),
         Procedure = str_replace_all(Procedure, "Upper Gastrointestinal Endoscopy, with biopsy", "Upper GI Endoscopy, with biopsy"),
         Procedure = str_replace_all(Procedure, "CT - Abdomen / Pelvis, with contrast", "CT - Abdomen/Pelvis, with contrast")) %>% 
  data.frame() %>% 
  arrange(desc(All))


stargazer(all_procedures, summary = FALSE, rownames = FALSE, font.size = "footnotesize", header = FALSE, align = TRUE, column.sep.width = "0.5pt",
          digits = 0, title = "Median Price for Radiology Services by Payer")
```

However, this variation persists even when costs and quality are reasonably assumed to be fixed within the same hospital. Controlling for procedure, across hospital price variation accounts for 16.4% of the total variation but *within* hospital price variation accounts for a further 17.0% of the total variation in my data. For the same service at the same hospital, different payers are charged vastly different amounts. Figure 5 shows the different prices paid by the three major private payers in New Hampshire (Anthem, Harvard Pilgrim, and CIGNA) at the same hospital for spine x-rays (a common outpatient procedure). For all of the hospitals in Figure 5, there is a difference of at least \$100 between what the highest and lowest payers pay.

```{r, echo=FALSE, message=FALSE}
xray_prices <- primary_regression_data %>% 
  filter(procedure == "X-Ray - Spine (outpatient)") %>% 
  count(provider_name, insurer) %>% 
  count(provider_name) %>% 
  filter(nn == 4) %>%
  left_join(primary_regression_data, by = "provider_name") %>% 
  filter(procedure == "X-Ray - Spine (outpatient)", !insurer %in% c("Uninsured", "Other", "Medicare"), precision_of_cost_estimate != "low") %>%
  group_by(provider_name) %>% 
  mutate(range = max(adj_cost_estimate) - min(adj_cost_estimate)) %>% 
  filter(range > 25) %>% 
  ungroup() %>% 
  ggplot(aes(x = fct_reorder(provider_name, adj_cost_estimate), y = adj_cost_estimate, fill = fct_reorder(insurer, -commercial_market_share))) +
  geom_col(position = "dodge", width = 0.5, color = "black") +
  geom_hline(yintercept = 36.81931, color = "black", size = 0.5) +
  scale_fill_manual(values = c("CIGNA" = "#99CC00", "Anthem NH" = "#336699", "Harvard Pilgrim HC" = "#CC0000"), name = "") +
  scale_y_continuous(name = "Price Estimate", labels = c("$0", "$25", "Medicare\nPrice\n$36.82", "$50", "$75", "$100"), 
                     breaks = c(0, 25, 36.81931, 50, 75, 100)) +
  labs(caption = "Note: This plot shows all hospitals for which there was an estimated price difference greaterthan $100 
       between the highest and lowest paying commercial insurers for spine x-rays. Price estimates come from HealthCost 
       website and all prices shown are estimated with medium to high precision.") +
  coord_flip() +
  theme_tufte() + 
  theme(axis.title.y = element_blank(),
        legend.position = "bottom",
        plot.caption = element_text(hjust = 0))

ggsave("xray_prices.png", dpi = 720)
```
\begin{figure}[ht]
  \includegraphics[width=\linewidth]{xray_prices.png}
  \caption{Prices Paid by Private Insurers for Spine X-Rays (Outpatient)}
\end{figure}

It is unlikely that the cost of providing each of these services and the quality of each of these services within the same hospital should vary with patients' insurance coverage. That is, it is reasonable to assume that it is no more costly from the hospital's point of view to perform a spine x-ray on a patient covered by CIGNA as opposed to a patient covered by Anthem, and that hospitals do not provide higher quality spine x-rays to CIGNA covered patients than they do to Anthem patients. Thus my analysis explores other potential sources of this variation, particularly the level of competition among insurers and hospitals that may allow each to exert certain levels of market power in the price bargaining scenario.

## Additional Data
In order to provide controls for quality and cost variation I include quality information from CMS's Hospital Compare data and county-level information on income and population demographics from 2017 US Census Data. CMS's hospital overall ratings attempt to capture the quality of care a hospital may provide compared to other hospitals based on the quality measures reported on Hospital Compare, summarizing into a single rating more than 60 measures in seven measure groups: mortality, safety of care, readmission, patient experience, effectiveness of care, timeliness of care, and efficient use of medical imaging. Hospitals are ranked out of five stars, and my dataset includes two hospitals with two stars, 11 hospitals with three stars, 16 hospitals with four stars, and three hospitals with five stars for their overall ratings. My primary analyses focus use only the hospital's overall quality rating. The US Census data I use are county level estimates of median household income, percentage of the population over 65, and population density. 

In order to construct hospital markets and define hospital density therein, I use geographical information from Dartmouth Atlas of Health Care and Google Maps. Dartmouth Atlas defines and provides data for each hospital's Hospital Service Area (HSA) and Hospital Referral Region (HRR), and these definitions for hospitals' markets are commonly used throughout the literature. An HSA delineates a local market for hospital care, composed of a collection of zip codes whose residents receive most of their hospitalizations from the hospitals in that area. For the most part, this calculation is based on assigning each zip code to the area where the greatest proportion of its Medicare patients were hospitalzed. Most HSAs contain only one hospital. An HRR dilineates regional health care markets for tertiary medical care and each contains at least one hospital that performs major cardiovascular procedures and neurosurgery. HRRs were largely defined by assigning HSAs to the region where the greatest proportion of major cardiovascular procedures were performed. My dataset contains 29 unique HSAs and 4 unique HRRs, and I count both the total number of hospitals within each hospital's market and the number of hospitals that provide the same service/procedure within that market. My second set of market definitions simply uses coordinate information for each hospital from Google Maps to calculate the total number of hospitals and the number of hospitals offering the same procedure within a 5-mile and 25-mile radius of each hospital.



# Empirical Approach
My analysis seeks to identify whether the market share of hospitals and insurers is related to variation in the prices private insurers pay for hospital services. The first section concerns price variation across insurers and the second concerns price variation across hospitals. I restrict my analyses only to radiology services, which are among some of the most common outpatient procedures, only to hospitals in New Hampshire,^[I exclude ambulatory surgical centers, clinics, specialist practices, and private physician practices.] and only to the three major private insurers and Medicare (to provide a base price). This leaves me with 33 services, 26 hospitals, and 1,480 observations.^[I am only able to obtain 1,347 observations of prices paid by either Anthem, Harvard Pilgrim, or CIGNA because NH HealthCost does not provide prices for all three insurers at all 26 New Hampshire Hospitals for all 33 radiology services considered. I also restrict my data to estimates that do not have "low" precision of the estimate, further reducing my total number of private price observations to 773. I do have estimates for the Medicare price at every hospital for every procedure (858 observations)]

Radiology services (CT scans, MRIs, ultrasounds, x-rays, etc.) generally involve the use of an imaging device to capture an image which is then read (examined) by a radiologist who reports their findings to the patient or patient's doctor. The initial cost of purchasing one of these imaging devices is expensive and may vary somewhat, but the per unit cost of procuring and reading an image is likely to be similar across providers once controlling for wages. Particularly within the same hospital, the per unit cost of each radiology service is reasonably assumed to be constant. Similarly, within the same hospital, quality is plausibly assumed constant for the same service. Furthermore, across hospitals, the quality of radiology services is assumed to be relatively similar. While the number of specialized radiologists employed by each hospital may vary, the emergence of telemedicine and New Hampshire legislation encouraging its use (mHealth Intelligence, 0ct. 27, 2015) may help to mitigate these disparities as rural hospitals can send imaging to be reliably read by specialized radiologists employed by telemedicine firms. Particularly after controlling for the hospital's overall quality, I assume that imaging service quality is minimally different between hospitals.

My outcome variable of interest is the percentage of the Medicare price that insurer $i$ negotiates for a particular procedure $j$ at a particular hospital $h$, denoted as $y_{ijh}$. That is, 
\begin{equation}
y_{ijh} = \frac {p_{ijh}}{p_{jh}^{Medicare}}
\end{equation}
where $p_{ijh}$ denotes the price a particular insurer pays for procedure $j$ at hospital $h$, and $p_{jh}^{Medicare}$ denotes the price Medicare pays for the same service at the same hospital.

In the first set of regressions, I estimate whether there is a statistical difference between the prices hospitals charge Anthem, Harvard Pilgrim, and CIGNA in New Hampshire for the same service, with the context that Anthem (the largest commercial insurer) composes 39% of the commercial insurance market, Harvard Pilgrim 27%, and CIGNA (the smallest major commercial insurer) 20%. I estimate what percentage of the Medicare price each insurer pays on average using the following linear model:
\begin{equation}
y_{ijh} = \sum_{k \epsilon K} \gamma_k \left[{insurer_k}\right] + \delta_j + \lambda_h + \varepsilon_{ijh}
\end{equation}

where $K$ is the set of private insurers (Anthem, Harvard Pilgrim, CIGNA), and ${insurer_k}$ is an indicator variable that takes on the value of 1 or 0. The omitted dummy is Medicare such that the coefficient $\hat \gamma_k$ estimates the percentage of the Medicare price private insurer $k$ pays on average, and the three resulting coefficients of the summation (one $\hat \gamma_k$ for each insurer) are the primary coefficients of interest. The regression also includes procedure fixed effects $\delta_j$ and hospital fixed effects $\lambda_h$ so that the price for the same procedure at the same hospital can be compared among the commercial insurers. The error term is denoted by $\varepsilon_{ijh}$.

This analysis only reveals whether there are consistent differences between the prices each insurer pays and a possible correlation between the relative magnitudes of $\hat \gamma_k$ and the market share of insurer $i$. I cannot directly estimate the relationship between the market share of insurer $i$ and the price of procedure $j$ at hospital $h$ because I only have the state-wide market shares of each insurer. Ideally, I would know the market power of each insurer within hospital $h$'s market, and identify the relationship between the prices negotiated by insurer $i$ and hospital $h$ given insurer $i$'s market share in hospital $h$'s market. Nonetheless, in my analysis the relative magnitude of the coefficients $\hat \gamma_k$ and their statistical significance suggest the potential direction of this relationship. That is, each insurer's state-wide market share is known and can be ranked from largest to smallest, and a negative correlation between the size of the insurer's statewide market share and the magnitude of $\hat \gamma_k$ suggests that larger insurers may negotiate cheaper prices.

As with the imperfect measure of insurer market share, I also am unable to obtain data on the precise market share of each hospital in the market for outpatient radiology services because the outpatient volumes of each hospital are not provided in my data. However, I am able to construct a measure of the number of other hospitals present in hospital $h$'s market to serve as a proxy for market share and concentration. This method is of course imperfect because there may be several hospitals in the same market but one may perform significantly more outpatient radiology procedures than the others due to having a greater capacity, being more accessible by transit, or having a better reputation among other reasons. Nevertheless, I assume that because there are so few hospitals present in each market, the addition of a marginal hospital to hospital $h$'s market does have a negative effect on the market power of hospital $h$ as it faces greater competition. By counting the number of hospitals present in each hospital's market, I am able to construct a proxy for the level of hospital competition hospital $h$ faces in its market. 

Thus in the second set of regressions, I estimate how the presence of other hospitals within each hospital's market relates to the price (as a percentage of the Medicare price) for a particular service $j$ that hospital $h$ negotiates with each insurer $i$. Essentially, the hospital fixed effects variable Equation (2) is broken apart into various observable measures relating to a particular hospital and its market, resulting in the following linear model:
\begin{equation}
y_{ijh} = \sum_{k \epsilon K} \gamma_k \left[{insurer_k}\right] + \delta_j + \alpha m_h + \beta_1\eta_{jh} + \beta_2\vartheta_h + \beta_3 X_c + \varepsilon_{ijh}
\end{equation}

where the summation of the insurer dummies and $\delta_j$ (procedure fixed effects) remain the same as in Equation (2); $m_h$ represents the number of hospitals in hospital $h$'s market; $\eta_{jh}$ denotes the typical patient complexity for procedure $j$ at hospital $h$; $\vartheta_h$ denotes overall hospital quality at hospital $h$ as provided through the CMS Hospital Compare data; and $X_{c(h)}$ is a vector of county-level characteristics for each hospital $c(h)$ that include the median household income, the percentage of people over 65 years of age, and population density. Data for these controls come from the [2017 US Census](https://www.census.gov/quickfacts/fact/map/US/INC110217).

A hospital's market is defined differently across several specifications, resulting in different meanings of $m_h$ across different regressions. I first use Hospital Service Area (HSA) and Hospital Referral Region (HRR) definitions for hospitals' markets and count the total number of hospitals within each hospital's market. In another specification, I also count the number of hospitals that provide the same service/procedure within that market such that the market term in Equation (3) becomes $m_{jh}$. This attempts to isolate whether the hospital is truly competing with other hospitals in its market in providing procedure $j$ or whether it may be the only hospital in its market providing that service and therefore faces no competitors. While the 33 radiology services I have restricted my analysis to are quite common, I do not observe prices for all service-hospital combinations in the HealthCost data because some hospitals provide certain services very infrequently or not at all. Thus, I restrict my estimates only to service-hospital combinations for which I observe prices. Most hospitals in the dataset do provide at least half of the relevant services and there does not appear to be a consistent set of services for which price data is missing.

The second set of market definitions I use are based on geographical radii drawn around each hospital. As with the HSA/HRR market definitions, I count the total number of hospitals as well as the number of hospitals that also provide the same service/procedure within a 5 mile radius (local market) and a 25 mile radius (a broader market) of each hospital $h$. As the services being examined are all outpatient services, the HSA/HRR definitions may not truly capture the potential patient population and potential competitors because they are calculated on the basis of hospitalization (inpatient) events. For outpatient services, patients may be able to "shop" more easily among different hospitals and this may affect their choice of insurance plan. That is, potential patients may place greater weight on convenience and distance to the hospitals they can go to in the outpatient setting rather than the intensity of care they can receive there because their health status is often not as acute as in the inpatient setting. Therefore, insurers may want to provide attractive plans that offer patients enough convenient choice in their relevant market but without facing high premiums or out-of-pocket costs. Thus, this radial measure of a hospital's market may be more applicable to consumers' choices in the outpatient setting.

The primary coefficient of interest in this second set of regressions is $\hat \alpha$ which estimates how hospital competition may be related to prices. If $\hat \alpha$ is negative, this suggests that the more hospital competition there is within a hospital's market, the lower the prices.

The last regression I perform investigates whether hospital competition is related to negotiated prices differently for different insurers. That is, one insurer may be more sensitive to the number of hospitals present in hospital $h$'s market because leveraging hospital competition is a more prominent strategy in their price negotiations. How well an insurer is able to leverage such information may in turn be a function of their own market share. Thus, the final regression equation is otherwise the same as Equation (3) but includes an interaction between the number of hospitals in hospital $h$'s market and an indicator for \begin{equation}
y_{ijh} = \sum_{k \epsilon K} \gamma_k \left[{insurer_k}\right] + \delta_j + \alpha m_h + \sum_{k \epsilon K} \zeta_k (m_h *\left[{insurer_k}\right]) + \beta_1\eta_{jh} + \beta_2\vartheta_h + \beta_3 X_{c(h)} + \varepsilon_{ijh}
\end{equation}
The primary coefficient of interest is $\hat \zeta_k$ which estimates how the addition of one additional hospital to hospital $h$'s market affects the price negotiated with insurer $n$ for procedure $j$. The relative magnitudes of $\hat \zeta_k$ may indicate the ability or willingness of different insurers to leverage information on hospital competition in price negotiations.



# Results
The first set of results presented in Table 2 demonstrate that there are statistically significant differences in the prices paid by each insurer for a particular service at a particular hospital. Standard errors are clustered by procedure and hospital when procedure and hospital fixed effects are included. The coefficients are presented as the average percentage *above* the Medicare price that each insurer pays as Medicare is the omitted group and therefore is expected to pay 100% of the Medicare price. In the primary regression (column 1), these estimated coefficients suggest that on average Anthem pays 181% the Medicare price, Harvard Pilgrim pays 206% the Medicare price, and CIGNA 219% the Medicare price. Alternatively, this means that on average Harvard Pilgrim pays 13.9% more than Anthem and CIGNA pays 21.2% more than Anthem. A basic fixed effects linear model of price on market share results in a coefficient on insurer market share that estimates a 1% increase in insurer statewide market share is associated with a 2% decrease in prices.
```{r, echo=FALSE, results = "asis", fig.align='center', message=FALSE}
stargazer(felm_insurers3, felm_insurers2, felm_insurers1, felm_market_share, header = FALSE, type = "text",
          omit = c("factor(provider_name)", "factor(procedure)"), omit.labels = c("Hospital Fixed Effects", "Procedure Fixed Effects"),
          keep.stat = c("n", "rsq"),
          title = "Private Insurance Carrier and Relative Prices",
          covariate.labels = c("Anthem", "Harvard Pilgrim", "CIGNA", "Commercial Market Share", "Constant (Medicare)"), 
          dep.var.labels = "Percent of Medicare Price", font.size = "footnotesize")
```
The positive direction of the coefficients is unsurprising as Medicare consistently reimburses providers at much lower rates than do private insurers. The coefficients are estimated using standardized prices that attempt to account for the bundled nature of payments and match prior literature. However, it is interesting to note that among the inpatient services they examine, Cooper et al. (2015) find the greatest disparity in Medicare versus private reimbursement for lower limb MRIs, the only radiology service they consider, estimating that private insurers pay on average four times the Medicare price, so perhaps Medicare is particularly able to set low prices for radiology services given the low per-unit cost of radiology services. Additionally, the price data from HealthCost reflects "bundled" prices as detailed in Section III, so they are likely somewhat inflated compared to the Medicare prices. Importantly however, HealthCost bundles payments in the same way across all three private insurers and therefore the variation in the prices paid by each insurer is unaffected by this imperfect standardization to the Medicare price.

The second set of results presented in Tables 3-4 suggest that the number of hospitals in a hospital's market is negatively related to price at a statistically significant level across all definitions of a hospital's  market. Standard errors are clustered by procedure. Table 3 presents the results where markets are defined at the hospital level by HSA/HRR or radius, and Table 4 presents the results where markets are defined at the hospital-procedure level by HSA/HRR or radius. These regressions estimate that the addition of one hospital to a hospital's local market (HSA and 5-mile radius definitions) is associated with a decrease in prices equivalent to 10-13% of the Medicare price for that procedure, and if one hospital is added to a hospital's larger market, the associated price decrease is estimated to be roughly 3% of the Medicare price. On the whole, these results suggest that, controlling for typical patient complexity, hospital quality, and county level characteristics, the greater the number of hospitals in a hospital's market, the lower the prices at that hospital are, and that competitive pressures may be more intense at the loval market level.
```{r, echo=FALSE, results = "asis", message=FALSE}
stargazer(felm_hospitals1, felm_hospitals2, felm_hospitals5, felm_hospitals6, header = FALSE,
          omit = "procedure", omit.labels = "Procedure Fixed Effects",
          keep.stat = c("n", "rsq"),
          title = "Hospital Competition and Relative Price",
          covariate.labels = c("Total Hospitals in HSA",
                               "Total Hospitals in HRR",
                               "Total Hospitals in 5-mile radius",
                               "Total Hospitals in 25-mile radius",
                               "Typical Patient Complexity", 
                               "Hospital Quality",
                               "Median Income (1000s)",
                               "Percent Population 65 and older",
                               "Population Density",
                               "Anthem",
                               "Harvard Pilgrim",
                               "CIGNA",
                               "Constant (Medicare)"), 
          dep.var.labels = "Percent of Medicare Price", font.size = "footnotesize")

```

```{r, echo=FALSE, results = "asis", message=FALSE}

stargazer(felm_hospitals3, felm_hospitals4, felm_hospitals7, felm_hospitals8,
          header = FALSE,
          omit = "procedure", omit.labels = "Procedure Fixed Effects", 
          keep.stat = c("n", "rsq"),
          title = "Hospital Competition by Procedure and Relative Price",
          covariate.labels = c("Hospitals in HSA w/ procedure",
                               "Hospitals in HRR w/ procedure",
                               "Hospitals in 5-mile radius w/ procedure",
                               "Hospitals in 25-mile radius w/ procedure",
                               "Typical Patient Complexity", 
                               "Hospital Quality",
                               "Median Income (1000s)",
                               "Percent Population 65 and older",
                               "Population Density",
                               "Anthem",
                               "Harvard Pilgrim",
                               "CIGNA",
                               "Constant (Medicare)"), 
          dep.var.labels = "Percent of Medicare Price", font.size = "footnotesize")


```

In addition the the variables concerned with the hospitals' market share, the control variables also provide some interesting coefficients in that they are all statistically insignificant. This suggests that controls for hospital quality and costs have little to no relation to prices and that hospitals that likely serve more Medicare patients due to a higher percentage of the population being above the age of 65 do not cost shift. That is, hospitals do not appear to charge private payers more to make up for losses incurred by serving more Medicare patients or perhaps do not lose money on Medicare patients for the services considered. Lastly, the dummy variables for each private insurer remain roughly unchanged and maintain the same order of magnitudes from the insurer analysis.

```{r, echo=FALSE, results = "asis", message=FALSE}
stargazer(felm_hospitals_insurers_1, felm_hospitals_insurers_2,  header = FALSE,
          omit = "procedure", omit.labels = "Procedure Fixed Effects",
          keep.stat = c("n", "rsq"),
          order = c("n_hosp_hsa_p:Anthem_NH", "n_hosp_hsa_p:Harvard_Pilgrim_HC", "n_hosp_hsa_p:CIGNA", "n_hosp_hsa_p",
                    "n_hosp_hrr_p:Anthem_NH", "n_hosp_hrr_p:Harvard_Pilgrim_HC", "n_hosp_hrr_p:CIGNA", "n_hosp_hrr_p",
                    "typical_patient_complexity_scale", "`Hospital Quality`", "median_household_income", "percent_pop_over65", "pop_density",
                    "Anthem_NH", "Harvard_Pilgrim_HC", "CIGNA", "Constant"),
          title = "Hospital Competition by Procedure and Insurer and Relative Price",
          covariate.labels = c("Hospitals in HSA w/ procedure x Anthem",
                               "Hospitals in HSA w/ procedure x Harvard Pilgrim",
                               "Hospitals in HSA w/ procedure x CIGNA",
                               "Hospitals in HSA w/ procedure",
                               "Hospitals in HRR w/ procedure x Anthem",
                               "Hospitals in HRR w/ procedure x Harvard Pilgrim",
                               "Hospitals in HRR w/ procedure x CIGNA",
                               "Hospitals in HRR w/ procedure",
                               "Typical Patient Complexity",
                               "Hospital Quality",
                               "Median Income (1000s)",
                               "Percent Population 65 and older",
                               "Population Density",
                               "Anthem",
                               "Harvard Pilgrim",
                               "CIGNA",
                               "Constant (Medicare)"),
          dep.var.labels = "Percent of Medicare Price", font.size = "scriptsize")
```

```{r, echo=FALSE, results = "asis", message=FALSE}
# felm_hospitals_noHP_1 <- felm(data = subset(primary_regression_data, insurer != "Harvard Pilgrim HC"),
#                           formula = percent_medicare ~ n_hosp_5mi_p + Anthem_NH + CIGNA +
#                             typical_patient_complexity_scale + `Hospital Quality` + median_household_income + percent_pop_over65 + pop_density +
#                             procedure)
# 
# felm_hospitals_noHP_2 <- felm(data = subset(primary_regression_data, insurer != "Harvard Pilgrim HC"),
#                           formula = percent_medicare ~ n_hosp_25mi_p + Anthem_NH + CIGNA +
#                             typical_patient_complexity_scale + `Hospital Quality` + median_household_income + percent_pop_over65 + pop_density +
#                             procedure)
# 
# stargazer(felm_hospitals_noHP_1, felm_hospitals_noHP_2,  header = FALSE,
#           omit = "procedure", omit.labels = "Procedure Fixed Effects",
#           keep.stat = c("n", "rsq"),
#           order = c("n_hosp_5mi_p", "n_hosp_25mi_p",
#                     "typical_patient_complexity_scale", "`Hospital Quality`", "median_household_income", "percent_pop_over65", "pop_density",
#                     "Anthem_NH", "CIGNA", "Constant"),
#           title = "Hospital Competition by Procedure and Relative Price with Harvard Pilgrim excluded",
#           covariate.labels = c("Hospitals in 5-mile radius w/ procedure",
#                                "Hospitals in 25-mile radius w/ procedure",
#                                "Typical Patient Complexity",
#                                "Hospital Quality",
#                                "Median Income (1000s)",
#                                "Percent Population 65 and older",
#                                "Population Density",
#                                "Anthem",
#                                "CIGNA",
#                                "Constant (Medicare)"),
#           dep.var.labels = "Percent of Medicare Price", font.size = "footnotesize")
```
```{r, echo=FALSE, results = "asis", message=FALSE}
# primary_regression_data <- primary_regression_data %>% 
#   mutate(n_hosp_25mi_p = n_hosp_25mi_p - 1, n_hosp_25mi_total = n_hosp_25mi_total - 1, 
#          n_hosp_5mi_p = n_hosp_5mi_p - 1, n_hosp_5mi_total = n_hosp_5mi_total - 1,
#          n_hosp_hrr_p = n_hosp_hrr_p - 1, n_hosp_hrr_total = n_hosp_hrr_total - 1,
#          n_hosp_hsa_p = n_hosp_hsa_p - 1, n_hosp_hsa_total = n_hosp_hsa_total - 1)
# 
# felm_insurers <- felm(data = subset(primary_regression_data, insurer != "Medicare"),
#            formula = percent_medicare ~ Harvard_Pilgrim_HC + CIGNA + provider_name + procedure)
# 
# summary(felm_insurers)
# 
# felm_hospitals <- felm(data = subset(primary_regression_data, insurer != "Medicare"),
#                    formula = percent_medicare ~ n_hosp_hsa_total + typical_patient_complexity_scale + `Hospital Quality` + 
#                      median_household_income + percent_pop_over65 + pop_density +
#                     Harvard_Pilgrim_HC + CIGNA + procedure)
# 
# summary(felm_hospitals)
```

To explore insurer level versus hospital level effects more closely, the last set of results presented in Table 5 shows the interaction between hospital density and each insurer, where hospital density is measured by counting the number of hospitals within a 5-mile or 25-mile radius of hospital $h$ that also offer procedure $j$ as I find this to be the most reasonable specification for hospital competition. The estimated coefficients suggest that the prices Harvard Pilgrim negotiates with hospitals are associated more strongly with the number of hospitals in that hospital's market than for Anthem and CIGNA. The addition of one more hospital that offers procedure $j$ within hospital $h$'s HSA and also has a contract with Harvard Pilgrim is associated with a price decrease for procedure $j$ equivalent to 37.8% of the Medicare price for that procedure, and if an additional hospital is added to hospital $h$'s HRR, this decrease is equivalent to 4.2% of the Medicare price for that procedure.


# Discussion
*The results as a whole suggest that the market power of insurers and hospitals may be related to the prices hospitals and insurers negotiate as the theoretical framework would predict. That is, the insurers and hospitals with the greatest market shares or that face the least competition are able to negotiate the most favorable prices; for the insurers, this translates into negotiating lower prices, and for hospitals, this means negotiating higher prices.*

*While definitive conclusions about the effect of insurer market share cannot be made from these results given the limitations mentioned in the Empirical Approach, the order of their magnitudes suggests that the larger the market share of the insurer, the more market power it is able to exert and the lower the prices that insurer pays at each hospital for a given procedure. Anthem, with the largest share of the market, pays less on average than both Harvard Pilgrim and CIGNA; Harvard Pilgrim, which is smaller than Anthem but bigger than CIGNA, pays somewhere between the Anthem and CIGNA price on average; and CIGNA, the smallest of the major insurers, consistently pays much more than both Anthem and Harvard Pilgrim.*

*The HSA coefficients and the 5-mile radius coefficients are identical within each specification as there were no hospitals for which the number of hospitals within the market differed between the HSA and 5-mile radius definitions. This speaks to the fact that especially for basic health needs, many patients choose which hospital to go to based on proximity. The relationship between price and hospital density becomes more negative in these local markets when considering competition at the hospital-procedure level, which suggests that the specificity of competition may result in more intense negative pressure on prices. The coefficients on HRR and 25-mile radius hospital density are also similar in magnitude and statistically significant whether looking at hospital-level or hospital-procedure-level competition. They are all smaller that the corresponding HSA and 5-mile radius coefficients, suggesting that hospital competition may be less intense at the broader market definitions. This is consistent with the story that insurers attempt to find a balance between offering convenient hospital choice in their network and also keeping premiums low, such that it is harder for them to leverage broad hospital market competition compared to local market competition.*

*The uniquely strong interaction between hospital competition and Harvard Pilgrim may be explained by differences in company structure between Harvard Pilgrim and the other two major insurers, Anthem and CIGNA. Harvard Pilgrim is a small, private, non-profit health insurance company active mainly in the Northeast United States whereas Anthem and CIGNA are both massive, publicly traded companies that provide insurance nationally. Anthem and CIGNA may not bargain as hard with hospitals on the basis of hospital competition because the marginal payoff from getting somewhat lower prices for a relatively small portion of the population they insure in New Hampshire is less than the effort investment it requires to acquire these lower prices. Harvard Pilgrim on the other hand may exert much more effort in leveraging hospital competition in its price negotiations because the marginal benefit of lower prices is greater given that New Hampshire residents make up a greater portion of the population it insures.*

*However, there are several key limitations of this analysis in addition to the few that have been mentioned above. Namely, the analysis is limited by the lack of granularity of the data. First, the insurers' market share is only available at the state-level and therefore it cannot be explored whether the market power of each insurer within each hospital's market affects negotiated prices. Next, the hospital's true market share is also unknown as I do not have volume data for each hospital for each service, and I also do not have data on the variation of this volume across different insurers. One hospital may serve many more Medicare patients or Anthem patients than another, but this cannot be accounted for in my analysis. Lastly, the availability of price data is very limited and somewhat aggregated. I restrict my analysis only to outpatient radiology services in order to plausibly control for cost and quality both within and across hospitals, but the results may not extend to other forms of hospital care.*



# Conclusion
*Despite the limitations of this analysis, both sets of results (insurer and hospital level) suggest that private insurers and hospitals with greater market shares are able to negotiate more favorable prices for themselves. This implies that prices are lower for the insurer with a greater market share and at the hospital with a smaller market share. Thus, taken at face value, policy aimed at lowering hospital prices should either aim to increase the market power of insurers or to increase hospital competition.* 



# References
[Organization for Economic Cooperation and Development, “Health at a Glance: OECD Indicators 2017,” (2017).](https://www.oecd.org/unitedstates/Health-at-a-Glance-2017-Key-Findings-UNITED-STATES.pdf)

[Etehad, Melissa, and Kyle Kim, “The U.S. spends more on healthcare than any other country — but not with better health outcomes,” in Los Angeles Times, (Los Angeles: Los Angeles Times, July 18, 2017).](https://www.latimes.com/nation/la-na-healthcare-comparison-20170715-htmlstory.html)

[Reinhardt, Uwe E., Peter S. Hussey, and Gerard F. Anderson, “U.S. Health Care Spending In An International Context,” Health Affairs, 23 (2004), 10-25.](https://www.healthaffairs.org/doi/10.1377/hlthaff.23.3.10)

[Center for Medicare and Medicaid Services, NHE Estimates](https://www.cms.gov/research-statistics-data-and-systems/statistics-trends-and-reports/nationalhealthexpenddata/nhe-fact-sheet.html)

BEA, National Income and Product Accounts Tables: Table 1.1.5. Nominal GDP

[Bureau of Economic Advisors](https://www.bea.gov/system/files/2019-03/gdp4q18_ini_2.pdf)

[Anderson, Gerard F., Uwe E. Reinhardt, Peter S. Hussey, and Varduhi Petrosyan, “It’s the prices, stupid: why the United States is so different from other countries,” Health Affairs, 22 (2003), 89-105.](https://www.healthaffairs.org/doi/10.1377/hlthaff.22.3.89)

[Papanicolas, Irene, Liana R. Woskie, and Ashish K. Jsa, “Health Care Spending in the United States and Other High-Income Countries,” JAMA, 319 (2018), 1024-1039.](https://jamanetwork-com.ezp-prod1.hul.harvard.edu/journals/jama/fullarticle/2674671)

[Centers for Disease Control and Prevention, “Table 94. National health expenditures, average annual percent change, and percent distribution, by type of expenditure: United States, selected years 1960–2016,” (2017).](https://www.cdc.gov/nchs/data/hus/2017/094.pdf)

[Cooper, Zack, Stuart V. Craig, Martin Gaynor, and John Van Reenen, “The Price Ain’t Right? Hospital Prices and Health Spending on the Privately Insured,” NBER Working Paper Series, No. 21815 (2015, revised 2018).](https://search-proquest-com.ezp-prod1.hul.harvard.edu/docview/1750422773?accountid=11311&rfr_id=info%3Axri%2Fsid%3Aprimo)

[Bai, Ge, and Gerard F. Anderson, “Market Power: Price Variation Among Commercial Insurers For Hospital Services,” Health Affairs, 37 (2018), 1615-1622.](https://www-healthaffairs-org.ezp-prod1.hul.harvard.edu/doi/10.1377/hlthaff.2018.0567)

[State Health Facts - Health Insurance Coverage of the Total Population 2017, Kaiser Family Foundation.](https://www.kff.org/other/state-indicator/total-population/?currentTimeframe=0&sortModel=%7B%22colId%22:%22Location%22,%22sort%22:%22asc%22%7D) 

[Gowrisankaran, Guatam, Aviv Nevo, and Robert Town, “Mergers When Prices Are Negotiated: Evidence from the Hospital Industry,” American Economic Review, 105 (2015), 172-203.](https://pubs-aeaweb-org.ezp-prod1.hul.harvard.edu/doi/pdfplus/10.1257/aer.20130223)

[Ho, Kate, and Robin S. Lee, “Insurer Competition in Health Care Markets,” Econometrica, 85 (2017), 379-417.](https://onlinelibrary-wiley-com.ezp-prod1.hul.harvard.edu/doi/epdf/10.3982/ECTA13570)

[Reinhardt, Uwe E., “The Pricing Of U.S. Hospital Services: Chaos Behind A Veil Of Secrecy,” Health Affairs, 25 (2006), 57-69.](https://www.healthaffairs.org/doi/10.1377/hlthaff.25.1.57)

[Horwitz, Jill R., “Making Profits And Providing Care: Comparing Nonprofit, For-Profit, And Government Hospitals,” Health Affairs, 24 (2005), 790-801.](https://www.healthaffairs.org/doi/10.1377/hlthaff.24.3.790)

[Gaynor, Martin, Kate Ho, and Robert J. Town, “The Industrial Organization of Health-Care Markets,” Journal of Economic Literature, 53 (2015), 235-284.](https://www-aeaweb-org.ezp-prod1.hul.harvard.edu/articles?id=10.1257/jel.53.2.235)

[Dafny, Leemore, Kate Ho, and Robin S. Lee, “The Price Effects of Cross-Market Hospital Mergers,” NBER Working Paper Series, No. 22106 (2016).](https://www-nber-org.ezp-prod1.hul.harvard.edu/papers/w22106)

[Frakt, Austin B., “How Much Do Hospitals Cost Shift? A Review of the Evidence,” The Millbank Quarterly, 89 (2011), 90-130.](https://www-jstor-org.ezp-prod1.hul.harvard.edu/stable/23036197?seq=1#metadata_info_tab_contents)

 [Concord Monitor Jan 26, 2019](https://www.concordmonitor.com/hospitals-merge-followup-23005911) 

[White, Chapin, “Contrary To Cost-Shift Theory, Lower Medicare Hospital Payment Rates For Inpatient Care Lead To Lower Private Payment Rates,” Health Affairs, 32 (2013), 935-943.](https://www-healthaffairs-org.ezp-prod1.hul.harvard.edu/doi/10.1377/hlthaff.2012.0332)

[QuickFacts - New Hampshire Population Estimates July 1, 2017, United States Census Bureau](https://www.census.gov/quickfacts/nh).

[New Hampshire Insurance Department, “Preliminary Report of the 2016 Health Care Premium and Claim Cost Drivers,” (2017).](https://www.cdc.gov/nchs/data/hus/2017/094.pdf)

[Map of Hospitals - New Hampshire Acute Care Hospitals, New Hampshire Hospital Association](https://nhha.org/index.php/nh-hospitals/map-of-hospitals).

[Critical Access Hospitals (CAHs), Rural Health Information Hub, 2018](https://www.ruralhealthinfo.org/topics/critical-access-hospitals)

